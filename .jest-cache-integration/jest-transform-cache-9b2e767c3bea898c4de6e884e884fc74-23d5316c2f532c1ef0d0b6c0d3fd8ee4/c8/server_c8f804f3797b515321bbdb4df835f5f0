8e43b88af376b277f3eaacc02bdc4fdd
"use strict";
/**
 * MCP server implementation for Drupal integration
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DrupalMcpServer = void 0;
const index_js_1 = require("@modelcontextprotocol/sdk/server/index.js");
const types_js_1 = require("@modelcontextprotocol/sdk/types.js");
const index_js_2 = require("@/config/index.js");
const drupal_client_js_1 = require("@/services/drupal-client.js");
const index_js_3 = require("@/utils/index.js");
const error_handler_js_1 = require("@/utils/error-handler.js");
const index_js_4 = require("@/auth/index.js");
/**
 * MCP server for Drupal integration
 */
class DrupalMcpServer {
    config;
    server;
    drupalClient;
    oauthClient;
    mcpOAuthProvider;
    tokenManager;
    requestCounter = 0;
    constructor(config) {
        this.config = config;
        this.server = new index_js_1.Server({
            name: config.mcp.name,
            version: config.mcp.version,
        }, {
            capabilities: {
                resources: config.mcp.capabilities.resources,
                tools: config.mcp.capabilities.tools,
                prompts: config.mcp.capabilities.prompts,
            },
        });
        this.drupalClient = new drupal_client_js_1.DrupalClient(config.drupal);
        // Initialize authentication components with new MCP OAuth provider (OAuth 2.1 stateless design)
        this.mcpOAuthProvider = (0, index_js_2.createOAuthProvider)(config);
        // Convert SimplifiedOAuthConfig to OAuthConfig for backward compatibility
        const legacyOAuthConfig = {
            clientId: config.oauth.clientId,
            authorizationEndpoint: config.oauth.authorizationEndpoint ||
                config.oauth.discoveredEndpoints?.authorizationEndpoint ||
                '',
            tokenEndpoint: config.oauth.tokenEndpoint ||
                config.oauth.discoveredEndpoints?.tokenEndpoint ||
                '',
            redirectUri: config.oauth.redirectUri,
            scopes: config.oauth.scopes,
        };
        this.oauthClient = new index_js_4.OAuthClient(legacyOAuthConfig); // Keep for backward compatibility
        this.tokenManager = new index_js_4.TokenManager(this.oauthClient);
        this.setupHandlers();
    }
    /**
     * Generate unique request ID for tracing
     */
    generateRequestId() {
        return `mcp-req-${Date.now()}-${++this.requestCounter}`;
    }
    /**
     * Simplified authentication check for OAuth 2.1 stateless design
     */
    async requireAuthentication() {
        // Skip authentication if configured
        if (this.config.auth.skipAuth) {
            return { isAuthenticated: true };
        }
        try {
            // Try to get valid access token from new MCP OAuth provider first
            const validToken = await this.mcpOAuthProvider.getValidAccessToken();
            if (validToken) {
                // OAuth 2.1 tokens are stateless - no user info stored in token
                return {
                    isAuthenticated: true,
                    userId: 'default', // OAuth 2.1 stateless design - derive from token claims if needed
                    scopes: this.config.auth.requiredScopes,
                    accessToken: validToken,
                };
            }
            // Fall back to legacy token manager if needed
            const accessToken = await this.tokenManager.getValidAccessToken(undefined, this.config.auth.requiredScopes);
            if (accessToken) {
                const validation = await this.tokenManager.validateToken(accessToken, this.config.auth.requiredScopes);
                if (validation.isValid) {
                    return {
                        isAuthenticated: true,
                        userId: validation.userId || 'default',
                        scopes: validation.scopes,
                        accessToken,
                    };
                }
            }
            return { isAuthenticated: false };
        }
        catch (error) {
            console.error('Authentication error:', error);
            return { isAuthenticated: false };
        }
    }
    /**
     * Setup MCP request handlers
     */
    setupHandlers() {
        // List available resources
        this.server.setRequestHandler(types_js_1.ListResourcesRequestSchema, async () => {
            return {
                resources: await this.getResources(),
            };
        });
        // Read specific resource
        this.server.setRequestHandler(types_js_1.ReadResourceRequestSchema, async (request) => {
            return this.readResource(request.params.uri);
        });
        // List available tools
        this.server.setRequestHandler(types_js_1.ListToolsRequestSchema, async () => {
            return {
                tools: this.getTools(),
            };
        });
        // Execute tool (with authentication)
        this.server.setRequestHandler(types_js_1.CallToolRequestSchema, async (request) => {
            return this.executeToolWithAuth(request.params.name, request.params.arguments);
        });
        // List available prompts
        this.server.setRequestHandler(types_js_1.ListPromptsRequestSchema, async () => {
            return {
                prompts: this.getPrompts(),
            };
        });
        // Get prompt
        this.server.setRequestHandler(types_js_1.GetPromptRequestSchema, async (request) => {
            return this.getPrompt(request.params.name, request.params.arguments);
        });
    }
    /**
     * Get available resources
     */
    async getResources() {
        const resources = [
            {
                uri: 'drupal://nodes',
                name: 'Drupal Nodes',
                description: 'Access to Drupal node content',
                mimeType: 'application/json',
            },
            {
                uri: 'drupal://entities',
                name: 'Drupal Entities',
                description: 'Access to Drupal entity data',
                mimeType: 'application/json',
            },
        ];
        return resources;
    }
    /**
     * Read a specific resource
     */
    async readResource(uri) {
        try {
            let content;
            switch (uri) {
                case 'drupal://nodes':
                    content = await this.drupalClient.getNodes({ limit: 10 });
                    break;
                case 'drupal://entities':
                    content = await this.drupalClient.queryEntities('node', undefined, {
                        limit: 10,
                    });
                    break;
                default:
                    throw new error_handler_js_1.IntegrationError(error_handler_js_1.IntegrationErrorType.VALIDATION_ERROR, `Unknown resource URI: ${uri}`, undefined, 'uri', { validUris: ['drupal://nodes', 'drupal://entities'] }, undefined, false);
            }
            return {
                contents: [
                    {
                        uri,
                        mimeType: 'application/json',
                        text: JSON.stringify(content, null, 2),
                    },
                ],
            };
        }
        catch (error) {
            const integrationError = error instanceof error_handler_js_1.IntegrationError
                ? error
                : (0, error_handler_js_1.normalizeError)(error, `Reading resource: ${uri}`);
            // Log the error for debugging
            const logData = (0, error_handler_js_1.formatErrorForLogging)(integrationError, { uri });
            console[logData.level](logData.message, logData.meta);
            return {
                contents: [
                    {
                        uri,
                        mimeType: 'application/json',
                        text: JSON.stringify({
                            error: {
                                type: integrationError.errorType,
                                message: integrationError.getUserFriendlyMessage(),
                                details: {
                                    technical_message: integrationError.message,
                                    timestamp: new Date().toISOString(),
                                    retryable: integrationError.retryable,
                                },
                            },
                        }, null, 2),
                    },
                ],
            };
        }
    }
    /**
     * Get available tools
     */
    getTools() {
        const authTools = [
            {
                name: 'auth_login',
                description: 'Authenticate with Drupalize.me OAuth',
                inputSchema: {
                    type: 'object',
                    properties: {},
                },
            },
            {
                name: 'auth_status',
                description: 'Check current authentication status',
                inputSchema: {
                    type: 'object',
                    properties: {},
                },
            },
            {
                name: 'auth_logout',
                description: 'Logout and clear stored tokens',
                inputSchema: {
                    type: 'object',
                    properties: {},
                },
            },
        ];
        const dataTools = [
            {
                name: 'load_node',
                description: 'Load a Drupal node by ID',
                inputSchema: {
                    type: 'object',
                    properties: {
                        nodeId: {
                            type: ['string', 'number'],
                            description: 'The node ID to load',
                        },
                    },
                    required: ['nodeId'],
                },
            },
            {
                name: 'create_node',
                description: 'Create a new Drupal node',
                inputSchema: {
                    type: 'object',
                    properties: {
                        type: {
                            type: 'string',
                            description: 'The node type (e.g., "article", "page")',
                        },
                        title: {
                            type: 'string',
                            description: 'The node title',
                        },
                        body: {
                            type: 'string',
                            description: 'The node body content',
                        },
                        status: {
                            type: 'boolean',
                            description: 'Whether the node is published',
                            default: true,
                        },
                    },
                    required: ['type', 'title'],
                },
            },
            {
                name: 'search_nodes',
                description: 'Search for Drupal nodes',
                inputSchema: {
                    type: 'object',
                    properties: {
                        type: {
                            type: 'string',
                            description: 'Filter by node type',
                        },
                        status: {
                            type: 'boolean',
                            description: 'Filter by published status',
                        },
                        limit: {
                            type: 'number',
                            description: 'Maximum number of results',
                            default: 10,
                            minimum: 1,
                            maximum: 100,
                        },
                    },
                },
            },
            {
                name: 'test_connection',
                description: 'Test connection to Drupal server',
                inputSchema: {
                    type: 'object',
                    properties: {},
                },
            },
            {
                name: 'search_tutorials',
                description: 'Search Drupalize.me tutorials with filtering by content types, Drupal versions, categories, and sorting options',
                inputSchema: {
                    type: 'object',
                    properties: {
                        keywords: {
                            type: 'string',
                            description: 'Search keywords (minimum 2 characters)',
                            minLength: 2,
                        },
                        types: {
                            type: 'array',
                            description: 'Filter by content types (defaults to ["tutorial", "topic", "course"])',
                            items: {
                                type: 'string',
                                enum: ['tutorial', 'topic', 'course', 'video', 'guide'],
                            },
                        },
                        drupal_version: {
                            type: 'array',
                            description: 'Filter by Drupal versions',
                            items: {
                                type: 'string',
                                enum: ['9', '10', '11'],
                            },
                        },
                        category: {
                            type: 'array',
                            description: 'Filter by tutorial categories/tags',
                            items: {
                                type: 'string',
                            },
                        },
                        sort: {
                            type: 'string',
                            description: 'Sort results by relevance, date, or title',
                            enum: ['search_api_relevance', 'created', 'changed', 'title'],
                        },
                        page: {
                            type: 'object',
                            description: 'Pagination settings',
                            properties: {
                                limit: {
                                    type: 'number',
                                    description: 'Number of results per page',
                                    minimum: 1,
                                    maximum: 100,
                                    default: 10,
                                },
                                offset: {
                                    type: 'number',
                                    description: 'Number of results to skip',
                                    minimum: 0,
                                    default: 0,
                                },
                            },
                        },
                    },
                    required: ['keywords'],
                },
            },
        ];
        return [...authTools, ...dataTools];
    }
    /**
     * Execute a tool with authentication
     */
    async executeToolWithAuth(name, args) {
        const requestId = this.generateRequestId();
        try {
            // Handle authentication tools separately
            if (name.startsWith('auth_')) {
                return await this.executeAuthTool(name, args);
            }
            // For data tools, require authentication (unless skipped)
            if (!this.config.auth.skipAuth) {
                const authContext = await this.requireAuthentication();
                if (!authContext.isAuthenticated) {
                    throw new index_js_4.AuthenticationRequiredError('Please authenticate first using auth_login tool');
                }
                // Update Drupal client with access token
                if (authContext.accessToken) {
                    this.drupalClient.setAccessToken(authContext.accessToken);
                }
            }
            return await this.executeTool(name, args);
        }
        catch (error) {
            if (error instanceof index_js_4.AuthenticationRequiredError) {
                return {
                    content: [
                        {
                            type: 'text',
                            text: JSON.stringify((0, index_js_4.createMcpErrorResponse)(requestId, error), null, 2),
                        },
                    ],
                };
            }
            throw error;
        }
    }
    /**
     * Execute authentication tools
     */
    async executeAuthTool(name, args) {
        try {
            let result;
            switch (name) {
                case 'auth_login':
                    result = await this.executeAuthLogin();
                    break;
                case 'auth_status':
                    result = await this.executeAuthStatus();
                    break;
                case 'auth_logout':
                    result = await this.executeAuthLogout();
                    break;
                default:
                    throw new Error(`Unknown auth tool: ${name}`);
            }
            return {
                content: [
                    {
                        type: 'text',
                        text: JSON.stringify(result, null, 2),
                    },
                ],
            };
        }
        catch (error) {
            const integrationError = error instanceof error_handler_js_1.IntegrationError
                ? error
                : (0, error_handler_js_1.normalizeError)(error, `Executing auth tool: ${name}`);
            const logData = (0, error_handler_js_1.formatErrorForLogging)(integrationError, {
                tool: name,
                args,
            });
            console[logData.level](logData.message, logData.meta);
            return (0, error_handler_js_1.formatMcpErrorResponse)(integrationError, this.generateRequestId());
        }
    }
    /**
     * Execute data tools (original executeTool method)
     */
    async executeTool(name, args) {
        const requestId = this.generateRequestId();
        try {
            let result;
            switch (name) {
                case 'load_node':
                    result = await this.executeLoadNode(args);
                    break;
                case 'create_node':
                    result = await this.executeCreateNode(args);
                    break;
                case 'search_nodes':
                    result = await this.executeSearchNodes(args);
                    break;
                case 'test_connection':
                    result = await this.executeTestConnection();
                    break;
                case 'search_tutorials':
                    result = await this.executeSearchTutorials(args);
                    break;
                default:
                    throw new error_handler_js_1.IntegrationError(error_handler_js_1.IntegrationErrorType.VALIDATION_ERROR, `Unknown tool: ${name}`, undefined, 'name', {
                        validTools: [
                            'load_node',
                            'create_node',
                            'search_nodes',
                            'test_connection',
                            'search_tutorials',
                        ],
                        requestedTool: name,
                    }, undefined, false);
            }
            return {
                content: [
                    {
                        type: 'text',
                        text: JSON.stringify(result, null, 2),
                    },
                ],
            };
        }
        catch (error) {
            const integrationError = error instanceof error_handler_js_1.IntegrationError
                ? error
                : (0, error_handler_js_1.normalizeError)(error, `Executing tool: ${name}`, requestId);
            // Log the error for debugging
            const logData = (0, error_handler_js_1.formatErrorForLogging)(integrationError, {
                tool: name,
                args,
            });
            console[logData.level](logData.message, logData.meta);
            return (0, error_handler_js_1.formatMcpErrorResponse)(integrationError, requestId);
        }
    }
    /**
     * Execute load node tool
     */
    async executeLoadNode(args) {
        if (!args || typeof args !== 'object' || !('nodeId' in args)) {
            throw new Error('nodeId is required');
        }
        const { nodeId } = args;
        return this.drupalClient.loadNode(nodeId);
    }
    /**
     * Execute create node tool
     */
    async executeCreateNode(args) {
        if (!args || typeof args !== 'object') {
            throw new Error('Invalid arguments');
        }
        const { type, title, body, status = true, } = args;
        if (!type || !title) {
            throw new Error('type and title are required');
        }
        return this.drupalClient.createNode({ type, title, body, status });
    }
    /**
     * Execute search nodes tool
     */
    async executeSearchNodes(args) {
        const options = args || {};
        return this.drupalClient.getNodes(options);
    }
    /**
     * Execute test connection tool
     */
    async executeTestConnection() {
        const connected = await this.drupalClient.testConnection();
        const config = this.drupalClient.getConfig();
        return { connected, config };
    }
    /**
     * Execute authentication login using new MCP OAuth provider
     */
    async executeAuthLogin() {
        try {
            // Use the new MCP OAuth provider for authentication
            const tokens = await this.mcpOAuthProvider.authorize();
            const userId = 'default'; // In production, derive from token or user input
            // Convert MCP SDK tokens to legacy token format for compatibility
            const legacyTokens = {
                accessToken: tokens.access_token,
                refreshToken: tokens.refresh_token,
                tokenType: tokens.token_type || 'Bearer',
                expiresIn: tokens.expires_in,
                scope: tokens.scope,
            };
            // Store tokens using both old and new systems for compatibility
            await this.tokenManager.storeTokens(legacyTokens, userId, this.config.auth.requiredScopes);
            await this.mcpOAuthProvider.saveTokens(tokens);
            // Set access token on Drupal client for immediate use
            this.drupalClient.setAccessToken(tokens.access_token);
            return {
                success: true,
                message: 'Authentication successful using OAuth 2.1 stateless configuration',
                userId,
                scopes: this.config.auth.requiredScopes,
                provider: 'McpOAuthProvider',
                endpointsDiscovered: !!this.config.oauth.discoveredEndpoints,
                isFallback: this.config.oauth.discoveredEndpoints?.isFallback,
                tokenExpiry: tokens.expires_in
                    ? Date.now() + tokens.expires_in * 1000
                    : undefined,
            };
        }
        catch (error) {
            return {
                success: false,
                error: error instanceof Error ? error.message : 'Authentication failed',
                hint: 'Make sure to complete the OAuth flow in your browser. Check that DRUPAL_BASE_URL and OAUTH_CLIENT_ID are set correctly.',
            };
        }
    }
    /**
     * Execute authentication status check
     */
    async executeAuthStatus() {
        try {
            const tokenInfo = await this.tokenManager.getTokenInfo();
            const mcpTokenInfo = await this.mcpOAuthProvider.getTokenInfo();
            const hasValidTokens = await this.mcpOAuthProvider.hasValidTokens();
            const authContext = await this.requireAuthentication();
            return {
                isAuthenticated: authContext.isAuthenticated,
                userId: authContext.userId,
                scopes: authContext.scopes,
                tokenInfo,
                mcpProvider: {
                    hasValidTokens,
                    tokenInfo: mcpTokenInfo,
                },
                provider: 'McpOAuthProvider (OAuth 2.1 Stateless)',
                configInfo: {
                    endpointsDiscovered: !!this.config.oauth.discoveredEndpoints,
                    isFallback: this.config.oauth.discoveredEndpoints?.isFallback,
                    authorizationEndpoint: this.config.oauth.authorizationEndpoint,
                    tokenEndpoint: this.config.oauth.tokenEndpoint,
                    skipAuth: this.config.auth.skipAuth,
                },
            };
        }
        catch (error) {
            return {
                isAuthenticated: false,
                error: error instanceof Error
                    ? error.message
                    : 'Failed to check auth status',
            };
        }
    }
    /**
     * Execute authentication logout
     */
    async executeAuthLogout() {
        try {
            await this.tokenManager.clearTokens();
            await this.mcpOAuthProvider.clearTokens();
            this.drupalClient.clearAccessToken();
            return {
                success: true,
                message: 'Logout successful - cleared all tokens (OAuth 2.1 stateless)',
            };
        }
        catch (error) {
            return {
                success: false,
                error: error instanceof Error ? error.message : 'Logout failed',
            };
        }
    }
    /**
     * Execute search tutorials tool
     */
    async executeSearchTutorials(args) {
        // Validate and process input parameters using new validation function
        const processedParams = (0, index_js_3.validateSearchContentParams)(args);
        // In test environment or when Drupal is unavailable, return mock data
        if (this.config.environment === 'test' || process.env.NODE_ENV === 'test') {
            return this.getMockSearchContentResults(processedParams);
        }
        try {
            // Make real JSON-RPC call to Drupal endpoint using new parameter structure
            const response = await this.drupalClient.searchTutorials({
                keywords: processedParams.keywords,
                types: processedParams.types,
                drupal_version: processedParams.drupal_version,
                category: processedParams.category,
                sort: processedParams.sort,
                page: processedParams.page,
            });
            // Process and format the response for MCP consumption
            const results = response.results.map(tutorial => ({
                id: tutorial.id,
                title: tutorial.title,
                url: tutorial.url,
                description: tutorial.description ||
                    this.extractDescriptionFromContent(tutorial.content),
                drupal_version: tutorial.drupal_version,
                tags: tutorial.tags,
                difficulty: tutorial.difficulty,
                created: tutorial.created,
                updated: tutorial.updated,
            }));
            return {
                results,
                total: response.total,
                facets: response.facets,
                query: processedParams,
            };
        }
        catch (error) {
            // Convert any validation errors to IntegrationError
            if (error instanceof index_js_3.ValidationError) {
                throw new error_handler_js_1.IntegrationError(error_handler_js_1.IntegrationErrorType.VALIDATION_ERROR, error.message, undefined, error.field, { processedParams }, error, false);
            }
            // Handle IntegrationErrors from the DrupalClient
            if (error instanceof error_handler_js_1.IntegrationError) {
                // In production, re-throw the error; in development, log and return mock data for certain error types
                if (this.config.environment === 'production' || !error.retryable) {
                    throw error;
                }
                // Fallback to mock data if the real endpoint is unavailable and error is retryable
                console.warn(`API unavailable (${error.errorType}), returning mock data: ${error.message}`);
                return this.getMockSearchContentResults(processedParams);
            }
            // Handle any other unexpected errors
            const integrationError = (0, error_handler_js_1.normalizeError)(error, 'Tutorial search');
            // In production, re-throw; in development, return mock data for network-related errors
            if (this.config.environment === 'production') {
                throw integrationError;
            }
            console.warn(`Unexpected error, returning mock data: ${integrationError.message}`);
            return this.getMockSearchContentResults(processedParams);
        }
    }
    /**
     * Get mock search results for new content API (testing and fallback scenarios)
     */
    getMockSearchContentResults(processedParams) {
        // Create mock results that support filtering
        const allMockResults = [
            {
                id: '1',
                title: `Tutorial about ${processedParams.keywords}`,
                url: 'https://drupalize.me/tutorial/sample-tutorial',
                description: `A comprehensive tutorial covering ${processedParams.keywords} concepts`,
                drupal_version: ['10', '11'],
                tags: processedParams.category && processedParams.category.length > 0
                    ? processedParams.category
                    : ['tutorial', 'drupal'],
                difficulty: 'intermediate',
                created: '2024-01-01T00:00:00Z',
                updated: '2024-06-01T00:00:00Z',
            },
            // Add a Drupal 9 specific tutorial for testing filtering
            {
                id: '2',
                title: `Drupal 9 specific tutorial about ${processedParams.keywords}`,
                url: 'https://drupalize.me/tutorial/drupal9-tutorial',
                description: `Legacy tutorial for ${processedParams.keywords} in Drupal 9`,
                drupal_version: ['9'],
                tags: processedParams.category && processedParams.category.length > 0
                    ? [...processedParams.category, 'drupal-9']
                    : ['tutorial', 'drupal', 'drupal-9'],
                difficulty: 'intermediate',
                created: '2023-01-01T00:00:00Z',
                updated: '2023-06-01T00:00:00Z',
            },
        ];
        // Filter results by drupal_version if specified
        const filteredResults = processedParams.drupal_version &&
            processedParams.drupal_version.length > 0
            ? allMockResults.filter(result => processedParams.drupal_version.some(version => result.drupal_version?.includes(version)))
            : allMockResults.slice(0, 1); // Return only the first result when no version filter is applied
        return {
            results: filteredResults,
            total: filteredResults.length,
            facets: {
                drupal_version: {
                    '9': 1,
                    '10': 1,
                    '11': 1,
                },
                content_type: {
                    tutorial: 2,
                    topic: 0,
                    course: 0,
                },
            },
            query: processedParams,
        };
    }
    /**
     * Extract description from tutorial content for RAG optimization
     */
    extractDescriptionFromContent(content) {
        // Extract first paragraph or first 200 characters as description
        const lines = content.split('\n').filter(line => line.trim());
        const firstContentLine = lines.find(line => !line.startsWith('#') && line.trim().length > 0);
        if (firstContentLine) {
            return firstContentLine.length > 200
                ? `${firstContentLine.substring(0, 197)}...`
                : firstContentLine;
        }
        // Fallback: return first 200 characters
        return `${content.substring(0, 197)}...`;
    }
    /**
     * Get available prompts
     */
    getPrompts() {
        return [
            {
                name: 'drupal_content_summary',
                description: 'Generate a summary of Drupal content',
                arguments: [
                    {
                        name: 'content_type',
                        description: 'Type of content to summarize',
                        required: false,
                    },
                    {
                        name: 'limit',
                        description: 'Maximum number of items to include',
                        required: false,
                    },
                ],
            },
        ];
    }
    /**
     * Get a specific prompt
     */
    async getPrompt(name, args) {
        switch (name) {
            case 'drupal_content_summary':
                return this.getDrupalContentSummaryPrompt(args);
            default:
                throw new Error(`Unknown prompt: ${name}`);
        }
    }
    /**
     * Get Drupal content summary prompt
     */
    async getDrupalContentSummaryPrompt(args) {
        const contentType = args?.content_type;
        const limit = args?.limit || 10;
        try {
            const nodes = await this.drupalClient.getNodes({
                type: contentType,
                limit,
            });
            const content = `Here are the recent Drupal nodes${contentType ? ` of type "${contentType}"` : ''}:\n\n${nodes
                .map((node, index) => `${index + 1}. ${node.attributes.title} (ID: ${node.attributes.nid})`)
                .join('\n')}\n\nPlease provide a summary of this content.`;
            return {
                description: `Summary of Drupal content${contentType ? ` (${contentType})` : ''}`,
                messages: [
                    {
                        role: 'user',
                        content: {
                            type: 'text',
                            text: content,
                        },
                    },
                ],
            };
        }
        catch (error) {
            const errorMessage = error instanceof drupal_client_js_1.DrupalClientError ? error.message : String(error);
            return {
                description: 'Error generating Drupal content summary',
                messages: [
                    {
                        role: 'user',
                        content: {
                            type: 'text',
                            text: `Error fetching Drupal content: ${errorMessage}`,
                        },
                    },
                ],
            };
        }
    }
    /**
     * Get the underlying server instance
     */
    getServer() {
        return this.server;
    }
    /**
     * Connect the server to a transport
     */
    async connect(transport) {
        await this.server.connect(transport);
    }
    /**
     * Close the server
     */
    async close() {
        await this.server.close();
    }
}
exports.DrupalMcpServer = DrupalMcpServer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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akYsUUFBUSxFQUFFO29CQUNSO3dCQUNFLElBQUksRUFBRSxNQUFNO3dCQUNaLE9BQU8sRUFBRTs0QkFDUCxJQUFJLEVBQUUsTUFBTTs0QkFDWixJQUFJLEVBQUUsT0FBTzt5QkFDZDtxQkFDRjtpQkFDRjthQUNGLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE1BQU0sWUFBWSxHQUNoQixLQUFLLFlBQVksb0NBQWlCLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVyRSxPQUFPO2dCQUNMLFdBQVcsRUFBRSx5Q0FBeUM7Z0JBQ3RELFFBQVEsRUFBRTtvQkFDUjt3QkFDRSxJQUFJLEVBQUUsTUFBTTt3QkFDWixPQUFPLEVBQUU7NEJBQ1AsSUFBSSxFQUFFLE1BQU07NEJBQ1osSUFBSSxFQUFFLGtDQUFrQyxZQUFZLEVBQUU7eUJBQ3ZEO3FCQUNGO2lCQUNGO2FBQ0YsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxTQUFTO1FBQ1AsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBb0I7UUFDaEMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsS0FBSztRQUNULE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUM1QixDQUFDO0NBQ0Y7QUF6akNELDBDQXlqQ0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL3dvcmtzcGFjZS9zcmMvbWNwL3NlcnZlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1DUCBzZXJ2ZXIgaW1wbGVtZW50YXRpb24gZm9yIERydXBhbCBpbnRlZ3JhdGlvblxuICovXG5cbmltcG9ydCB7IFNlcnZlciB9IGZyb20gJ0Btb2RlbGNvbnRleHRwcm90b2NvbC9zZGsvc2VydmVyL2luZGV4LmpzJztcbmltcG9ydCB0eXBlIHsgVHJhbnNwb3J0IH0gZnJvbSAnQG1vZGVsY29udGV4dHByb3RvY29sL3Nkay9zaGFyZWQvdHJhbnNwb3J0LmpzJztcbmltcG9ydCB7XG4gIENhbGxUb29sUmVxdWVzdFNjaGVtYSxcbiAgR2V0UHJvbXB0UmVxdWVzdFNjaGVtYSxcbiAgTGlzdFByb21wdHNSZXF1ZXN0U2NoZW1hLFxuICBMaXN0UmVzb3VyY2VzUmVxdWVzdFNjaGVtYSxcbiAgTGlzdFRvb2xzUmVxdWVzdFNjaGVtYSxcbiAgUmVhZFJlc291cmNlUmVxdWVzdFNjaGVtYSxcbn0gZnJvbSAnQG1vZGVsY29udGV4dHByb3RvY29sL3Nkay90eXBlcy5qcyc7XG5cbmltcG9ydCB0eXBlIHsgQXBwQ29uZmlnIH0gZnJvbSAnQC9jb25maWcvaW5kZXguanMnO1xuaW1wb3J0IHsgY3JlYXRlT0F1dGhQcm92aWRlciB9IGZyb20gJ0AvY29uZmlnL2luZGV4LmpzJztcbmltcG9ydCB0eXBlIHtcbiAgTWNwUmVzb3VyY2UsXG4gIE1jcFRvb2wsXG4gIE1jcFByb21wdCxcbiAgUHJvY2Vzc2VkU2VhcmNoQ29udGVudFBhcmFtcyxcbiAgU2VhcmNoQ29udGVudFJlc3BvbnNlLFxuICBUdXRvcmlhbFNlYXJjaFJlc3VsdCxcbn0gZnJvbSAnQC90eXBlcy9pbmRleC5qcyc7XG5pbXBvcnQgeyBEcnVwYWxDbGllbnQsIERydXBhbENsaWVudEVycm9yIH0gZnJvbSAnQC9zZXJ2aWNlcy9kcnVwYWwtY2xpZW50LmpzJztcbmltcG9ydCB7IHZhbGlkYXRlU2VhcmNoQ29udGVudFBhcmFtcywgVmFsaWRhdGlvbkVycm9yIH0gZnJvbSAnQC91dGlscy9pbmRleC5qcyc7XG5pbXBvcnQge1xuICBJbnRlZ3JhdGlvbkVycm9yLFxuICBJbnRlZ3JhdGlvbkVycm9yVHlwZSxcbiAgbm9ybWFsaXplRXJyb3IsXG4gIGZvcm1hdE1jcEVycm9yUmVzcG9uc2UsXG4gIGZvcm1hdEVycm9yRm9yTG9nZ2luZyxcbn0gZnJvbSAnQC91dGlscy9lcnJvci1oYW5kbGVyLmpzJztcbmltcG9ydCB7XG4gIE9BdXRoQ2xpZW50LFxuICBUb2tlbk1hbmFnZXIsXG4gIEF1dGhlbnRpY2F0aW9uUmVxdWlyZWRFcnJvcixcbiAgY3JlYXRlTWNwRXJyb3JSZXNwb25zZSxcbiAgTWNwT0F1dGhQcm92aWRlcixcbiAgdHlwZSBBdXRoQ29udGV4dCxcbn0gZnJvbSAnQC9hdXRoL2luZGV4LmpzJztcblxuLyoqXG4gKiBNQ1Agc2VydmVyIGZvciBEcnVwYWwgaW50ZWdyYXRpb25cbiAqL1xuZXhwb3J0IGNsYXNzIERydXBhbE1jcFNlcnZlciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2VydmVyOiBTZXJ2ZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgZHJ1cGFsQ2xpZW50OiBEcnVwYWxDbGllbnQ7XG4gIHByaXZhdGUgcmVhZG9ubHkgb2F1dGhDbGllbnQ6IE9BdXRoQ2xpZW50O1xuICBwcml2YXRlIHJlYWRvbmx5IG1jcE9BdXRoUHJvdmlkZXI6IE1jcE9BdXRoUHJvdmlkZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgdG9rZW5NYW5hZ2VyOiBUb2tlbk1hbmFnZXI7XG4gIHByaXZhdGUgcmVxdWVzdENvdW50ZXIgPSAwO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY29uZmlnOiBBcHBDb25maWcpIHtcbiAgICB0aGlzLnNlcnZlciA9IG5ldyBTZXJ2ZXIoXG4gICAgICB7XG4gICAgICAgIG5hbWU6IGNvbmZpZy5tY3AubmFtZSxcbiAgICAgICAgdmVyc2lvbjogY29uZmlnLm1jcC52ZXJzaW9uLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgY2FwYWJpbGl0aWVzOiB7XG4gICAgICAgICAgcmVzb3VyY2VzOiBjb25maWcubWNwLmNhcGFiaWxpdGllcy5yZXNvdXJjZXMsXG4gICAgICAgICAgdG9vbHM6IGNvbmZpZy5tY3AuY2FwYWJpbGl0aWVzLnRvb2xzLFxuICAgICAgICAgIHByb21wdHM6IGNvbmZpZy5tY3AuY2FwYWJpbGl0aWVzLnByb21wdHMsXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcblxuICAgIHRoaXMuZHJ1cGFsQ2xpZW50ID0gbmV3IERydXBhbENsaWVudChjb25maWcuZHJ1cGFsKTtcblxuICAgIC8vIEluaXRpYWxpemUgYXV0aGVudGljYXRpb24gY29tcG9uZW50cyB3aXRoIG5ldyBNQ1AgT0F1dGggcHJvdmlkZXIgKE9BdXRoIDIuMSBzdGF0ZWxlc3MgZGVzaWduKVxuICAgIHRoaXMubWNwT0F1dGhQcm92aWRlciA9IGNyZWF0ZU9BdXRoUHJvdmlkZXIoY29uZmlnKTtcblxuICAgIC8vIENvbnZlcnQgU2ltcGxpZmllZE9BdXRoQ29uZmlnIHRvIE9BdXRoQ29uZmlnIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgY29uc3QgbGVnYWN5T0F1dGhDb25maWcgPSB7XG4gICAgICBjbGllbnRJZDogY29uZmlnLm9hdXRoLmNsaWVudElkLFxuICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OlxuICAgICAgICBjb25maWcub2F1dGguYXV0aG9yaXphdGlvbkVuZHBvaW50IHx8XG4gICAgICAgIGNvbmZpZy5vYXV0aC5kaXNjb3ZlcmVkRW5kcG9pbnRzPy5hdXRob3JpemF0aW9uRW5kcG9pbnQgfHxcbiAgICAgICAgJycsXG4gICAgICB0b2tlbkVuZHBvaW50OlxuICAgICAgICBjb25maWcub2F1dGgudG9rZW5FbmRwb2ludCB8fFxuICAgICAgICBjb25maWcub2F1dGguZGlzY292ZXJlZEVuZHBvaW50cz8udG9rZW5FbmRwb2ludCB8fFxuICAgICAgICAnJyxcbiAgICAgIHJlZGlyZWN0VXJpOiBjb25maWcub2F1dGgucmVkaXJlY3RVcmksXG4gICAgICBzY29wZXM6IGNvbmZpZy5vYXV0aC5zY29wZXMsXG4gICAgfTtcblxuICAgIHRoaXMub2F1dGhDbGllbnQgPSBuZXcgT0F1dGhDbGllbnQobGVnYWN5T0F1dGhDb25maWcpOyAvLyBLZWVwIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgdGhpcy50b2tlbk1hbmFnZXIgPSBuZXcgVG9rZW5NYW5hZ2VyKHRoaXMub2F1dGhDbGllbnQpO1xuXG4gICAgdGhpcy5zZXR1cEhhbmRsZXJzKCk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgdW5pcXVlIHJlcXVlc3QgSUQgZm9yIHRyYWNpbmdcbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVSZXF1ZXN0SWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYG1jcC1yZXEtJHtEYXRlLm5vdygpfS0keysrdGhpcy5yZXF1ZXN0Q291bnRlcn1gO1xuICB9XG5cbiAgLyoqXG4gICAqIFNpbXBsaWZpZWQgYXV0aGVudGljYXRpb24gY2hlY2sgZm9yIE9BdXRoIDIuMSBzdGF0ZWxlc3MgZGVzaWduXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlcXVpcmVBdXRoZW50aWNhdGlvbigpOiBQcm9taXNlPEF1dGhDb250ZXh0PiB7XG4gICAgLy8gU2tpcCBhdXRoZW50aWNhdGlvbiBpZiBjb25maWd1cmVkXG4gICAgaWYgKHRoaXMuY29uZmlnLmF1dGguc2tpcEF1dGgpIHtcbiAgICAgIHJldHVybiB7IGlzQXV0aGVudGljYXRlZDogdHJ1ZSB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBUcnkgdG8gZ2V0IHZhbGlkIGFjY2VzcyB0b2tlbiBmcm9tIG5ldyBNQ1AgT0F1dGggcHJvdmlkZXIgZmlyc3RcbiAgICAgIGNvbnN0IHZhbGlkVG9rZW4gPSBhd2FpdCB0aGlzLm1jcE9BdXRoUHJvdmlkZXIuZ2V0VmFsaWRBY2Nlc3NUb2tlbigpO1xuXG4gICAgICBpZiAodmFsaWRUb2tlbikge1xuICAgICAgICAvLyBPQXV0aCAyLjEgdG9rZW5zIGFyZSBzdGF0ZWxlc3MgLSBubyB1c2VyIGluZm8gc3RvcmVkIGluIHRva2VuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLFxuICAgICAgICAgIHVzZXJJZDogJ2RlZmF1bHQnLCAvLyBPQXV0aCAyLjEgc3RhdGVsZXNzIGRlc2lnbiAtIGRlcml2ZSBmcm9tIHRva2VuIGNsYWltcyBpZiBuZWVkZWRcbiAgICAgICAgICBzY29wZXM6IHRoaXMuY29uZmlnLmF1dGgucmVxdWlyZWRTY29wZXMsXG4gICAgICAgICAgYWNjZXNzVG9rZW46IHZhbGlkVG9rZW4sXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIEZhbGwgYmFjayB0byBsZWdhY3kgdG9rZW4gbWFuYWdlciBpZiBuZWVkZWRcbiAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgdGhpcy50b2tlbk1hbmFnZXIuZ2V0VmFsaWRBY2Nlc3NUb2tlbihcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICB0aGlzLmNvbmZpZy5hdXRoLnJlcXVpcmVkU2NvcGVzXG4gICAgICApO1xuXG4gICAgICBpZiAoYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudG9rZW5NYW5hZ2VyLnZhbGlkYXRlVG9rZW4oXG4gICAgICAgICAgYWNjZXNzVG9rZW4sXG4gICAgICAgICAgdGhpcy5jb25maWcuYXV0aC5yZXF1aXJlZFNjb3Blc1xuICAgICAgICApO1xuXG4gICAgICAgIGlmICh2YWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLFxuICAgICAgICAgICAgdXNlcklkOiB2YWxpZGF0aW9uLnVzZXJJZCB8fCAnZGVmYXVsdCcsXG4gICAgICAgICAgICBzY29wZXM6IHZhbGlkYXRpb24uc2NvcGVzLFxuICAgICAgICAgICAgYWNjZXNzVG9rZW4sXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IGlzQXV0aGVudGljYXRlZDogZmFsc2UgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0dXAgTUNQIHJlcXVlc3QgaGFuZGxlcnNcbiAgICovXG4gIHByaXZhdGUgc2V0dXBIYW5kbGVycygpOiB2b2lkIHtcbiAgICAvLyBMaXN0IGF2YWlsYWJsZSByZXNvdXJjZXNcbiAgICB0aGlzLnNlcnZlci5zZXRSZXF1ZXN0SGFuZGxlcihMaXN0UmVzb3VyY2VzUmVxdWVzdFNjaGVtYSwgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVzb3VyY2VzOiBhd2FpdCB0aGlzLmdldFJlc291cmNlcygpLFxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIC8vIFJlYWQgc3BlY2lmaWMgcmVzb3VyY2VcbiAgICB0aGlzLnNlcnZlci5zZXRSZXF1ZXN0SGFuZGxlcihSZWFkUmVzb3VyY2VSZXF1ZXN0U2NoZW1hLCBhc3luYyByZXF1ZXN0ID0+IHtcbiAgICAgIHJldHVybiB0aGlzLnJlYWRSZXNvdXJjZShyZXF1ZXN0LnBhcmFtcy51cmkpO1xuICAgIH0pO1xuXG4gICAgLy8gTGlzdCBhdmFpbGFibGUgdG9vbHNcbiAgICB0aGlzLnNlcnZlci5zZXRSZXF1ZXN0SGFuZGxlcihMaXN0VG9vbHNSZXF1ZXN0U2NoZW1hLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b29sczogdGhpcy5nZXRUb29scygpLFxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIC8vIEV4ZWN1dGUgdG9vbCAod2l0aCBhdXRoZW50aWNhdGlvbilcbiAgICB0aGlzLnNlcnZlci5zZXRSZXF1ZXN0SGFuZGxlcihDYWxsVG9vbFJlcXVlc3RTY2hlbWEsIGFzeW5jIHJlcXVlc3QgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuZXhlY3V0ZVRvb2xXaXRoQXV0aChcbiAgICAgICAgcmVxdWVzdC5wYXJhbXMubmFtZSxcbiAgICAgICAgcmVxdWVzdC5wYXJhbXMuYXJndW1lbnRzXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgLy8gTGlzdCBhdmFpbGFibGUgcHJvbXB0c1xuICAgIHRoaXMuc2VydmVyLnNldFJlcXVlc3RIYW5kbGVyKExpc3RQcm9tcHRzUmVxdWVzdFNjaGVtYSwgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvbXB0czogdGhpcy5nZXRQcm9tcHRzKCksXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgLy8gR2V0IHByb21wdFxuICAgIHRoaXMuc2VydmVyLnNldFJlcXVlc3RIYW5kbGVyKEdldFByb21wdFJlcXVlc3RTY2hlbWEsIGFzeW5jIHJlcXVlc3QgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJvbXB0KHJlcXVlc3QucGFyYW1zLm5hbWUsIHJlcXVlc3QucGFyYW1zLmFyZ3VtZW50cyk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGF2YWlsYWJsZSByZXNvdXJjZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0UmVzb3VyY2VzKCk6IFByb21pc2U8TWNwUmVzb3VyY2VbXT4ge1xuICAgIGNvbnN0IHJlc291cmNlczogTWNwUmVzb3VyY2VbXSA9IFtcbiAgICAgIHtcbiAgICAgICAgdXJpOiAnZHJ1cGFsOi8vbm9kZXMnLFxuICAgICAgICBuYW1lOiAnRHJ1cGFsIE5vZGVzJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdBY2Nlc3MgdG8gRHJ1cGFsIG5vZGUgY29udGVudCcsXG4gICAgICAgIG1pbWVUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB1cmk6ICdkcnVwYWw6Ly9lbnRpdGllcycsXG4gICAgICAgIG5hbWU6ICdEcnVwYWwgRW50aXRpZXMnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0FjY2VzcyB0byBEcnVwYWwgZW50aXR5IGRhdGEnLFxuICAgICAgICBtaW1lVHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgfSxcbiAgICBdO1xuXG4gICAgcmV0dXJuIHJlc291cmNlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWFkIGEgc3BlY2lmaWMgcmVzb3VyY2VcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcmVhZFJlc291cmNlKHVyaTogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgY29udGVudHM6IEFycmF5PHsgdXJpOiBzdHJpbmc7IG1pbWVUeXBlPzogc3RyaW5nOyB0ZXh0Pzogc3RyaW5nIH0+O1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBjb250ZW50OiB1bmtub3duO1xuXG4gICAgICBzd2l0Y2ggKHVyaSkge1xuICAgICAgICBjYXNlICdkcnVwYWw6Ly9ub2Rlcyc6XG4gICAgICAgICAgY29udGVudCA9IGF3YWl0IHRoaXMuZHJ1cGFsQ2xpZW50LmdldE5vZGVzKHsgbGltaXQ6IDEwIH0pO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ2RydXBhbDovL2VudGl0aWVzJzpcbiAgICAgICAgICBjb250ZW50ID0gYXdhaXQgdGhpcy5kcnVwYWxDbGllbnQucXVlcnlFbnRpdGllcygnbm9kZScsIHVuZGVmaW5lZCwge1xuICAgICAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEludGVncmF0aW9uRXJyb3IoXG4gICAgICAgICAgICBJbnRlZ3JhdGlvbkVycm9yVHlwZS5WQUxJREFUSU9OX0VSUk9SLFxuICAgICAgICAgICAgYFVua25vd24gcmVzb3VyY2UgVVJJOiAke3VyaX1gLFxuICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgJ3VyaScsXG4gICAgICAgICAgICB7IHZhbGlkVXJpczogWydkcnVwYWw6Ly9ub2RlcycsICdkcnVwYWw6Ly9lbnRpdGllcyddIH0sXG4gICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICBmYWxzZVxuICAgICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRlbnRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdXJpLFxuICAgICAgICAgICAgbWltZVR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgIHRleHQ6IEpTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsIDIpLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBpbnRlZ3JhdGlvbkVycm9yID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBJbnRlZ3JhdGlvbkVycm9yXG4gICAgICAgICAgPyBlcnJvclxuICAgICAgICAgIDogbm9ybWFsaXplRXJyb3IoZXJyb3IsIGBSZWFkaW5nIHJlc291cmNlOiAke3VyaX1gKTtcblxuICAgICAgLy8gTG9nIHRoZSBlcnJvciBmb3IgZGVidWdnaW5nXG4gICAgICBjb25zdCBsb2dEYXRhID0gZm9ybWF0RXJyb3JGb3JMb2dnaW5nKGludGVncmF0aW9uRXJyb3IsIHsgdXJpIH0pO1xuICAgICAgY29uc29sZVtsb2dEYXRhLmxldmVsXShsb2dEYXRhLm1lc3NhZ2UsIGxvZ0RhdGEubWV0YSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRlbnRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdXJpLFxuICAgICAgICAgICAgbWltZVR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgIHRleHQ6IEpTT04uc3RyaW5naWZ5KFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IGludGVncmF0aW9uRXJyb3IuZXJyb3JUeXBlLFxuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogaW50ZWdyYXRpb25FcnJvci5nZXRVc2VyRnJpZW5kbHlNZXNzYWdlKCksXG4gICAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICAgIHRlY2huaWNhbF9tZXNzYWdlOiBpbnRlZ3JhdGlvbkVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICByZXRyeWFibGU6IGludGVncmF0aW9uRXJyb3IucmV0cnlhYmxlLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAyXG4gICAgICAgICAgICApLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYXZhaWxhYmxlIHRvb2xzXG4gICAqL1xuICBwcml2YXRlIGdldFRvb2xzKCk6IE1jcFRvb2xbXSB7XG4gICAgY29uc3QgYXV0aFRvb2xzOiBNY3BUb29sW10gPSBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdhdXRoX2xvZ2luJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdBdXRoZW50aWNhdGUgd2l0aCBEcnVwYWxpemUubWUgT0F1dGgnLFxuICAgICAgICBpbnB1dFNjaGVtYToge1xuICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHt9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2F1dGhfc3RhdHVzJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdDaGVjayBjdXJyZW50IGF1dGhlbnRpY2F0aW9uIHN0YXR1cycsXG4gICAgICAgIGlucHV0U2NoZW1hOiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge30sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnYXV0aF9sb2dvdXQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0xvZ291dCBhbmQgY2xlYXIgc3RvcmVkIHRva2VucycsXG4gICAgICAgIGlucHV0U2NoZW1hOiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge30sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIF07XG5cbiAgICBjb25zdCBkYXRhVG9vbHM6IE1jcFRvb2xbXSA9IFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2xvYWRfbm9kZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnTG9hZCBhIERydXBhbCBub2RlIGJ5IElEJyxcbiAgICAgICAgaW5wdXRTY2hlbWE6IHtcbiAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICBub2RlSWQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogWydzdHJpbmcnLCAnbnVtYmVyJ10sXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGhlIG5vZGUgSUQgdG8gbG9hZCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVxdWlyZWQ6IFsnbm9kZUlkJ10sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnY3JlYXRlX25vZGUnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZSBhIG5ldyBEcnVwYWwgbm9kZScsXG4gICAgICAgIGlucHV0U2NoZW1hOiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgdHlwZToge1xuICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUaGUgbm9kZSB0eXBlIChlLmcuLCBcImFydGljbGVcIiwgXCJwYWdlXCIpJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUaGUgbm9kZSB0aXRsZScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYm9keToge1xuICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUaGUgbm9kZSBib2R5IGNvbnRlbnQnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnV2hldGhlciB0aGUgbm9kZSBpcyBwdWJsaXNoZWQnLFxuICAgICAgICAgICAgICBkZWZhdWx0OiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlcXVpcmVkOiBbJ3R5cGUnLCAndGl0bGUnXSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdzZWFyY2hfbm9kZXMnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1NlYXJjaCBmb3IgRHJ1cGFsIG5vZGVzJyxcbiAgICAgICAgaW5wdXRTY2hlbWE6IHtcbiAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICB0eXBlOiB7XG4gICAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0ZpbHRlciBieSBub2RlIHR5cGUnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRmlsdGVyIGJ5IHB1Ymxpc2hlZCBzdGF0dXMnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbWl0OiB7XG4gICAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ01heGltdW0gbnVtYmVyIG9mIHJlc3VsdHMnLFxuICAgICAgICAgICAgICBkZWZhdWx0OiAxMCxcbiAgICAgICAgICAgICAgbWluaW11bTogMSxcbiAgICAgICAgICAgICAgbWF4aW11bTogMTAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ3Rlc3RfY29ubmVjdGlvbicsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBjb25uZWN0aW9uIHRvIERydXBhbCBzZXJ2ZXInLFxuICAgICAgICBpbnB1dFNjaGVtYToge1xuICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHt9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ3NlYXJjaF90dXRvcmlhbHMnLFxuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnU2VhcmNoIERydXBhbGl6ZS5tZSB0dXRvcmlhbHMgd2l0aCBmaWx0ZXJpbmcgYnkgY29udGVudCB0eXBlcywgRHJ1cGFsIHZlcnNpb25zLCBjYXRlZ29yaWVzLCBhbmQgc29ydGluZyBvcHRpb25zJyxcbiAgICAgICAgaW5wdXRTY2hlbWE6IHtcbiAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICBrZXl3b3Jkczoge1xuICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdTZWFyY2gga2V5d29yZHMgKG1pbmltdW0gMiBjaGFyYWN0ZXJzKScsXG4gICAgICAgICAgICAgIG1pbkxlbmd0aDogMixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0eXBlczoge1xuICAgICAgICAgICAgICB0eXBlOiAnYXJyYXknLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgICAgICAnRmlsdGVyIGJ5IGNvbnRlbnQgdHlwZXMgKGRlZmF1bHRzIHRvIFtcInR1dG9yaWFsXCIsIFwidG9waWNcIiwgXCJjb3Vyc2VcIl0pJyxcbiAgICAgICAgICAgICAgaXRlbXM6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICBlbnVtOiBbJ3R1dG9yaWFsJywgJ3RvcGljJywgJ2NvdXJzZScsICd2aWRlbycsICdndWlkZSddLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRydXBhbF92ZXJzaW9uOiB7XG4gICAgICAgICAgICAgIHR5cGU6ICdhcnJheScsXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRmlsdGVyIGJ5IERydXBhbCB2ZXJzaW9ucycsXG4gICAgICAgICAgICAgIGl0ZW1zOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICAgICAgZW51bTogWyc5JywgJzEwJywgJzExJ10sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2F0ZWdvcnk6IHtcbiAgICAgICAgICAgICAgdHlwZTogJ2FycmF5JyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdGaWx0ZXIgYnkgdHV0b3JpYWwgY2F0ZWdvcmllcy90YWdzJyxcbiAgICAgICAgICAgICAgaXRlbXM6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzb3J0OiB7XG4gICAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1NvcnQgcmVzdWx0cyBieSByZWxldmFuY2UsIGRhdGUsIG9yIHRpdGxlJyxcbiAgICAgICAgICAgICAgZW51bTogWydzZWFyY2hfYXBpX3JlbGV2YW5jZScsICdjcmVhdGVkJywgJ2NoYW5nZWQnLCAndGl0bGUnXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYWdlOiB7XG4gICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1BhZ2luYXRpb24gc2V0dGluZ3MnLFxuICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgbGltaXQ6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOdW1iZXIgb2YgcmVzdWx0cyBwZXIgcGFnZScsXG4gICAgICAgICAgICAgICAgICBtaW5pbXVtOiAxLFxuICAgICAgICAgICAgICAgICAgbWF4aW11bTogMTAwLFxuICAgICAgICAgICAgICAgICAgZGVmYXVsdDogMTAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvZmZzZXQ6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOdW1iZXIgb2YgcmVzdWx0cyB0byBza2lwJyxcbiAgICAgICAgICAgICAgICAgIG1pbmltdW06IDAsXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OiAwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVxdWlyZWQ6IFsna2V5d29yZHMnXSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgXTtcblxuICAgIHJldHVybiBbLi4uYXV0aFRvb2xzLCAuLi5kYXRhVG9vbHNdO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYSB0b29sIHdpdGggYXV0aGVudGljYXRpb25cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVRvb2xXaXRoQXV0aChcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgYXJnczogdW5rbm93blxuICApOiBQcm9taXNlPHsgY29udGVudDogQXJyYXk8eyB0eXBlOiBzdHJpbmc7IHRleHQ6IHN0cmluZyB9PiB9PiB7XG4gICAgY29uc3QgcmVxdWVzdElkID0gdGhpcy5nZW5lcmF0ZVJlcXVlc3RJZCgpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEhhbmRsZSBhdXRoZW50aWNhdGlvbiB0b29scyBzZXBhcmF0ZWx5XG4gICAgICBpZiAobmFtZS5zdGFydHNXaXRoKCdhdXRoXycpKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdXRoVG9vbChuYW1lLCBhcmdzKTtcbiAgICAgIH1cblxuICAgICAgLy8gRm9yIGRhdGEgdG9vbHMsIHJlcXVpcmUgYXV0aGVudGljYXRpb24gKHVubGVzcyBza2lwcGVkKVxuICAgICAgaWYgKCF0aGlzLmNvbmZpZy5hdXRoLnNraXBBdXRoKSB7XG4gICAgICAgIGNvbnN0IGF1dGhDb250ZXh0ID0gYXdhaXQgdGhpcy5yZXF1aXJlQXV0aGVudGljYXRpb24oKTtcblxuICAgICAgICBpZiAoIWF1dGhDb250ZXh0LmlzQXV0aGVudGljYXRlZCkge1xuICAgICAgICAgIHRocm93IG5ldyBBdXRoZW50aWNhdGlvblJlcXVpcmVkRXJyb3IoXG4gICAgICAgICAgICAnUGxlYXNlIGF1dGhlbnRpY2F0ZSBmaXJzdCB1c2luZyBhdXRoX2xvZ2luIHRvb2wnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBEcnVwYWwgY2xpZW50IHdpdGggYWNjZXNzIHRva2VuXG4gICAgICAgIGlmIChhdXRoQ29udGV4dC5hY2Nlc3NUb2tlbikge1xuICAgICAgICAgIHRoaXMuZHJ1cGFsQ2xpZW50LnNldEFjY2Vzc1Rva2VuKGF1dGhDb250ZXh0LmFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlVG9vbChuYW1lLCBhcmdzKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQXV0aGVudGljYXRpb25SZXF1aXJlZEVycm9yKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY29udGVudDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgIHRleHQ6IEpTT04uc3RyaW5naWZ5KFxuICAgICAgICAgICAgICAgIGNyZWF0ZU1jcEVycm9yUmVzcG9uc2UocmVxdWVzdElkLCBlcnJvciksXG4gICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAyXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGF1dGhlbnRpY2F0aW9uIHRvb2xzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVBdXRoVG9vbChcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgYXJnczogdW5rbm93blxuICApOiBQcm9taXNlPHsgY29udGVudDogQXJyYXk8eyB0eXBlOiBzdHJpbmc7IHRleHQ6IHN0cmluZyB9PiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCByZXN1bHQ6IHVua25vd247XG5cbiAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICBjYXNlICdhdXRoX2xvZ2luJzpcbiAgICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVBdXRoTG9naW4oKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdhdXRoX3N0YXR1cyc6XG4gICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5leGVjdXRlQXV0aFN0YXR1cygpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ2F1dGhfbG9nb3V0JzpcbiAgICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVBdXRoTG9nb3V0KCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gYXV0aCB0b29sOiAke25hbWV9YCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRlbnQ6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICB0ZXh0OiBKU09OLnN0cmluZ2lmeShyZXN1bHQsIG51bGwsIDIpLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBpbnRlZ3JhdGlvbkVycm9yID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBJbnRlZ3JhdGlvbkVycm9yXG4gICAgICAgICAgPyBlcnJvclxuICAgICAgICAgIDogbm9ybWFsaXplRXJyb3IoZXJyb3IsIGBFeGVjdXRpbmcgYXV0aCB0b29sOiAke25hbWV9YCk7XG5cbiAgICAgIGNvbnN0IGxvZ0RhdGEgPSBmb3JtYXRFcnJvckZvckxvZ2dpbmcoaW50ZWdyYXRpb25FcnJvciwge1xuICAgICAgICB0b29sOiBuYW1lLFxuICAgICAgICBhcmdzLFxuICAgICAgfSk7XG4gICAgICBjb25zb2xlW2xvZ0RhdGEubGV2ZWxdKGxvZ0RhdGEubWVzc2FnZSwgbG9nRGF0YS5tZXRhKTtcblxuICAgICAgcmV0dXJuIGZvcm1hdE1jcEVycm9yUmVzcG9uc2UoaW50ZWdyYXRpb25FcnJvciwgdGhpcy5nZW5lcmF0ZVJlcXVlc3RJZCgpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBkYXRhIHRvb2xzIChvcmlnaW5hbCBleGVjdXRlVG9vbCBtZXRob2QpXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVUb29sKFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBhcmdzOiB1bmtub3duXG4gICk6IFByb21pc2U8eyBjb250ZW50OiBBcnJheTx7IHR5cGU6IHN0cmluZzsgdGV4dDogc3RyaW5nIH0+IH0+IHtcbiAgICBjb25zdCByZXF1ZXN0SWQgPSB0aGlzLmdlbmVyYXRlUmVxdWVzdElkKCk7XG5cbiAgICB0cnkge1xuICAgICAgbGV0IHJlc3VsdDogdW5rbm93bjtcblxuICAgICAgc3dpdGNoIChuYW1lKSB7XG4gICAgICAgIGNhc2UgJ2xvYWRfbm9kZSc6XG4gICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5leGVjdXRlTG9hZE5vZGUoYXJncyk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnY3JlYXRlX25vZGUnOlxuICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZUNyZWF0ZU5vZGUoYXJncyk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnc2VhcmNoX25vZGVzJzpcbiAgICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTZWFyY2hOb2RlcyhhcmdzKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICd0ZXN0X2Nvbm5lY3Rpb24nOlxuICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVRlc3RDb25uZWN0aW9uKCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnc2VhcmNoX3R1dG9yaWFscyc6XG4gICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5leGVjdXRlU2VhcmNoVHV0b3JpYWxzKGFyZ3MpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEludGVncmF0aW9uRXJyb3IoXG4gICAgICAgICAgICBJbnRlZ3JhdGlvbkVycm9yVHlwZS5WQUxJREFUSU9OX0VSUk9SLFxuICAgICAgICAgICAgYFVua25vd24gdG9vbDogJHtuYW1lfWAsXG4gICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAnbmFtZScsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHZhbGlkVG9vbHM6IFtcbiAgICAgICAgICAgICAgICAnbG9hZF9ub2RlJyxcbiAgICAgICAgICAgICAgICAnY3JlYXRlX25vZGUnLFxuICAgICAgICAgICAgICAgICdzZWFyY2hfbm9kZXMnLFxuICAgICAgICAgICAgICAgICd0ZXN0X2Nvbm5lY3Rpb24nLFxuICAgICAgICAgICAgICAgICdzZWFyY2hfdHV0b3JpYWxzJyxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgcmVxdWVzdGVkVG9vbDogbmFtZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICBmYWxzZVxuICAgICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRlbnQ6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICB0ZXh0OiBKU09OLnN0cmluZ2lmeShyZXN1bHQsIG51bGwsIDIpLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBpbnRlZ3JhdGlvbkVycm9yID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBJbnRlZ3JhdGlvbkVycm9yXG4gICAgICAgICAgPyBlcnJvclxuICAgICAgICAgIDogbm9ybWFsaXplRXJyb3IoZXJyb3IsIGBFeGVjdXRpbmcgdG9vbDogJHtuYW1lfWAsIHJlcXVlc3RJZCk7XG5cbiAgICAgIC8vIExvZyB0aGUgZXJyb3IgZm9yIGRlYnVnZ2luZ1xuICAgICAgY29uc3QgbG9nRGF0YSA9IGZvcm1hdEVycm9yRm9yTG9nZ2luZyhpbnRlZ3JhdGlvbkVycm9yLCB7XG4gICAgICAgIHRvb2w6IG5hbWUsXG4gICAgICAgIGFyZ3MsXG4gICAgICB9KTtcbiAgICAgIGNvbnNvbGVbbG9nRGF0YS5sZXZlbF0obG9nRGF0YS5tZXNzYWdlLCBsb2dEYXRhLm1ldGEpO1xuXG4gICAgICByZXR1cm4gZm9ybWF0TWNwRXJyb3JSZXNwb25zZShpbnRlZ3JhdGlvbkVycm9yLCByZXF1ZXN0SWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGxvYWQgbm9kZSB0b29sXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVMb2FkTm9kZShhcmdzOiB1bmtub3duKTogUHJvbWlzZTx1bmtub3duPiB7XG4gICAgaWYgKCFhcmdzIHx8IHR5cGVvZiBhcmdzICE9PSAnb2JqZWN0JyB8fCAhKCdub2RlSWQnIGluIGFyZ3MpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ25vZGVJZCBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHsgbm9kZUlkIH0gPSBhcmdzIGFzIHsgbm9kZUlkOiBzdHJpbmcgfCBudW1iZXIgfTtcbiAgICByZXR1cm4gdGhpcy5kcnVwYWxDbGllbnQubG9hZE5vZGUobm9kZUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGNyZWF0ZSBub2RlIHRvb2xcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZUNyZWF0ZU5vZGUoYXJnczogdW5rbm93bik6IFByb21pc2U8dW5rbm93bj4ge1xuICAgIGlmICghYXJncyB8fCB0eXBlb2YgYXJncyAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhcmd1bWVudHMnKTtcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICB0eXBlLFxuICAgICAgdGl0bGUsXG4gICAgICBib2R5LFxuICAgICAgc3RhdHVzID0gdHJ1ZSxcbiAgICB9ID0gYXJncyBhcyB7XG4gICAgICB0eXBlOiBzdHJpbmc7XG4gICAgICB0aXRsZTogc3RyaW5nO1xuICAgICAgYm9keT86IHN0cmluZztcbiAgICAgIHN0YXR1cz86IGJvb2xlYW47XG4gICAgfTtcblxuICAgIGlmICghdHlwZSB8fCAhdGl0bGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigndHlwZSBhbmQgdGl0bGUgYXJlIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZHJ1cGFsQ2xpZW50LmNyZWF0ZU5vZGUoeyB0eXBlLCB0aXRsZSwgYm9keSwgc3RhdHVzIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgc2VhcmNoIG5vZGVzIHRvb2xcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVNlYXJjaE5vZGVzKGFyZ3M6IHVua25vd24pOiBQcm9taXNlPHVua25vd24+IHtcbiAgICBjb25zdCBvcHRpb25zID1cbiAgICAgIChhcmdzIGFzIHsgdHlwZT86IHN0cmluZzsgc3RhdHVzPzogYm9vbGVhbjsgbGltaXQ/OiBudW1iZXIgfSkgfHwge307XG4gICAgcmV0dXJuIHRoaXMuZHJ1cGFsQ2xpZW50LmdldE5vZGVzKG9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgdGVzdCBjb25uZWN0aW9uIHRvb2xcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVRlc3RDb25uZWN0aW9uKCk6IFByb21pc2U8e1xuICAgIGNvbm5lY3RlZDogYm9vbGVhbjtcbiAgICBjb25maWc6IHVua25vd247XG4gIH0+IHtcbiAgICBjb25zdCBjb25uZWN0ZWQgPSBhd2FpdCB0aGlzLmRydXBhbENsaWVudC50ZXN0Q29ubmVjdGlvbigpO1xuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuZHJ1cGFsQ2xpZW50LmdldENvbmZpZygpO1xuXG4gICAgcmV0dXJuIHsgY29ubmVjdGVkLCBjb25maWcgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGF1dGhlbnRpY2F0aW9uIGxvZ2luIHVzaW5nIG5ldyBNQ1AgT0F1dGggcHJvdmlkZXJcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZUF1dGhMb2dpbigpOiBQcm9taXNlPHVua25vd24+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVXNlIHRoZSBuZXcgTUNQIE9BdXRoIHByb3ZpZGVyIGZvciBhdXRoZW50aWNhdGlvblxuICAgICAgY29uc3QgdG9rZW5zID0gYXdhaXQgdGhpcy5tY3BPQXV0aFByb3ZpZGVyLmF1dGhvcml6ZSgpO1xuICAgICAgY29uc3QgdXNlcklkID0gJ2RlZmF1bHQnOyAvLyBJbiBwcm9kdWN0aW9uLCBkZXJpdmUgZnJvbSB0b2tlbiBvciB1c2VyIGlucHV0XG5cbiAgICAgIC8vIENvbnZlcnQgTUNQIFNESyB0b2tlbnMgdG8gbGVnYWN5IHRva2VuIGZvcm1hdCBmb3IgY29tcGF0aWJpbGl0eVxuICAgICAgY29uc3QgbGVnYWN5VG9rZW5zID0ge1xuICAgICAgICBhY2Nlc3NUb2tlbjogdG9rZW5zLmFjY2Vzc190b2tlbixcbiAgICAgICAgcmVmcmVzaFRva2VuOiB0b2tlbnMucmVmcmVzaF90b2tlbixcbiAgICAgICAgdG9rZW5UeXBlOiB0b2tlbnMudG9rZW5fdHlwZSB8fCAnQmVhcmVyJyxcbiAgICAgICAgZXhwaXJlc0luOiB0b2tlbnMuZXhwaXJlc19pbixcbiAgICAgICAgc2NvcGU6IHRva2Vucy5zY29wZSxcbiAgICAgIH07XG5cbiAgICAgIC8vIFN0b3JlIHRva2VucyB1c2luZyBib3RoIG9sZCBhbmQgbmV3IHN5c3RlbXMgZm9yIGNvbXBhdGliaWxpdHlcbiAgICAgIGF3YWl0IHRoaXMudG9rZW5NYW5hZ2VyLnN0b3JlVG9rZW5zKFxuICAgICAgICBsZWdhY3lUb2tlbnMsXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgdGhpcy5jb25maWcuYXV0aC5yZXF1aXJlZFNjb3Blc1xuICAgICAgKTtcbiAgICAgIGF3YWl0IHRoaXMubWNwT0F1dGhQcm92aWRlci5zYXZlVG9rZW5zKHRva2Vucyk7XG5cbiAgICAgIC8vIFNldCBhY2Nlc3MgdG9rZW4gb24gRHJ1cGFsIGNsaWVudCBmb3IgaW1tZWRpYXRlIHVzZVxuICAgICAgdGhpcy5kcnVwYWxDbGllbnQuc2V0QWNjZXNzVG9rZW4odG9rZW5zLmFjY2Vzc190b2tlbik7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6XG4gICAgICAgICAgJ0F1dGhlbnRpY2F0aW9uIHN1Y2Nlc3NmdWwgdXNpbmcgT0F1dGggMi4xIHN0YXRlbGVzcyBjb25maWd1cmF0aW9uJyxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBzY29wZXM6IHRoaXMuY29uZmlnLmF1dGgucmVxdWlyZWRTY29wZXMsXG4gICAgICAgIHByb3ZpZGVyOiAnTWNwT0F1dGhQcm92aWRlcicsXG4gICAgICAgIGVuZHBvaW50c0Rpc2NvdmVyZWQ6ICEhdGhpcy5jb25maWcub2F1dGguZGlzY292ZXJlZEVuZHBvaW50cyxcbiAgICAgICAgaXNGYWxsYmFjazogdGhpcy5jb25maWcub2F1dGguZGlzY292ZXJlZEVuZHBvaW50cz8uaXNGYWxsYmFjayxcbiAgICAgICAgdG9rZW5FeHBpcnk6IHRva2Vucy5leHBpcmVzX2luXG4gICAgICAgICAgPyBEYXRlLm5vdygpICsgdG9rZW5zLmV4cGlyZXNfaW4gKiAxMDAwXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcsXG4gICAgICAgIGhpbnQ6ICdNYWtlIHN1cmUgdG8gY29tcGxldGUgdGhlIE9BdXRoIGZsb3cgaW4geW91ciBicm93c2VyLiBDaGVjayB0aGF0IERSVVBBTF9CQVNFX1VSTCBhbmQgT0FVVEhfQ0xJRU5UX0lEIGFyZSBzZXQgY29ycmVjdGx5LicsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGF1dGhlbnRpY2F0aW9uIHN0YXR1cyBjaGVja1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlQXV0aFN0YXR1cygpOiBQcm9taXNlPHVua25vd24+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdG9rZW5JbmZvID0gYXdhaXQgdGhpcy50b2tlbk1hbmFnZXIuZ2V0VG9rZW5JbmZvKCk7XG4gICAgICBjb25zdCBtY3BUb2tlbkluZm8gPSBhd2FpdCB0aGlzLm1jcE9BdXRoUHJvdmlkZXIuZ2V0VG9rZW5JbmZvKCk7XG4gICAgICBjb25zdCBoYXNWYWxpZFRva2VucyA9IGF3YWl0IHRoaXMubWNwT0F1dGhQcm92aWRlci5oYXNWYWxpZFRva2VucygpO1xuICAgICAgY29uc3QgYXV0aENvbnRleHQgPSBhd2FpdCB0aGlzLnJlcXVpcmVBdXRoZW50aWNhdGlvbigpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc0F1dGhlbnRpY2F0ZWQ6IGF1dGhDb250ZXh0LmlzQXV0aGVudGljYXRlZCxcbiAgICAgICAgdXNlcklkOiBhdXRoQ29udGV4dC51c2VySWQsXG4gICAgICAgIHNjb3BlczogYXV0aENvbnRleHQuc2NvcGVzLFxuICAgICAgICB0b2tlbkluZm8sXG4gICAgICAgIG1jcFByb3ZpZGVyOiB7XG4gICAgICAgICAgaGFzVmFsaWRUb2tlbnMsXG4gICAgICAgICAgdG9rZW5JbmZvOiBtY3BUb2tlbkluZm8sXG4gICAgICAgIH0sXG4gICAgICAgIHByb3ZpZGVyOiAnTWNwT0F1dGhQcm92aWRlciAoT0F1dGggMi4xIFN0YXRlbGVzcyknLFxuICAgICAgICBjb25maWdJbmZvOiB7XG4gICAgICAgICAgZW5kcG9pbnRzRGlzY292ZXJlZDogISF0aGlzLmNvbmZpZy5vYXV0aC5kaXNjb3ZlcmVkRW5kcG9pbnRzLFxuICAgICAgICAgIGlzRmFsbGJhY2s6IHRoaXMuY29uZmlnLm9hdXRoLmRpc2NvdmVyZWRFbmRwb2ludHM/LmlzRmFsbGJhY2ssXG4gICAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiB0aGlzLmNvbmZpZy5vYXV0aC5hdXRob3JpemF0aW9uRW5kcG9pbnQsXG4gICAgICAgICAgdG9rZW5FbmRwb2ludDogdGhpcy5jb25maWcub2F1dGgudG9rZW5FbmRwb2ludCxcbiAgICAgICAgICBza2lwQXV0aDogdGhpcy5jb25maWcuYXV0aC5za2lwQXV0aCxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzQXV0aGVudGljYXRlZDogZmFsc2UsXG4gICAgICAgIGVycm9yOlxuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3JcbiAgICAgICAgICAgID8gZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgOiAnRmFpbGVkIHRvIGNoZWNrIGF1dGggc3RhdHVzJyxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYXV0aGVudGljYXRpb24gbG9nb3V0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVBdXRoTG9nb3V0KCk6IFByb21pc2U8dW5rbm93bj4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnRva2VuTWFuYWdlci5jbGVhclRva2VucygpO1xuICAgICAgYXdhaXQgdGhpcy5tY3BPQXV0aFByb3ZpZGVyLmNsZWFyVG9rZW5zKCk7XG4gICAgICB0aGlzLmRydXBhbENsaWVudC5jbGVhckFjY2Vzc1Rva2VuKCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdMb2dvdXQgc3VjY2Vzc2Z1bCAtIGNsZWFyZWQgYWxsIHRva2VucyAoT0F1dGggMi4xIHN0YXRlbGVzcyknLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdMb2dvdXQgZmFpbGVkJyxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgc2VhcmNoIHR1dG9yaWFscyB0b29sXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVTZWFyY2hUdXRvcmlhbHMoXG4gICAgYXJnczogdW5rbm93blxuICApOiBQcm9taXNlPFNlYXJjaENvbnRlbnRSZXNwb25zZT4ge1xuICAgIC8vIFZhbGlkYXRlIGFuZCBwcm9jZXNzIGlucHV0IHBhcmFtZXRlcnMgdXNpbmcgbmV3IHZhbGlkYXRpb24gZnVuY3Rpb25cbiAgICBjb25zdCBwcm9jZXNzZWRQYXJhbXMgPSB2YWxpZGF0ZVNlYXJjaENvbnRlbnRQYXJhbXMoYXJncyk7XG5cbiAgICAvLyBJbiB0ZXN0IGVudmlyb25tZW50IG9yIHdoZW4gRHJ1cGFsIGlzIHVuYXZhaWxhYmxlLCByZXR1cm4gbW9jayBkYXRhXG4gICAgaWYgKHRoaXMuY29uZmlnLmVudmlyb25tZW50ID09PSAndGVzdCcgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0Jykge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0TW9ja1NlYXJjaENvbnRlbnRSZXN1bHRzKHByb2Nlc3NlZFBhcmFtcyk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIE1ha2UgcmVhbCBKU09OLVJQQyBjYWxsIHRvIERydXBhbCBlbmRwb2ludCB1c2luZyBuZXcgcGFyYW1ldGVyIHN0cnVjdHVyZVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmRydXBhbENsaWVudC5zZWFyY2hUdXRvcmlhbHMoe1xuICAgICAgICBrZXl3b3JkczogcHJvY2Vzc2VkUGFyYW1zLmtleXdvcmRzLFxuICAgICAgICB0eXBlczogcHJvY2Vzc2VkUGFyYW1zLnR5cGVzLFxuICAgICAgICBkcnVwYWxfdmVyc2lvbjogcHJvY2Vzc2VkUGFyYW1zLmRydXBhbF92ZXJzaW9uLFxuICAgICAgICBjYXRlZ29yeTogcHJvY2Vzc2VkUGFyYW1zLmNhdGVnb3J5LFxuICAgICAgICBzb3J0OiBwcm9jZXNzZWRQYXJhbXMuc29ydCxcbiAgICAgICAgcGFnZTogcHJvY2Vzc2VkUGFyYW1zLnBhZ2UsXG4gICAgICB9KTtcblxuICAgICAgLy8gUHJvY2VzcyBhbmQgZm9ybWF0IHRoZSByZXNwb25zZSBmb3IgTUNQIGNvbnN1bXB0aW9uXG4gICAgICBjb25zdCByZXN1bHRzOiBUdXRvcmlhbFNlYXJjaFJlc3VsdFtdID0gcmVzcG9uc2UucmVzdWx0cy5tYXAoXG4gICAgICAgIHR1dG9yaWFsID0+ICh7XG4gICAgICAgICAgaWQ6IHR1dG9yaWFsLmlkLFxuICAgICAgICAgIHRpdGxlOiB0dXRvcmlhbC50aXRsZSxcbiAgICAgICAgICB1cmw6IHR1dG9yaWFsLnVybCxcbiAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgIHR1dG9yaWFsLmRlc2NyaXB0aW9uIHx8XG4gICAgICAgICAgICB0aGlzLmV4dHJhY3REZXNjcmlwdGlvbkZyb21Db250ZW50KHR1dG9yaWFsLmNvbnRlbnQpLFxuICAgICAgICAgIGRydXBhbF92ZXJzaW9uOiB0dXRvcmlhbC5kcnVwYWxfdmVyc2lvbixcbiAgICAgICAgICB0YWdzOiB0dXRvcmlhbC50YWdzLFxuICAgICAgICAgIGRpZmZpY3VsdHk6IHR1dG9yaWFsLmRpZmZpY3VsdHkgYXNcbiAgICAgICAgICAgIHwgJ2JlZ2lubmVyJ1xuICAgICAgICAgICAgfCAnaW50ZXJtZWRpYXRlJ1xuICAgICAgICAgICAgfCAnYWR2YW5jZWQnXG4gICAgICAgICAgICB8IHVuZGVmaW5lZCxcbiAgICAgICAgICBjcmVhdGVkOiB0dXRvcmlhbC5jcmVhdGVkLFxuICAgICAgICAgIHVwZGF0ZWQ6IHR1dG9yaWFsLnVwZGF0ZWQsXG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXN1bHRzLFxuICAgICAgICB0b3RhbDogcmVzcG9uc2UudG90YWwsXG4gICAgICAgIGZhY2V0czogcmVzcG9uc2UuZmFjZXRzLFxuICAgICAgICBxdWVyeTogcHJvY2Vzc2VkUGFyYW1zLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gQ29udmVydCBhbnkgdmFsaWRhdGlvbiBlcnJvcnMgdG8gSW50ZWdyYXRpb25FcnJvclxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgVmFsaWRhdGlvbkVycm9yKSB7XG4gICAgICAgIHRocm93IG5ldyBJbnRlZ3JhdGlvbkVycm9yKFxuICAgICAgICAgIEludGVncmF0aW9uRXJyb3JUeXBlLlZBTElEQVRJT05fRVJST1IsXG4gICAgICAgICAgZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgZXJyb3IuZmllbGQsXG4gICAgICAgICAgeyBwcm9jZXNzZWRQYXJhbXMgfSxcbiAgICAgICAgICBlcnJvcixcbiAgICAgICAgICBmYWxzZVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgSW50ZWdyYXRpb25FcnJvcnMgZnJvbSB0aGUgRHJ1cGFsQ2xpZW50XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBJbnRlZ3JhdGlvbkVycm9yKSB7XG4gICAgICAgIC8vIEluIHByb2R1Y3Rpb24sIHJlLXRocm93IHRoZSBlcnJvcjsgaW4gZGV2ZWxvcG1lbnQsIGxvZyBhbmQgcmV0dXJuIG1vY2sgZGF0YSBmb3IgY2VydGFpbiBlcnJvciB0eXBlc1xuICAgICAgICBpZiAodGhpcy5jb25maWcuZW52aXJvbm1lbnQgPT09ICdwcm9kdWN0aW9uJyB8fCAhZXJyb3IucmV0cnlhYmxlKSB7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGYWxsYmFjayB0byBtb2NrIGRhdGEgaWYgdGhlIHJlYWwgZW5kcG9pbnQgaXMgdW5hdmFpbGFibGUgYW5kIGVycm9yIGlzIHJldHJ5YWJsZVxuICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgYEFQSSB1bmF2YWlsYWJsZSAoJHtlcnJvci5lcnJvclR5cGV9KSwgcmV0dXJuaW5nIG1vY2sgZGF0YTogJHtlcnJvci5tZXNzYWdlfWBcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TW9ja1NlYXJjaENvbnRlbnRSZXN1bHRzKHByb2Nlc3NlZFBhcmFtcyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBhbnkgb3RoZXIgdW5leHBlY3RlZCBlcnJvcnNcbiAgICAgIGNvbnN0IGludGVncmF0aW9uRXJyb3IgPSBub3JtYWxpemVFcnJvcihlcnJvciwgJ1R1dG9yaWFsIHNlYXJjaCcpO1xuXG4gICAgICAvLyBJbiBwcm9kdWN0aW9uLCByZS10aHJvdzsgaW4gZGV2ZWxvcG1lbnQsIHJldHVybiBtb2NrIGRhdGEgZm9yIG5ldHdvcmstcmVsYXRlZCBlcnJvcnNcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5lbnZpcm9ubWVudCA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIHRocm93IGludGVncmF0aW9uRXJyb3I7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgYFVuZXhwZWN0ZWQgZXJyb3IsIHJldHVybmluZyBtb2NrIGRhdGE6ICR7aW50ZWdyYXRpb25FcnJvci5tZXNzYWdlfWBcbiAgICAgICk7XG4gICAgICByZXR1cm4gdGhpcy5nZXRNb2NrU2VhcmNoQ29udGVudFJlc3VsdHMocHJvY2Vzc2VkUGFyYW1zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IG1vY2sgc2VhcmNoIHJlc3VsdHMgZm9yIG5ldyBjb250ZW50IEFQSSAodGVzdGluZyBhbmQgZmFsbGJhY2sgc2NlbmFyaW9zKVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRNb2NrU2VhcmNoQ29udGVudFJlc3VsdHMoXG4gICAgcHJvY2Vzc2VkUGFyYW1zOiBQcm9jZXNzZWRTZWFyY2hDb250ZW50UGFyYW1zXG4gICk6IFNlYXJjaENvbnRlbnRSZXNwb25zZSB7XG4gICAgLy8gQ3JlYXRlIG1vY2sgcmVzdWx0cyB0aGF0IHN1cHBvcnQgZmlsdGVyaW5nXG4gICAgY29uc3QgYWxsTW9ja1Jlc3VsdHM6IFR1dG9yaWFsU2VhcmNoUmVzdWx0W10gPSBbXG4gICAgICB7XG4gICAgICAgIGlkOiAnMScsXG4gICAgICAgIHRpdGxlOiBgVHV0b3JpYWwgYWJvdXQgJHtwcm9jZXNzZWRQYXJhbXMua2V5d29yZHN9YCxcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9kcnVwYWxpemUubWUvdHV0b3JpYWwvc2FtcGxlLXR1dG9yaWFsJyxcbiAgICAgICAgZGVzY3JpcHRpb246IGBBIGNvbXByZWhlbnNpdmUgdHV0b3JpYWwgY292ZXJpbmcgJHtwcm9jZXNzZWRQYXJhbXMua2V5d29yZHN9IGNvbmNlcHRzYCxcbiAgICAgICAgZHJ1cGFsX3ZlcnNpb246IFsnMTAnLCAnMTEnXSxcbiAgICAgICAgdGFnczpcbiAgICAgICAgICBwcm9jZXNzZWRQYXJhbXMuY2F0ZWdvcnkgJiYgcHJvY2Vzc2VkUGFyYW1zLmNhdGVnb3J5Lmxlbmd0aCA+IDBcbiAgICAgICAgICAgID8gcHJvY2Vzc2VkUGFyYW1zLmNhdGVnb3J5XG4gICAgICAgICAgICA6IFsndHV0b3JpYWwnLCAnZHJ1cGFsJ10sXG4gICAgICAgIGRpZmZpY3VsdHk6ICdpbnRlcm1lZGlhdGUnLFxuICAgICAgICBjcmVhdGVkOiAnMjAyNC0wMS0wMVQwMDowMDowMFonLFxuICAgICAgICB1cGRhdGVkOiAnMjAyNC0wNi0wMVQwMDowMDowMFonLFxuICAgICAgfSxcbiAgICAgIC8vIEFkZCBhIERydXBhbCA5IHNwZWNpZmljIHR1dG9yaWFsIGZvciB0ZXN0aW5nIGZpbHRlcmluZ1xuICAgICAge1xuICAgICAgICBpZDogJzInLFxuICAgICAgICB0aXRsZTogYERydXBhbCA5IHNwZWNpZmljIHR1dG9yaWFsIGFib3V0ICR7cHJvY2Vzc2VkUGFyYW1zLmtleXdvcmRzfWAsXG4gICAgICAgIHVybDogJ2h0dHBzOi8vZHJ1cGFsaXplLm1lL3R1dG9yaWFsL2RydXBhbDktdHV0b3JpYWwnLFxuICAgICAgICBkZXNjcmlwdGlvbjogYExlZ2FjeSB0dXRvcmlhbCBmb3IgJHtwcm9jZXNzZWRQYXJhbXMua2V5d29yZHN9IGluIERydXBhbCA5YCxcbiAgICAgICAgZHJ1cGFsX3ZlcnNpb246IFsnOSddLFxuICAgICAgICB0YWdzOlxuICAgICAgICAgIHByb2Nlc3NlZFBhcmFtcy5jYXRlZ29yeSAmJiBwcm9jZXNzZWRQYXJhbXMuY2F0ZWdvcnkubGVuZ3RoID4gMFxuICAgICAgICAgICAgPyBbLi4ucHJvY2Vzc2VkUGFyYW1zLmNhdGVnb3J5LCAnZHJ1cGFsLTknXVxuICAgICAgICAgICAgOiBbJ3R1dG9yaWFsJywgJ2RydXBhbCcsICdkcnVwYWwtOSddLFxuICAgICAgICBkaWZmaWN1bHR5OiAnaW50ZXJtZWRpYXRlJyxcbiAgICAgICAgY3JlYXRlZDogJzIwMjMtMDEtMDFUMDA6MDA6MDBaJyxcbiAgICAgICAgdXBkYXRlZDogJzIwMjMtMDYtMDFUMDA6MDA6MDBaJyxcbiAgICAgIH0sXG4gICAgXTtcblxuICAgIC8vIEZpbHRlciByZXN1bHRzIGJ5IGRydXBhbF92ZXJzaW9uIGlmIHNwZWNpZmllZFxuICAgIGNvbnN0IGZpbHRlcmVkUmVzdWx0cyA9XG4gICAgICBwcm9jZXNzZWRQYXJhbXMuZHJ1cGFsX3ZlcnNpb24gJiZcbiAgICAgIHByb2Nlc3NlZFBhcmFtcy5kcnVwYWxfdmVyc2lvbi5sZW5ndGggPiAwXG4gICAgICAgID8gYWxsTW9ja1Jlc3VsdHMuZmlsdGVyKHJlc3VsdCA9PlxuICAgICAgICAgICAgcHJvY2Vzc2VkUGFyYW1zLmRydXBhbF92ZXJzaW9uIS5zb21lKHZlcnNpb24gPT5cbiAgICAgICAgICAgICAgcmVzdWx0LmRydXBhbF92ZXJzaW9uPy5pbmNsdWRlcyh2ZXJzaW9uKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgOiBhbGxNb2NrUmVzdWx0cy5zbGljZSgwLCAxKTsgLy8gUmV0dXJuIG9ubHkgdGhlIGZpcnN0IHJlc3VsdCB3aGVuIG5vIHZlcnNpb24gZmlsdGVyIGlzIGFwcGxpZWRcblxuICAgIHJldHVybiB7XG4gICAgICByZXN1bHRzOiBmaWx0ZXJlZFJlc3VsdHMsXG4gICAgICB0b3RhbDogZmlsdGVyZWRSZXN1bHRzLmxlbmd0aCxcbiAgICAgIGZhY2V0czoge1xuICAgICAgICBkcnVwYWxfdmVyc2lvbjoge1xuICAgICAgICAgICc5JzogMSxcbiAgICAgICAgICAnMTAnOiAxLFxuICAgICAgICAgICcxMSc6IDEsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRlbnRfdHlwZToge1xuICAgICAgICAgIHR1dG9yaWFsOiAyLFxuICAgICAgICAgIHRvcGljOiAwLFxuICAgICAgICAgIGNvdXJzZTogMCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBxdWVyeTogcHJvY2Vzc2VkUGFyYW1zLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdCBkZXNjcmlwdGlvbiBmcm9tIHR1dG9yaWFsIGNvbnRlbnQgZm9yIFJBRyBvcHRpbWl6YXRpb25cbiAgICovXG4gIHByaXZhdGUgZXh0cmFjdERlc2NyaXB0aW9uRnJvbUNvbnRlbnQoY29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBFeHRyYWN0IGZpcnN0IHBhcmFncmFwaCBvciBmaXJzdCAyMDAgY2hhcmFjdGVycyBhcyBkZXNjcmlwdGlvblxuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJykuZmlsdGVyKGxpbmUgPT4gbGluZS50cmltKCkpO1xuICAgIGNvbnN0IGZpcnN0Q29udGVudExpbmUgPSBsaW5lcy5maW5kKFxuICAgICAgbGluZSA9PiAhbGluZS5zdGFydHNXaXRoKCcjJykgJiYgbGluZS50cmltKCkubGVuZ3RoID4gMFxuICAgICk7XG5cbiAgICBpZiAoZmlyc3RDb250ZW50TGluZSkge1xuICAgICAgcmV0dXJuIGZpcnN0Q29udGVudExpbmUubGVuZ3RoID4gMjAwXG4gICAgICAgID8gYCR7Zmlyc3RDb250ZW50TGluZS5zdWJzdHJpbmcoMCwgMTk3KX0uLi5gXG4gICAgICAgIDogZmlyc3RDb250ZW50TGluZTtcbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjazogcmV0dXJuIGZpcnN0IDIwMCBjaGFyYWN0ZXJzXG4gICAgcmV0dXJuIGAke2NvbnRlbnQuc3Vic3RyaW5nKDAsIDE5Nyl9Li4uYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYXZhaWxhYmxlIHByb21wdHNcbiAgICovXG4gIHByaXZhdGUgZ2V0UHJvbXB0cygpOiBNY3BQcm9tcHRbXSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2RydXBhbF9jb250ZW50X3N1bW1hcnknLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0dlbmVyYXRlIGEgc3VtbWFyeSBvZiBEcnVwYWwgY29udGVudCcsXG4gICAgICAgIGFyZ3VtZW50czogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdjb250ZW50X3R5cGUnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUeXBlIG9mIGNvbnRlbnQgdG8gc3VtbWFyaXplJyxcbiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdsaW1pdCcsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ01heGltdW0gbnVtYmVyIG9mIGl0ZW1zIHRvIGluY2x1ZGUnLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgIF07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgc3BlY2lmaWMgcHJvbXB0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldFByb21wdChcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgYXJncz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gICk6IFByb21pc2U8e1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgbWVzc2FnZXM6IEFycmF5PHsgcm9sZTogc3RyaW5nOyBjb250ZW50OiB7IHR5cGU6IHN0cmluZzsgdGV4dDogc3RyaW5nIH0gfT47XG4gIH0+IHtcbiAgICBzd2l0Y2ggKG5hbWUpIHtcbiAgICAgIGNhc2UgJ2RydXBhbF9jb250ZW50X3N1bW1hcnknOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXREcnVwYWxDb250ZW50U3VtbWFyeVByb21wdChhcmdzKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBwcm9tcHQ6ICR7bmFtZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IERydXBhbCBjb250ZW50IHN1bW1hcnkgcHJvbXB0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldERydXBhbENvbnRlbnRTdW1tYXJ5UHJvbXB0KFxuICAgIGFyZ3M/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuICApOiBQcm9taXNlPHtcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIG1lc3NhZ2VzOiBBcnJheTx7IHJvbGU6IHN0cmluZzsgY29udGVudDogeyB0eXBlOiBzdHJpbmc7IHRleHQ6IHN0cmluZyB9IH0+O1xuICB9PiB7XG4gICAgY29uc3QgY29udGVudFR5cGUgPSBhcmdzPy5jb250ZW50X3R5cGUgYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGNvbnN0IGxpbWl0ID0gKGFyZ3M/LmxpbWl0IGFzIG51bWJlcikgfHwgMTA7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgbm9kZXMgPSBhd2FpdCB0aGlzLmRydXBhbENsaWVudC5nZXROb2Rlcyh7XG4gICAgICAgIHR5cGU6IGNvbnRlbnRUeXBlLFxuICAgICAgICBsaW1pdCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb250ZW50ID0gYEhlcmUgYXJlIHRoZSByZWNlbnQgRHJ1cGFsIG5vZGVzJHtjb250ZW50VHlwZSA/IGAgb2YgdHlwZSBcIiR7Y29udGVudFR5cGV9XCJgIDogJyd9OlxcblxcbiR7bm9kZXNcbiAgICAgICAgLm1hcChcbiAgICAgICAgICAobm9kZSwgaW5kZXgpID0+XG4gICAgICAgICAgICBgJHtpbmRleCArIDF9LiAke25vZGUuYXR0cmlidXRlcy50aXRsZX0gKElEOiAke25vZGUuYXR0cmlidXRlcy5uaWR9KWBcbiAgICAgICAgKVxuICAgICAgICAuam9pbignXFxuJyl9XFxuXFxuUGxlYXNlIHByb3ZpZGUgYSBzdW1tYXJ5IG9mIHRoaXMgY29udGVudC5gO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBkZXNjcmlwdGlvbjogYFN1bW1hcnkgb2YgRHJ1cGFsIGNvbnRlbnQke2NvbnRlbnRUeXBlID8gYCAoJHtjb250ZW50VHlwZX0pYCA6ICcnfWAsXG4gICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgIHRleHQ6IGNvbnRlbnQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIERydXBhbENsaWVudEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcik7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAnRXJyb3IgZ2VuZXJhdGluZyBEcnVwYWwgY29udGVudCBzdW1tYXJ5JyxcbiAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICByb2xlOiAndXNlcicsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgdGV4dDogYEVycm9yIGZldGNoaW5nIERydXBhbCBjb250ZW50OiAke2Vycm9yTWVzc2FnZX1gLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB1bmRlcmx5aW5nIHNlcnZlciBpbnN0YW5jZVxuICAgKi9cbiAgZ2V0U2VydmVyKCk6IFNlcnZlciB7XG4gICAgcmV0dXJuIHRoaXMuc2VydmVyO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbm5lY3QgdGhlIHNlcnZlciB0byBhIHRyYW5zcG9ydFxuICAgKi9cbiAgYXN5bmMgY29ubmVjdCh0cmFuc3BvcnQ6IFRyYW5zcG9ydCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuc2VydmVyLmNvbm5lY3QodHJhbnNwb3J0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZSB0aGUgc2VydmVyXG4gICAqL1xuICBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnNlcnZlci5jbG9zZSgpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=