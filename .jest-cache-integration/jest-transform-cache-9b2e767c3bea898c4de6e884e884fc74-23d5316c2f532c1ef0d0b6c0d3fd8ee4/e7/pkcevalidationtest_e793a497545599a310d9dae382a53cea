94737ccb8c3c56577b3dfae7af51feae
"use strict";
/**
 * PKCE Business Logic Tests
 *
 * Tests application-specific PKCE functionality:
 * - Authorization flow with PKCE
 * - Token exchange using PKCE
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const oauth_client_js_1 = require("@/auth/oauth-client.js");
const http_1 = require("http");
(0, globals_1.describe)('PKCE Business Logic Tests', () => {
    let mockOAuthServer;
    let serverPort;
    let oauthClient;
    (0, globals_1.beforeAll)(async () => {
        mockOAuthServer = await createPKCETestServer();
        const address = mockOAuthServer.address();
        serverPort = address.port;
        oauthClient = new oauth_client_js_1.OAuthClient({
            clientId: 'test-client-id',
            authorizationEndpoint: `http://localhost:${serverPort}/oauth/authorize`,
            tokenEndpoint: `http://localhost:${serverPort}/oauth/token`,
            redirectUri: 'http://127.0.0.1:3000/callback',
            scopes: ['tutorial:read', 'user:profile'],
        });
    });
    (0, globals_1.afterAll)(async () => {
        if (mockOAuthServer) {
            await new Promise(resolve => {
                mockOAuthServer.close(() => resolve());
            });
        }
    });
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
        clearServerState();
    });
    (0, globals_1.describe)('Authorization Request with PKCE', () => {
        (0, globals_1.test)('should include PKCE parameters in authorization URL', () => {
            const challenge = oauthClient.generatePKCEChallenge();
            const buildAuthUrlMethod = oauthClient.buildAuthorizationUrl.bind(oauthClient);
            const authUrl = buildAuthUrlMethod({
                codeChallenge: challenge.codeChallenge,
                codeChallengeMethod: challenge.codeChallengeMethod,
                state: 'test-state',
                redirectUri: 'http://127.0.0.1:3000/callback',
            });
            const url = new URL(authUrl);
            (0, globals_1.expect)(url.searchParams.get('code_challenge')).toBe(challenge.codeChallenge);
            (0, globals_1.expect)(url.searchParams.get('code_challenge_method')).toBe('S256');
        });
    });
    (0, globals_1.describe)('Token Request with PKCE', () => {
        (0, globals_1.test)('should include code verifier in token exchange request', async () => {
            const challenge = oauthClient.generatePKCEChallenge();
            const authCode = 'test_authorization_code';
            setMockTokenResponse({
                accessToken: 'access_token_123',
                refreshToken: 'refresh_token_456',
                tokenType: 'Bearer',
                expiresIn: 3600,
            });
            // Store the challenge for server verification
            setExpectedPKCE(challenge);
            const exchangeMethod = oauthClient.exchangeCodeForTokens.bind(oauthClient);
            const tokens = await exchangeMethod(authCode, challenge.codeVerifier);
            (0, globals_1.expect)(tokens.accessToken).toBe('access_token_123');
            // Verify the server received correct PKCE parameters
            (0, globals_1.expect)(getLastTokenRequest()).toEqual(globals_1.expect.objectContaining({
                grant_type: 'authorization_code',
                client_id: 'test-client-id',
                code: authCode,
                redirect_uri: 'http://127.0.0.1:3000/callback',
                code_verifier: challenge.codeVerifier,
            }));
        });
    });
});
// Mock server implementation for PKCE testing
let expectedPKCE = null;
let mockTokenResponse = null;
let mockTokenError = null;
let lastTokenRequest = null;
function setExpectedPKCE(challenge) {
    expectedPKCE = challenge;
}
function setMockTokenResponse(tokens) {
    mockTokenResponse = tokens;
    mockTokenError = null;
}
function setMockTokenError(status, error) {
    mockTokenError = { status, error };
    mockTokenResponse = null;
}
function getLastTokenRequest() {
    return lastTokenRequest;
}
function clearServerState() {
    expectedPKCE = null;
    mockTokenResponse = null;
    mockTokenError = null;
    lastTokenRequest = null;
}
async function createPKCETestServer() {
    return new Promise(resolve => {
        const server = (0, http_1.createServer)((req, res) => {
            const url = new URL(req.url || '', `http://localhost`);
            if (url.pathname === '/oauth/token' && req.method === 'POST') {
                handlePKCETokenRequest(req, res);
            }
            else if (url.pathname === '/oauth/authorize' && req.method === 'GET') {
                handleAuthorizeRequest(req, res);
            }
            else {
                res.writeHead(404);
                res.end('Not found');
            }
        });
        server.listen(0, '127.0.0.1', () => {
            resolve(server);
        });
    });
}
function handlePKCETokenRequest(req, res) {
    let body = '';
    req.on('data', (chunk) => {
        body += chunk.toString();
    });
    req.on('end', () => {
        const params = new URLSearchParams(body);
        lastTokenRequest = Object.fromEntries(params.entries());
        // Validate PKCE if expected
        if (expectedPKCE) {
            const codeVerifier = params.get('code_verifier');
            if (!codeVerifier) {
                res.writeHead(400, { 'Content-Type': 'application/json' });
                res.end(JSON.stringify({
                    error: 'invalid_request',
                    error_description: 'Missing code_verifier',
                }));
                return;
            }
            // Simple PKCE validation for testing business logic
            if (codeVerifier !== expectedPKCE.codeVerifier) {
                res.writeHead(400, { 'Content-Type': 'application/json' });
                res.end(JSON.stringify({
                    error: 'invalid_grant',
                    error_description: 'PKCE verification failed',
                }));
                return;
            }
        }
        // Return configured response
        if (mockTokenError) {
            res.writeHead(mockTokenError.status, {
                'Content-Type': 'application/json',
            });
            res.end(JSON.stringify({ error: mockTokenError.error }));
            return;
        }
        if (mockTokenResponse) {
            res.writeHead(200, { 'Content-Type': 'application/json' });
            res.end(JSON.stringify({
                access_token: mockTokenResponse.accessToken,
                refresh_token: mockTokenResponse.refreshToken,
                token_type: mockTokenResponse.tokenType,
                expires_in: mockTokenResponse.expiresIn,
                scope: mockTokenResponse.scope,
            }));
            return;
        }
        res.writeHead(500, { 'Content-Type': 'application/json' });
        res.end(JSON.stringify({ error: 'server_error' }));
    });
}
function handleAuthorizeRequest(req, res) {
    const url = new URL(req.url || '', `http://localhost`);
    const redirectUri = url.searchParams.get('redirect_uri');
    const state = url.searchParams.get('state');
    if (redirectUri && state) {
        const callbackUrl = new URL(redirectUri);
        callbackUrl.searchParams.set('code', 'test_auth_code');
        callbackUrl.searchParams.set('state', state);
        res.writeHead(302, { Location: callbackUrl.toString() });
        res.end();
    }
    else {
        res.writeHead(400);
        res.end('Invalid request');
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9wa2NlLXZhbGlkYXRpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOztBQUVILDJDQVN1QjtBQUN2Qiw0REFBcUQ7QUFFckQsK0JBQW9DO0FBSXBDLElBQUEsa0JBQVEsRUFBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7SUFDekMsSUFBSSxlQUF1QixDQUFDO0lBQzVCLElBQUksVUFBa0IsQ0FBQztJQUN2QixJQUFJLFdBQXdCLENBQUM7SUFFN0IsSUFBQSxtQkFBUyxFQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25CLGVBQWUsR0FBRyxNQUFNLG9CQUFvQixFQUFFLENBQUM7UUFDL0MsTUFBTSxPQUFPLEdBQUcsZUFBZSxDQUFDLE9BQU8sRUFBaUIsQ0FBQztRQUN6RCxVQUFVLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUUxQixXQUFXLEdBQUcsSUFBSSw2QkFBVyxDQUFDO1lBQzVCLFFBQVEsRUFBRSxnQkFBZ0I7WUFDMUIscUJBQXFCLEVBQUUsb0JBQW9CLFVBQVUsa0JBQWtCO1lBQ3ZFLGFBQWEsRUFBRSxvQkFBb0IsVUFBVSxjQUFjO1lBQzNELFdBQVcsRUFBRSxnQ0FBZ0M7WUFDN0MsTUFBTSxFQUFFLENBQUMsZUFBZSxFQUFFLGNBQWMsQ0FBQztTQUMxQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxLQUFLLElBQUksRUFBRTtRQUNsQixJQUFJLGVBQWUsRUFBRSxDQUFDO1lBQ3BCLE1BQU0sSUFBSSxPQUFPLENBQU8sT0FBTyxDQUFDLEVBQUU7Z0JBQ2hDLGVBQWUsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN6QyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsb0JBQVUsRUFBQyxHQUFHLEVBQUU7UUFDZCxjQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7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YWNlL3Rlc3RzL2ludGVncmF0aW9uL3BrY2UtdmFsaWRhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUEtDRSBCdXNpbmVzcyBMb2dpYyBUZXN0c1xuICpcbiAqIFRlc3RzIGFwcGxpY2F0aW9uLXNwZWNpZmljIFBLQ0UgZnVuY3Rpb25hbGl0eTpcbiAqIC0gQXV0aG9yaXphdGlvbiBmbG93IHdpdGggUEtDRVxuICogLSBUb2tlbiBleGNoYW5nZSB1c2luZyBQS0NFXG4gKi9cblxuaW1wb3J0IHtcbiAgZGVzY3JpYmUsXG4gIHRlc3QsXG4gIGV4cGVjdCxcbiAgYmVmb3JlRWFjaCxcbiAgYWZ0ZXJFYWNoLFxuICBqZXN0LFxuICBiZWZvcmVBbGwsXG4gIGFmdGVyQWxsLFxufSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB7IE9BdXRoQ2xpZW50IH0gZnJvbSAnQC9hdXRoL29hdXRoLWNsaWVudC5qcyc7XG5pbXBvcnQgdHlwZSB7IE9BdXRoVG9rZW5zLCBQS0NFQ2hhbGxlbmdlIH0gZnJvbSAnQC9hdXRoL29hdXRoLWNsaWVudC5qcyc7XG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXIgfSBmcm9tICdodHRwJztcbmltcG9ydCB0eXBlIHsgU2VydmVyIH0gZnJvbSAnaHR0cCc7XG5pbXBvcnQgdHlwZSB7IEFkZHJlc3NJbmZvIH0gZnJvbSAnbmV0JztcblxuZGVzY3JpYmUoJ1BLQ0UgQnVzaW5lc3MgTG9naWMgVGVzdHMnLCAoKSA9PiB7XG4gIGxldCBtb2NrT0F1dGhTZXJ2ZXI6IFNlcnZlcjtcbiAgbGV0IHNlcnZlclBvcnQ6IG51bWJlcjtcbiAgbGV0IG9hdXRoQ2xpZW50OiBPQXV0aENsaWVudDtcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tPQXV0aFNlcnZlciA9IGF3YWl0IGNyZWF0ZVBLQ0VUZXN0U2VydmVyKCk7XG4gICAgY29uc3QgYWRkcmVzcyA9IG1vY2tPQXV0aFNlcnZlci5hZGRyZXNzKCkgYXMgQWRkcmVzc0luZm87XG4gICAgc2VydmVyUG9ydCA9IGFkZHJlc3MucG9ydDtcblxuICAgIG9hdXRoQ2xpZW50ID0gbmV3IE9BdXRoQ2xpZW50KHtcbiAgICAgIGNsaWVudElkOiAndGVzdC1jbGllbnQtaWQnLFxuICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9L29hdXRoL2F1dGhvcml6ZWAsXG4gICAgICB0b2tlbkVuZHBvaW50OiBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9L29hdXRoL3Rva2VuYCxcbiAgICAgIHJlZGlyZWN0VXJpOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2NhbGxiYWNrJyxcbiAgICAgIHNjb3BlczogWyd0dXRvcmlhbDpyZWFkJywgJ3VzZXI6cHJvZmlsZSddLFxuICAgIH0pO1xuICB9KTtcblxuICBhZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgaWYgKG1vY2tPQXV0aFNlcnZlcikge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4ocmVzb2x2ZSA9PiB7XG4gICAgICAgIG1vY2tPQXV0aFNlcnZlci5jbG9zZSgoKSA9PiByZXNvbHZlKCkpO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBjbGVhclNlcnZlclN0YXRlKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBdXRob3JpemF0aW9uIFJlcXVlc3Qgd2l0aCBQS0NFJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBpbmNsdWRlIFBLQ0UgcGFyYW1ldGVycyBpbiBhdXRob3JpemF0aW9uIFVSTCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNoYWxsZW5nZSA9IG9hdXRoQ2xpZW50LmdlbmVyYXRlUEtDRUNoYWxsZW5nZSgpO1xuXG4gICAgICBjb25zdCBidWlsZEF1dGhVcmxNZXRob2QgPSAoXG4gICAgICAgIG9hdXRoQ2xpZW50IGFzIGFueVxuICAgICAgKS5idWlsZEF1dGhvcml6YXRpb25VcmwuYmluZChvYXV0aENsaWVudCk7XG4gICAgICBjb25zdCBhdXRoVXJsID0gYnVpbGRBdXRoVXJsTWV0aG9kKHtcbiAgICAgICAgY29kZUNoYWxsZW5nZTogY2hhbGxlbmdlLmNvZGVDaGFsbGVuZ2UsXG4gICAgICAgIGNvZGVDaGFsbGVuZ2VNZXRob2Q6IGNoYWxsZW5nZS5jb2RlQ2hhbGxlbmdlTWV0aG9kLFxuICAgICAgICBzdGF0ZTogJ3Rlc3Qtc3RhdGUnLFxuICAgICAgICByZWRpcmVjdFVyaTogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9jYWxsYmFjaycsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChhdXRoVXJsKTtcblxuICAgICAgZXhwZWN0KHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdjb2RlX2NoYWxsZW5nZScpKS50b0JlKFxuICAgICAgICBjaGFsbGVuZ2UuY29kZUNoYWxsZW5nZVxuICAgICAgKTtcbiAgICAgIGV4cGVjdCh1cmwuc2VhcmNoUGFyYW1zLmdldCgnY29kZV9jaGFsbGVuZ2VfbWV0aG9kJykpLnRvQmUoJ1MyNTYnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Rva2VuIFJlcXVlc3Qgd2l0aCBQS0NFJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBpbmNsdWRlIGNvZGUgdmVyaWZpZXIgaW4gdG9rZW4gZXhjaGFuZ2UgcmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNoYWxsZW5nZSA9IG9hdXRoQ2xpZW50LmdlbmVyYXRlUEtDRUNoYWxsZW5nZSgpO1xuICAgICAgY29uc3QgYXV0aENvZGUgPSAndGVzdF9hdXRob3JpemF0aW9uX2NvZGUnO1xuXG4gICAgICBzZXRNb2NrVG9rZW5SZXNwb25zZSh7XG4gICAgICAgIGFjY2Vzc1Rva2VuOiAnYWNjZXNzX3Rva2VuXzEyMycsXG4gICAgICAgIHJlZnJlc2hUb2tlbjogJ3JlZnJlc2hfdG9rZW5fNDU2JyxcbiAgICAgICAgdG9rZW5UeXBlOiAnQmVhcmVyJyxcbiAgICAgICAgZXhwaXJlc0luOiAzNjAwLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFN0b3JlIHRoZSBjaGFsbGVuZ2UgZm9yIHNlcnZlciB2ZXJpZmljYXRpb25cbiAgICAgIHNldEV4cGVjdGVkUEtDRShjaGFsbGVuZ2UpO1xuXG4gICAgICBjb25zdCBleGNoYW5nZU1ldGhvZCA9IChvYXV0aENsaWVudCBhcyBhbnkpLmV4Y2hhbmdlQ29kZUZvclRva2Vucy5iaW5kKFxuICAgICAgICBvYXV0aENsaWVudFxuICAgICAgKTtcblxuICAgICAgY29uc3QgdG9rZW5zID0gYXdhaXQgZXhjaGFuZ2VNZXRob2QoYXV0aENvZGUsIGNoYWxsZW5nZS5jb2RlVmVyaWZpZXIpO1xuXG4gICAgICBleHBlY3QodG9rZW5zLmFjY2Vzc1Rva2VuKS50b0JlKCdhY2Nlc3NfdG9rZW5fMTIzJyk7XG5cbiAgICAgIC8vIFZlcmlmeSB0aGUgc2VydmVyIHJlY2VpdmVkIGNvcnJlY3QgUEtDRSBwYXJhbWV0ZXJzXG4gICAgICBleHBlY3QoZ2V0TGFzdFRva2VuUmVxdWVzdCgpKS50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZ3JhbnRfdHlwZTogJ2F1dGhvcml6YXRpb25fY29kZScsXG4gICAgICAgICAgY2xpZW50X2lkOiAndGVzdC1jbGllbnQtaWQnLFxuICAgICAgICAgIGNvZGU6IGF1dGhDb2RlLFxuICAgICAgICAgIHJlZGlyZWN0X3VyaTogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9jYWxsYmFjaycsXG4gICAgICAgICAgY29kZV92ZXJpZmllcjogY2hhbGxlbmdlLmNvZGVWZXJpZmllcixcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbi8vIE1vY2sgc2VydmVyIGltcGxlbWVudGF0aW9uIGZvciBQS0NFIHRlc3RpbmdcbmxldCBleHBlY3RlZFBLQ0U6IFBLQ0VDaGFsbGVuZ2UgfCBudWxsID0gbnVsbDtcbmxldCBtb2NrVG9rZW5SZXNwb25zZTogT0F1dGhUb2tlbnMgfCBudWxsID0gbnVsbDtcbmxldCBtb2NrVG9rZW5FcnJvcjogeyBzdGF0dXM6IG51bWJlcjsgZXJyb3I6IHN0cmluZyB9IHwgbnVsbCA9IG51bGw7XG5sZXQgbGFzdFRva2VuUmVxdWVzdDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBzZXRFeHBlY3RlZFBLQ0UoY2hhbGxlbmdlOiBQS0NFQ2hhbGxlbmdlKTogdm9pZCB7XG4gIGV4cGVjdGVkUEtDRSA9IGNoYWxsZW5nZTtcbn1cblxuZnVuY3Rpb24gc2V0TW9ja1Rva2VuUmVzcG9uc2UodG9rZW5zOiBPQXV0aFRva2Vucyk6IHZvaWQge1xuICBtb2NrVG9rZW5SZXNwb25zZSA9IHRva2VucztcbiAgbW9ja1Rva2VuRXJyb3IgPSBudWxsO1xufVxuXG5mdW5jdGlvbiBzZXRNb2NrVG9rZW5FcnJvcihzdGF0dXM6IG51bWJlciwgZXJyb3I6IHN0cmluZyk6IHZvaWQge1xuICBtb2NrVG9rZW5FcnJvciA9IHsgc3RhdHVzLCBlcnJvciB9O1xuICBtb2NrVG9rZW5SZXNwb25zZSA9IG51bGw7XG59XG5cbmZ1bmN0aW9uIGdldExhc3RUb2tlblJlcXVlc3QoKTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IG51bGwge1xuICByZXR1cm4gbGFzdFRva2VuUmVxdWVzdDtcbn1cblxuZnVuY3Rpb24gY2xlYXJTZXJ2ZXJTdGF0ZSgpOiB2b2lkIHtcbiAgZXhwZWN0ZWRQS0NFID0gbnVsbDtcbiAgbW9ja1Rva2VuUmVzcG9uc2UgPSBudWxsO1xuICBtb2NrVG9rZW5FcnJvciA9IG51bGw7XG4gIGxhc3RUb2tlblJlcXVlc3QgPSBudWxsO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVQS0NFVGVzdFNlcnZlcigpOiBQcm9taXNlPFNlcnZlcj4ge1xuICByZXR1cm4gbmV3IFByb21pc2U8U2VydmVyPihyZXNvbHZlID0+IHtcbiAgICBjb25zdCBzZXJ2ZXIgPSBjcmVhdGVTZXJ2ZXIoKHJlcSwgcmVzKSA9PiB7XG4gICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcS51cmwgfHwgJycsIGBodHRwOi8vbG9jYWxob3N0YCk7XG5cbiAgICAgIGlmICh1cmwucGF0aG5hbWUgPT09ICcvb2F1dGgvdG9rZW4nICYmIHJlcS5tZXRob2QgPT09ICdQT1NUJykge1xuICAgICAgICBoYW5kbGVQS0NFVG9rZW5SZXF1ZXN0KHJlcSwgcmVzKTtcbiAgICAgIH0gZWxzZSBpZiAodXJsLnBhdGhuYW1lID09PSAnL29hdXRoL2F1dGhvcml6ZScgJiYgcmVxLm1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICAgICAgaGFuZGxlQXV0aG9yaXplUmVxdWVzdChyZXEsIHJlcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMud3JpdGVIZWFkKDQwNCk7XG4gICAgICAgIHJlcy5lbmQoJ05vdCBmb3VuZCcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2VydmVyLmxpc3RlbigwLCAnMTI3LjAuMC4xJywgKCkgPT4ge1xuICAgICAgcmVzb2x2ZShzZXJ2ZXIpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlUEtDRVRva2VuUmVxdWVzdChyZXE6IGFueSwgcmVzOiBhbnkpOiB2b2lkIHtcbiAgbGV0IGJvZHkgPSAnJztcbiAgcmVxLm9uKCdkYXRhJywgKGNodW5rOiBCdWZmZXIpID0+IHtcbiAgICBib2R5ICs9IGNodW5rLnRvU3RyaW5nKCk7XG4gIH0pO1xuXG4gIHJlcS5vbignZW5kJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoYm9keSk7XG4gICAgbGFzdFRva2VuUmVxdWVzdCA9IE9iamVjdC5mcm9tRW50cmllcyhwYXJhbXMuZW50cmllcygpKTtcblxuICAgIC8vIFZhbGlkYXRlIFBLQ0UgaWYgZXhwZWN0ZWRcbiAgICBpZiAoZXhwZWN0ZWRQS0NFKSB7XG4gICAgICBjb25zdCBjb2RlVmVyaWZpZXIgPSBwYXJhbXMuZ2V0KCdjb2RlX3ZlcmlmaWVyJyk7XG4gICAgICBpZiAoIWNvZGVWZXJpZmllcikge1xuICAgICAgICByZXMud3JpdGVIZWFkKDQwMCwgeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xuICAgICAgICByZXMuZW5kKFxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIGVycm9yOiAnaW52YWxpZF9yZXF1ZXN0JyxcbiAgICAgICAgICAgIGVycm9yX2Rlc2NyaXB0aW9uOiAnTWlzc2luZyBjb2RlX3ZlcmlmaWVyJyxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFNpbXBsZSBQS0NFIHZhbGlkYXRpb24gZm9yIHRlc3RpbmcgYnVzaW5lc3MgbG9naWNcbiAgICAgIGlmIChjb2RlVmVyaWZpZXIgIT09IGV4cGVjdGVkUEtDRS5jb2RlVmVyaWZpZXIpIHtcbiAgICAgICAgcmVzLndyaXRlSGVhZCg0MDAsIHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9KTtcbiAgICAgICAgcmVzLmVuZChcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBlcnJvcjogJ2ludmFsaWRfZ3JhbnQnLFxuICAgICAgICAgICAgZXJyb3JfZGVzY3JpcHRpb246ICdQS0NFIHZlcmlmaWNhdGlvbiBmYWlsZWQnLFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gY29uZmlndXJlZCByZXNwb25zZVxuICAgIGlmIChtb2NrVG9rZW5FcnJvcikge1xuICAgICAgcmVzLndyaXRlSGVhZChtb2NrVG9rZW5FcnJvci5zdGF0dXMsIHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0pO1xuICAgICAgcmVzLmVuZChKU09OLnN0cmluZ2lmeSh7IGVycm9yOiBtb2NrVG9rZW5FcnJvci5lcnJvciB9KSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKG1vY2tUb2tlblJlc3BvbnNlKSB7XG4gICAgICByZXMud3JpdGVIZWFkKDIwMCwgeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xuICAgICAgcmVzLmVuZChcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGFjY2Vzc190b2tlbjogbW9ja1Rva2VuUmVzcG9uc2UuYWNjZXNzVG9rZW4sXG4gICAgICAgICAgcmVmcmVzaF90b2tlbjogbW9ja1Rva2VuUmVzcG9uc2UucmVmcmVzaFRva2VuLFxuICAgICAgICAgIHRva2VuX3R5cGU6IG1vY2tUb2tlblJlc3BvbnNlLnRva2VuVHlwZSxcbiAgICAgICAgICBleHBpcmVzX2luOiBtb2NrVG9rZW5SZXNwb25zZS5leHBpcmVzSW4sXG4gICAgICAgICAgc2NvcGU6IG1vY2tUb2tlblJlc3BvbnNlLnNjb3BlLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICByZXMud3JpdGVIZWFkKDUwMCwgeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xuICAgIHJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogJ3NlcnZlcl9lcnJvcicgfSkpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQXV0aG9yaXplUmVxdWVzdChyZXE6IGFueSwgcmVzOiBhbnkpOiB2b2lkIHtcbiAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsIHx8ICcnLCBgaHR0cDovL2xvY2FsaG9zdGApO1xuICBjb25zdCByZWRpcmVjdFVyaSA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdyZWRpcmVjdF91cmknKTtcbiAgY29uc3Qgc3RhdGUgPSB1cmwuc2VhcmNoUGFyYW1zLmdldCgnc3RhdGUnKTtcblxuICBpZiAocmVkaXJlY3RVcmkgJiYgc3RhdGUpIHtcbiAgICBjb25zdCBjYWxsYmFja1VybCA9IG5ldyBVUkwocmVkaXJlY3RVcmkpO1xuICAgIGNhbGxiYWNrVXJsLnNlYXJjaFBhcmFtcy5zZXQoJ2NvZGUnLCAndGVzdF9hdXRoX2NvZGUnKTtcbiAgICBjYWxsYmFja1VybC5zZWFyY2hQYXJhbXMuc2V0KCdzdGF0ZScsIHN0YXRlKTtcblxuICAgIHJlcy53cml0ZUhlYWQoMzAyLCB7IExvY2F0aW9uOiBjYWxsYmFja1VybC50b1N0cmluZygpIH0pO1xuICAgIHJlcy5lbmQoKTtcbiAgfSBlbHNlIHtcbiAgICByZXMud3JpdGVIZWFkKDQwMCk7XG4gICAgcmVzLmVuZCgnSW52YWxpZCByZXF1ZXN0Jyk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==