7502581a5671de9a28eb6f0f8aaa3a6f
"use strict";
/**
 * MCP Authentication Integration Tests (Fixed version)
 * Testing authentication tools and middleware with direct method calls
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const server_js_1 = require("@/mcp/server.js");
const os_1 = require("os");
(0, globals_1.describe)('MCP Authentication Integration Tests', () => {
    let testConfig;
    let mcpServer;
    let originalHomedir;
    (0, globals_1.beforeAll)(() => {
        originalHomedir = process.env.HOME;
        process.env.HOME = (0, os_1.tmpdir)();
        testConfig = {
            drupal: {
                baseUrl: 'http://localhost/drupal',
                endpoint: '/jsonrpc',
                timeout: 10000,
                retries: 3,
                headers: {
                    'Content-Type': 'application/json',
                    Accept: 'application/json',
                },
            },
            oauth: {
                clientId: 'test-client-id',
                authorizationEndpoint: 'http://localhost/drupal/oauth/authorize',
                tokenEndpoint: 'http://localhost/drupal/oauth/token',
                redirectUri: 'http://127.0.0.1:3000/callback',
                scopes: ['tutorial:read', 'user:profile'],
            },
            auth: {
                enabled: true,
                requiredScopes: ['tutorial:read'],
                skipAuth: false,
            },
            mcp: {
                name: 'test-drupal-bridge-mcp',
                version: '1.0.0-test',
                protocolVersion: '2024-11-05',
                capabilities: {
                    resources: { subscribe: true, listChanged: true },
                    tools: { listChanged: true },
                    prompts: { listChanged: true },
                },
            },
            server: {
                port: 3000,
                host: '0.0.0.0',
            },
            logging: {
                level: 'error',
            },
            environment: 'test',
        };
    });
    (0, globals_1.afterAll)(() => {
        process.env.HOME = originalHomedir;
    });
    (0, globals_1.beforeEach)(async () => {
        mcpServer = new server_js_1.DrupalMcpServer(testConfig);
        // Clean up test tokens before each test
        try {
            const { promises: fs } = await Promise.resolve().then(() => __importStar(require('fs')));
            const { join } = await Promise.resolve().then(() => __importStar(require('path')));
            await fs.rm(join((0, os_1.tmpdir)(), '.drupal-bridge-mcp'), {
                recursive: true,
                force: true,
            });
        }
        catch {
            // Ignore if directory doesn't exist
        }
    });
    (0, globals_1.afterEach)(async () => {
        await mcpServer.close();
    });
    (0, globals_1.describe)('Authentication Tools', () => {
        (0, globals_1.test)('should list authentication tools', async () => {
            // Test tool listing directly
            const tools = mcpServer.getTools();
            const authTools = tools.filter((tool) => tool.name.startsWith('auth_'));
            (0, globals_1.expect)(authTools).toHaveLength(3);
            (0, globals_1.expect)(authTools.some((tool) => tool.name === 'auth_login')).toBe(true);
            (0, globals_1.expect)(authTools.some((tool) => tool.name === 'auth_status')).toBe(true);
            (0, globals_1.expect)(authTools.some((tool) => tool.name === 'auth_logout')).toBe(true);
        });
        (0, globals_1.test)('should handle auth_status without authentication', async () => {
            // Call the auth tool directly
            const response = await mcpServer.executeAuthTool('auth_status', {});
            (0, globals_1.expect)(response.content).toBeDefined();
            (0, globals_1.expect)(response.content[0].type).toBe('text');
            const result = JSON.parse(response.content[0].text);
            (0, globals_1.expect)(result.isAuthenticated).toBe(false);
            (0, globals_1.expect)(result.needsAuthentication).toBe(true);
        });
        (0, globals_1.test)('should handle auth_logout', async () => {
            // Call the auth tool directly
            const response = await mcpServer.executeAuthTool('auth_logout', {});
            (0, globals_1.expect)(response.content).toBeDefined();
            (0, globals_1.expect)(response.content[0].type).toBe('text');
            const result = JSON.parse(response.content[0].text);
            (0, globals_1.expect)(result.success).toBe(true);
            (0, globals_1.expect)(result.message).toBe('Logout successful');
        });
    });
    (0, globals_1.describe)('Authentication Middleware', () => {
        (0, globals_1.test)('should require authentication for protected tools when auth is enabled', async () => {
            // Test with auth enabled config
            const authEnabledConfig = {
                ...testConfig,
                auth: { ...testConfig.auth, enabled: true, skipAuth: false },
            };
            const authServer = new server_js_1.DrupalMcpServer(authEnabledConfig);
            // Call executeToolWithAuth which includes the authentication check
            const response = await authServer.executeToolWithAuth('load_node', { nodeId: '1' });
            // Should return an MCP-formatted error response
            (0, globals_1.expect)(response.content).toBeDefined();
            (0, globals_1.expect)(response.content[0].type).toBe('text');
            const errorResponse = JSON.parse(response.content[0].text);
            (0, globals_1.expect)(errorResponse.error).toBeDefined();
            (0, globals_1.expect)(errorResponse.error.message).toContain('authenticate');
            await authServer.close();
        });
        (0, globals_1.test)('should allow tools when authentication is skipped', async () => {
            const skipAuthConfig = {
                ...testConfig,
                auth: {
                    ...testConfig.auth,
                    skipAuth: true,
                },
            };
            const skipAuthServer = new server_js_1.DrupalMcpServer(skipAuthConfig);
            // This should not require authentication
            const response = await skipAuthServer.executeTool('test_connection', {});
            (0, globals_1.expect)(response.content).toBeDefined();
            (0, globals_1.expect)(response.content[0].type).toBe('text');
            const result = JSON.parse(response.content[0].text);
            // Should succeed without authentication error
            (0, globals_1.expect)(result.connected).toBeDefined();
            (0, globals_1.expect)(result.config).toBeDefined();
            await skipAuthServer.close();
        });
    });
    (0, globals_1.describe)('Session Management', () => {
        (0, globals_1.test)('should create session after successful authentication', async () => {
            // Mock the OAuth client authorize method
            const mockTokens = {
                access_token: 'mock-access-token',
                refresh_token: 'mock-refresh-token',
                token_type: 'Bearer',
                expires_in: 3600,
            };
            globals_1.jest
                .spyOn(mcpServer.oauthClient, 'authorize')
                .mockResolvedValue(mockTokens);
            const response = await mcpServer.executeAuthTool('auth_login', {});
            (0, globals_1.expect)(response.content).toBeDefined();
            const result = JSON.parse(response.content[0].text);
            (0, globals_1.expect)(result.success).toBe(true);
        });
        (0, globals_1.test)('should handle authentication failure gracefully', async () => {
            // Mock the OAuth client to throw an error
            globals_1.jest
                .spyOn(mcpServer.oauthClient, 'authorize')
                .mockRejectedValue(new Error('Authentication failed'));
            const response = await mcpServer.executeAuthTool('auth_login', {});
            (0, globals_1.expect)(response.content).toBeDefined();
            const result = JSON.parse(response.content[0].text);
            (0, globals_1.expect)(result.success).toBe(false);
            (0, globals_1.expect)(result.error).toContain('Authentication failed');
        });
    });
    (0, globals_1.describe)('Token Integration with Drupal Client', () => {
        (0, globals_1.test)('should set access token on Drupal client after authentication', async () => {
            const mockTokens = {
                accessToken: 'test-access-token',
                refreshToken: 'test-refresh-token',
                tokenType: 'Bearer',
                expiresIn: 3600,
            };
            globals_1.jest
                .spyOn(mcpServer.oauthClient, 'authorize')
                .mockResolvedValue(mockTokens);
            globals_1.jest.spyOn(mcpServer.drupalClient, 'setAccessToken');
            // First authenticate
            await mcpServer.executeAuthTool('auth_login', {});
            // Verify that the Drupal client received the access token
            (0, globals_1.expect)(mcpServer.drupalClient.setAccessToken).toHaveBeenCalledWith('test-access-token');
        });
        (0, globals_1.test)('should clear access token on logout', async () => {
            // Set up initial authentication state
            globals_1.jest.spyOn(mcpServer.drupalClient, 'clearAccessToken');
            await mcpServer.executeAuthTool('auth_logout', {});
            (0, globals_1.expect)(mcpServer.drupalClient.clearAccessToken).toHaveBeenCalled();
        });
    });
    (0, globals_1.describe)('Error Handling', () => {
        (0, globals_1.test)('should return proper MCP error format for authentication errors', async () => {
            // Test with auth enabled and no authentication
            const authEnabledConfig = {
                ...testConfig,
                auth: { ...testConfig.auth, enabled: true, skipAuth: false },
            };
            const authServer = new server_js_1.DrupalMcpServer(authEnabledConfig);
            const response = await authServer.executeTool('load_node', {
                nodeId: '1',
            });
            (0, globals_1.expect)(response.content).toBeDefined();
            (0, globals_1.expect)(response.content[0].type).toBe('text');
            const result = JSON.parse(response.content[0].text);
            (0, globals_1.expect)(result.error).toBeDefined();
            (0, globals_1.expect)(result.error.type).toBeDefined();
            await authServer.close();
        });
        (0, globals_1.test)('should handle OAuth flow errors in auth tools', async () => {
            const oauthError = new Error('OAuth flow failed');
            globals_1.jest
                .spyOn(mcpServer.oauthClient, 'authorize')
                .mockRejectedValue(oauthError);
            const response = await mcpServer.executeAuthTool('auth_login', {});
            (0, globals_1.expect)(response.content).toBeDefined();
            const result = JSON.parse(response.content[0].text);
            (0, globals_1.expect)(result.success).toBe(false);
            (0, globals_1.expect)(result.error).toContain('OAuth flow failed');
        });
    });
    (0, globals_1.describe)('Cross-Client Compatibility', () => {
        (0, globals_1.test)('should work consistently across different MCP client environments', async () => {
            // Test tool listing
            const tools = mcpServer.getTools();
            (0, globals_1.expect)(Array.isArray(tools)).toBe(true);
            (0, globals_1.expect)(tools.length).toBeGreaterThan(0);
            // Test auth status
            const authStatusResponse = await mcpServer.executeAuthTool('auth_status', {});
            (0, globals_1.expect)(authStatusResponse.content).toBeDefined();
            (0, globals_1.expect)(authStatusResponse.content[0].type).toBe('text');
            const authStatus = JSON.parse(authStatusResponse.content[0].text);
            (0, globals_1.expect)(typeof authStatus.isAuthenticated).toBe('boolean');
            (0, globals_1.expect)(typeof authStatus.needsAuthentication).toBe('boolean');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cEIsTUFBTSxLQUFLLEdBQUksU0FBaUIsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUM1QyxJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN4QyxJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV4QyxtQkFBbUI7WUFDbkIsTUFBTSxrQkFBa0IsR0FBRyxNQUFPLFNBQWlCLENBQUMsZUFBZSxDQUNqRSxhQUFhLEVBQ2IsRUFBRSxDQUNILENBQUM7WUFDRixJQUFBLGdCQUFNLEVBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDakQsSUFBQSxnQkFBTSxFQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFeEQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEUsSUFBQSxnQkFBTSxFQUFDLE9BQU8sVUFBVSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMxRCxJQUFBLGdCQUFNLEVBQUMsT0FBTyxVQUFVLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDaEUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi93b3Jrc3BhY2UvdGVzdHMvaW50ZWdyYXRpb24vbWNwLWF1dGgudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1DUCBBdXRoZW50aWNhdGlvbiBJbnRlZ3JhdGlvbiBUZXN0cyAoRml4ZWQgdmVyc2lvbilcbiAqIFRlc3RpbmcgYXV0aGVudGljYXRpb24gdG9vbHMgYW5kIG1pZGRsZXdhcmUgd2l0aCBkaXJlY3QgbWV0aG9kIGNhbGxzXG4gKi9cblxuaW1wb3J0IHtcbiAgZGVzY3JpYmUsXG4gIHRlc3QsXG4gIGV4cGVjdCxcbiAgYmVmb3JlQWxsLFxuICBhZnRlckFsbCxcbiAgYmVmb3JlRWFjaCxcbiAgYWZ0ZXJFYWNoLFxuICBqZXN0LFxufSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB7IERydXBhbE1jcFNlcnZlciB9IGZyb20gJ0AvbWNwL3NlcnZlci5qcyc7XG5pbXBvcnQgdHlwZSB7IEFwcENvbmZpZyB9IGZyb20gJ0AvdHlwZXMvaW5kZXguanMnO1xuaW1wb3J0IHsgT0F1dGhDbGllbnQgfSBmcm9tICdAL2F1dGgvaW5kZXguanMnO1xuaW1wb3J0IHsgdG1wZGlyIH0gZnJvbSAnb3MnO1xuXG5kZXNjcmliZSgnTUNQIEF1dGhlbnRpY2F0aW9uIEludGVncmF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICBsZXQgdGVzdENvbmZpZzogQXBwQ29uZmlnO1xuICBsZXQgbWNwU2VydmVyOiBEcnVwYWxNY3BTZXJ2ZXI7XG4gIGxldCBvcmlnaW5hbEhvbWVkaXI6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgIG9yaWdpbmFsSG9tZWRpciA9IHByb2Nlc3MuZW52LkhPTUU7XG4gICAgcHJvY2Vzcy5lbnYuSE9NRSA9IHRtcGRpcigpO1xuXG4gICAgdGVzdENvbmZpZyA9IHtcbiAgICAgIGRydXBhbDoge1xuICAgICAgICBiYXNlVXJsOiAnaHR0cDovL2xvY2FsaG9zdC9kcnVwYWwnLFxuICAgICAgICBlbmRwb2ludDogJy9qc29ucnBjJyxcbiAgICAgICAgdGltZW91dDogMTAwMDAsXG4gICAgICAgIHJldHJpZXM6IDMsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIG9hdXRoOiB7XG4gICAgICAgIGNsaWVudElkOiAndGVzdC1jbGllbnQtaWQnLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwOi8vbG9jYWxob3N0L2RydXBhbC9vYXV0aC9hdXRob3JpemUnLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiAnaHR0cDovL2xvY2FsaG9zdC9kcnVwYWwvb2F1dGgvdG9rZW4nLFxuICAgICAgICByZWRpcmVjdFVyaTogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9jYWxsYmFjaycsXG4gICAgICAgIHNjb3BlczogWyd0dXRvcmlhbDpyZWFkJywgJ3VzZXI6cHJvZmlsZSddLFxuICAgICAgfSxcbiAgICAgIGF1dGg6IHtcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgcmVxdWlyZWRTY29wZXM6IFsndHV0b3JpYWw6cmVhZCddLFxuICAgICAgICBza2lwQXV0aDogZmFsc2UsXG4gICAgICB9LFxuICAgICAgbWNwOiB7XG4gICAgICAgIG5hbWU6ICd0ZXN0LWRydXBhbC1icmlkZ2UtbWNwJyxcbiAgICAgICAgdmVyc2lvbjogJzEuMC4wLXRlc3QnLFxuICAgICAgICBwcm90b2NvbFZlcnNpb246ICcyMDI0LTExLTA1JyxcbiAgICAgICAgY2FwYWJpbGl0aWVzOiB7XG4gICAgICAgICAgcmVzb3VyY2VzOiB7IHN1YnNjcmliZTogdHJ1ZSwgbGlzdENoYW5nZWQ6IHRydWUgfSxcbiAgICAgICAgICB0b29sczogeyBsaXN0Q2hhbmdlZDogdHJ1ZSB9LFxuICAgICAgICAgIHByb21wdHM6IHsgbGlzdENoYW5nZWQ6IHRydWUgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBzZXJ2ZXI6IHtcbiAgICAgICAgcG9ydDogMzAwMCxcbiAgICAgICAgaG9zdDogJzAuMC4wLjAnLFxuICAgICAgfSxcbiAgICAgIGxvZ2dpbmc6IHtcbiAgICAgICAgbGV2ZWw6ICdlcnJvcicgYXMgY29uc3QsXG4gICAgICB9LFxuICAgICAgZW52aXJvbm1lbnQ6ICd0ZXN0JyBhcyBjb25zdCxcbiAgICB9O1xuICB9KTtcblxuICBhZnRlckFsbCgoKSA9PiB7XG4gICAgcHJvY2Vzcy5lbnYuSE9NRSA9IG9yaWdpbmFsSG9tZWRpcjtcbiAgfSk7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgbWNwU2VydmVyID0gbmV3IERydXBhbE1jcFNlcnZlcih0ZXN0Q29uZmlnKTtcblxuICAgIC8vIENsZWFuIHVwIHRlc3QgdG9rZW5zIGJlZm9yZSBlYWNoIHRlc3RcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBwcm9taXNlczogZnMgfSA9IGF3YWl0IGltcG9ydCgnZnMnKTtcbiAgICAgIGNvbnN0IHsgam9pbiB9ID0gYXdhaXQgaW1wb3J0KCdwYXRoJyk7XG4gICAgICBhd2FpdCBmcy5ybShqb2luKHRtcGRpcigpLCAnLmRydXBhbC1icmlkZ2UtbWNwJyksIHtcbiAgICAgICAgcmVjdXJzaXZlOiB0cnVlLFxuICAgICAgICBmb3JjZTogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gSWdub3JlIGlmIGRpcmVjdG9yeSBkb2Vzbid0IGV4aXN0XG4gICAgfVxuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IG1jcFNlcnZlci5jbG9zZSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnQXV0aGVudGljYXRpb24gVG9vbHMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGxpc3QgYXV0aGVudGljYXRpb24gdG9vbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRvb2wgbGlzdGluZyBkaXJlY3RseVxuICAgICAgY29uc3QgdG9vbHMgPSAobWNwU2VydmVyIGFzIGFueSkuZ2V0VG9vbHMoKTtcblxuICAgICAgY29uc3QgYXV0aFRvb2xzID0gdG9vbHMuZmlsdGVyKCh0b29sOiBhbnkpID0+XG4gICAgICAgIHRvb2wubmFtZS5zdGFydHNXaXRoKCdhdXRoXycpXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYXV0aFRvb2xzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QoYXV0aFRvb2xzLnNvbWUoKHRvb2w6IGFueSkgPT4gdG9vbC5uYW1lID09PSAnYXV0aF9sb2dpbicpKS50b0JlKFxuICAgICAgICB0cnVlXG4gICAgICApO1xuICAgICAgZXhwZWN0KGF1dGhUb29scy5zb21lKCh0b29sOiBhbnkpID0+IHRvb2wubmFtZSA9PT0gJ2F1dGhfc3RhdHVzJykpLnRvQmUoXG4gICAgICAgIHRydWVcbiAgICAgICk7XG4gICAgICBleHBlY3QoYXV0aFRvb2xzLnNvbWUoKHRvb2w6IGFueSkgPT4gdG9vbC5uYW1lID09PSAnYXV0aF9sb2dvdXQnKSkudG9CZShcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgYXV0aF9zdGF0dXMgd2l0aG91dCBhdXRoZW50aWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENhbGwgdGhlIGF1dGggdG9vbCBkaXJlY3RseVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCAobWNwU2VydmVyIGFzIGFueSkuZXhlY3V0ZUF1dGhUb29sKFxuICAgICAgICAnYXV0aF9zdGF0dXMnLFxuICAgICAgICB7fVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmNvbnRlbnQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuY29udGVudFswXS50eXBlKS50b0JlKCd0ZXh0Jyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IEpTT04ucGFyc2UocmVzcG9uc2UuY29udGVudFswXS50ZXh0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNBdXRoZW50aWNhdGVkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubmVlZHNBdXRoZW50aWNhdGlvbikudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgYXV0aF9sb2dvdXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDYWxsIHRoZSBhdXRoIHRvb2wgZGlyZWN0bHlcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgKG1jcFNlcnZlciBhcyBhbnkpLmV4ZWN1dGVBdXRoVG9vbChcbiAgICAgICAgJ2F1dGhfbG9nb3V0JyxcbiAgICAgICAge31cbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5jb250ZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmNvbnRlbnRbMF0udHlwZSkudG9CZSgndGV4dCcpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmNvbnRlbnRbMF0udGV4dCk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQmUoJ0xvZ291dCBzdWNjZXNzZnVsJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBdXRoZW50aWNhdGlvbiBNaWRkbGV3YXJlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uIGZvciBwcm90ZWN0ZWQgdG9vbHMgd2hlbiBhdXRoIGlzIGVuYWJsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHdpdGggYXV0aCBlbmFibGVkIGNvbmZpZ1xuICAgICAgY29uc3QgYXV0aEVuYWJsZWRDb25maWcgPSB7XG4gICAgICAgIC4uLnRlc3RDb25maWcsXG4gICAgICAgIGF1dGg6IHsgLi4udGVzdENvbmZpZy5hdXRoLCBlbmFibGVkOiB0cnVlLCBza2lwQXV0aDogZmFsc2UgfSxcbiAgICAgIH07XG4gICAgICBjb25zdCBhdXRoU2VydmVyID0gbmV3IERydXBhbE1jcFNlcnZlcihhdXRoRW5hYmxlZENvbmZpZyk7XG5cbiAgICAgIC8vIENhbGwgZXhlY3V0ZVRvb2xXaXRoQXV0aCB3aGljaCBpbmNsdWRlcyB0aGUgYXV0aGVudGljYXRpb24gY2hlY2tcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgKGF1dGhTZXJ2ZXIgYXMgYW55KS5leGVjdXRlVG9vbFdpdGhBdXRoKFxuICAgICAgICAnbG9hZF9ub2RlJyxcbiAgICAgICAgeyBub2RlSWQ6ICcxJyB9XG4gICAgICApO1xuXG4gICAgICAvLyBTaG91bGQgcmV0dXJuIGFuIE1DUC1mb3JtYXR0ZWQgZXJyb3IgcmVzcG9uc2VcbiAgICAgIGV4cGVjdChyZXNwb25zZS5jb250ZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmNvbnRlbnRbMF0udHlwZSkudG9CZSgndGV4dCcpO1xuXG4gICAgICBjb25zdCBlcnJvclJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXNwb25zZS5jb250ZW50WzBdLnRleHQpO1xuICAgICAgZXhwZWN0KGVycm9yUmVzcG9uc2UuZXJyb3IpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZXJyb3JSZXNwb25zZS5lcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJ2F1dGhlbnRpY2F0ZScpO1xuXG4gICAgICBhd2FpdCBhdXRoU2VydmVyLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgYWxsb3cgdG9vbHMgd2hlbiBhdXRoZW50aWNhdGlvbiBpcyBza2lwcGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2tpcEF1dGhDb25maWcgPSB7XG4gICAgICAgIC4uLnRlc3RDb25maWcsXG4gICAgICAgIGF1dGg6IHtcbiAgICAgICAgICAuLi50ZXN0Q29uZmlnLmF1dGgsXG4gICAgICAgICAgc2tpcEF1dGg6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBza2lwQXV0aFNlcnZlciA9IG5ldyBEcnVwYWxNY3BTZXJ2ZXIoc2tpcEF1dGhDb25maWcpO1xuXG4gICAgICAvLyBUaGlzIHNob3VsZCBub3QgcmVxdWlyZSBhdXRoZW50aWNhdGlvblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCAoc2tpcEF1dGhTZXJ2ZXIgYXMgYW55KS5leGVjdXRlVG9vbChcbiAgICAgICAgJ3Rlc3RfY29ubmVjdGlvbicsXG4gICAgICAgIHt9XG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuY29udGVudCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5jb250ZW50WzBdLnR5cGUpLnRvQmUoJ3RleHQnKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZS5jb250ZW50WzBdLnRleHQpO1xuXG4gICAgICAvLyBTaG91bGQgc3VjY2VlZCB3aXRob3V0IGF1dGhlbnRpY2F0aW9uIGVycm9yXG4gICAgICBleHBlY3QocmVzdWx0LmNvbm5lY3RlZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29uZmlnKS50b0JlRGVmaW5lZCgpO1xuXG4gICAgICBhd2FpdCBza2lwQXV0aFNlcnZlci5jbG9zZSgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2Vzc2lvbiBNYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgc2Vzc2lvbiBhZnRlciBzdWNjZXNzZnVsIGF1dGhlbnRpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayB0aGUgT0F1dGggY2xpZW50IGF1dGhvcml6ZSBtZXRob2RcbiAgICAgIGNvbnN0IG1vY2tUb2tlbnMgPSB7XG4gICAgICAgIGFjY2Vzc190b2tlbjogJ21vY2stYWNjZXNzLXRva2VuJyxcbiAgICAgICAgcmVmcmVzaF90b2tlbjogJ21vY2stcmVmcmVzaC10b2tlbicsXG4gICAgICAgIHRva2VuX3R5cGU6ICdCZWFyZXInLFxuICAgICAgICBleHBpcmVzX2luOiAzNjAwLFxuICAgICAgfTtcblxuICAgICAgamVzdFxuICAgICAgICAuc3B5T24oKG1jcFNlcnZlciBhcyBhbnkpLm9hdXRoQ2xpZW50LCAnYXV0aG9yaXplJylcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUb2tlbnMpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IChtY3BTZXJ2ZXIgYXMgYW55KS5leGVjdXRlQXV0aFRvb2woXG4gICAgICAgICdhdXRoX2xvZ2luJyxcbiAgICAgICAge31cbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5jb250ZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZS5jb250ZW50WzBdLnRleHQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBhdXRoZW50aWNhdGlvbiBmYWlsdXJlIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHRoZSBPQXV0aCBjbGllbnQgdG8gdGhyb3cgYW4gZXJyb3JcbiAgICAgIGplc3RcbiAgICAgICAgLnNweU9uKChtY3BTZXJ2ZXIgYXMgYW55KS5vYXV0aENsaWVudCwgJ2F1dGhvcml6ZScpXG4gICAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcpKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCAobWNwU2VydmVyIGFzIGFueSkuZXhlY3V0ZUF1dGhUb29sKFxuICAgICAgICAnYXV0aF9sb2dpbicsXG4gICAgICAgIHt9XG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuY29udGVudCkudG9CZURlZmluZWQoKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IEpTT04ucGFyc2UocmVzcG9uc2UuY29udGVudFswXS50ZXh0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0NvbnRhaW4oJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVG9rZW4gSW50ZWdyYXRpb24gd2l0aCBEcnVwYWwgQ2xpZW50JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBzZXQgYWNjZXNzIHRva2VuIG9uIERydXBhbCBjbGllbnQgYWZ0ZXIgYXV0aGVudGljYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVG9rZW5zID0ge1xuICAgICAgICBhY2Nlc3NUb2tlbjogJ3Rlc3QtYWNjZXNzLXRva2VuJyxcbiAgICAgICAgcmVmcmVzaFRva2VuOiAndGVzdC1yZWZyZXNoLXRva2VuJyxcbiAgICAgICAgdG9rZW5UeXBlOiAnQmVhcmVyJyxcbiAgICAgICAgZXhwaXJlc0luOiAzNjAwLFxuICAgICAgfTtcblxuICAgICAgamVzdFxuICAgICAgICAuc3B5T24oKG1jcFNlcnZlciBhcyBhbnkpLm9hdXRoQ2xpZW50LCAnYXV0aG9yaXplJylcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUb2tlbnMpO1xuXG4gICAgICBqZXN0LnNweU9uKChtY3BTZXJ2ZXIgYXMgYW55KS5kcnVwYWxDbGllbnQsICdzZXRBY2Nlc3NUb2tlbicpO1xuXG4gICAgICAvLyBGaXJzdCBhdXRoZW50aWNhdGVcbiAgICAgIGF3YWl0IChtY3BTZXJ2ZXIgYXMgYW55KS5leGVjdXRlQXV0aFRvb2woJ2F1dGhfbG9naW4nLCB7fSk7XG5cbiAgICAgIC8vIFZlcmlmeSB0aGF0IHRoZSBEcnVwYWwgY2xpZW50IHJlY2VpdmVkIHRoZSBhY2Nlc3MgdG9rZW5cbiAgICAgIGV4cGVjdChcbiAgICAgICAgKG1jcFNlcnZlciBhcyBhbnkpLmRydXBhbENsaWVudC5zZXRBY2Nlc3NUb2tlblxuICAgICAgKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdC1hY2Nlc3MtdG9rZW4nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBjbGVhciBhY2Nlc3MgdG9rZW4gb24gbG9nb3V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2V0IHVwIGluaXRpYWwgYXV0aGVudGljYXRpb24gc3RhdGVcbiAgICAgIGplc3Quc3B5T24oKG1jcFNlcnZlciBhcyBhbnkpLmRydXBhbENsaWVudCwgJ2NsZWFyQWNjZXNzVG9rZW4nKTtcblxuICAgICAgYXdhaXQgKG1jcFNlcnZlciBhcyBhbnkpLmV4ZWN1dGVBdXRoVG9vbCgnYXV0aF9sb2dvdXQnLCB7fSk7XG5cbiAgICAgIGV4cGVjdChcbiAgICAgICAgKG1jcFNlcnZlciBhcyBhbnkpLmRydXBhbENsaWVudC5jbGVhckFjY2Vzc1Rva2VuXG4gICAgICApLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gcHJvcGVyIE1DUCBlcnJvciBmb3JtYXQgZm9yIGF1dGhlbnRpY2F0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3Qgd2l0aCBhdXRoIGVuYWJsZWQgYW5kIG5vIGF1dGhlbnRpY2F0aW9uXG4gICAgICBjb25zdCBhdXRoRW5hYmxlZENvbmZpZyA9IHtcbiAgICAgICAgLi4udGVzdENvbmZpZyxcbiAgICAgICAgYXV0aDogeyAuLi50ZXN0Q29uZmlnLmF1dGgsIGVuYWJsZWQ6IHRydWUsIHNraXBBdXRoOiBmYWxzZSB9LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGF1dGhTZXJ2ZXIgPSBuZXcgRHJ1cGFsTWNwU2VydmVyKGF1dGhFbmFibGVkQ29uZmlnKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCAoYXV0aFNlcnZlciBhcyBhbnkpLmV4ZWN1dGVUb29sKCdsb2FkX25vZGUnLCB7XG4gICAgICAgIG5vZGVJZDogJzEnLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5jb250ZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmNvbnRlbnRbMF0udHlwZSkudG9CZSgndGV4dCcpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmNvbnRlbnRbMF0udGV4dCk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvci50eXBlKS50b0JlRGVmaW5lZCgpO1xuXG4gICAgICBhd2FpdCBhdXRoU2VydmVyLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIE9BdXRoIGZsb3cgZXJyb3JzIGluIGF1dGggdG9vbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvYXV0aEVycm9yID0gbmV3IEVycm9yKCdPQXV0aCBmbG93IGZhaWxlZCcpO1xuICAgICAgamVzdFxuICAgICAgICAuc3B5T24oKG1jcFNlcnZlciBhcyBhbnkpLm9hdXRoQ2xpZW50LCAnYXV0aG9yaXplJylcbiAgICAgICAgLm1vY2tSZWplY3RlZFZhbHVlKG9hdXRoRXJyb3IpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IChtY3BTZXJ2ZXIgYXMgYW55KS5leGVjdXRlQXV0aFRvb2woXG4gICAgICAgICdhdXRoX2xvZ2luJyxcbiAgICAgICAge31cbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5jb250ZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZS5jb250ZW50WzBdLnRleHQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignT0F1dGggZmxvdyBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Nyb3NzLUNsaWVudCBDb21wYXRpYmlsaXR5JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCB3b3JrIGNvbnNpc3RlbnRseSBhY3Jvc3MgZGlmZmVyZW50IE1DUCBjbGllbnQgZW52aXJvbm1lbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0b29sIGxpc3RpbmdcbiAgICAgIGNvbnN0IHRvb2xzID0gKG1jcFNlcnZlciBhcyBhbnkpLmdldFRvb2xzKCk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheSh0b29scykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodG9vbHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG5cbiAgICAgIC8vIFRlc3QgYXV0aCBzdGF0dXNcbiAgICAgIGNvbnN0IGF1dGhTdGF0dXNSZXNwb25zZSA9IGF3YWl0IChtY3BTZXJ2ZXIgYXMgYW55KS5leGVjdXRlQXV0aFRvb2woXG4gICAgICAgICdhdXRoX3N0YXR1cycsXG4gICAgICAgIHt9XG4gICAgICApO1xuICAgICAgZXhwZWN0KGF1dGhTdGF0dXNSZXNwb25zZS5jb250ZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGF1dGhTdGF0dXNSZXNwb25zZS5jb250ZW50WzBdLnR5cGUpLnRvQmUoJ3RleHQnKTtcblxuICAgICAgY29uc3QgYXV0aFN0YXR1cyA9IEpTT04ucGFyc2UoYXV0aFN0YXR1c1Jlc3BvbnNlLmNvbnRlbnRbMF0udGV4dCk7XG4gICAgICBleHBlY3QodHlwZW9mIGF1dGhTdGF0dXMuaXNBdXRoZW50aWNhdGVkKS50b0JlKCdib29sZWFuJyk7XG4gICAgICBleHBlY3QodHlwZW9mIGF1dGhTdGF0dXMubmVlZHNBdXRoZW50aWNhdGlvbikudG9CZSgnYm9vbGVhbicpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9