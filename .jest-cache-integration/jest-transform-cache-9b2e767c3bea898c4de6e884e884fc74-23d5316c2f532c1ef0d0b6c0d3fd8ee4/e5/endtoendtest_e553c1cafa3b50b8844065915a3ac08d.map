{"file":"/workspace/tests/integration/end-to-end.test.ts","mappings":"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","names":[],"sources":["/workspace/tests/integration/end-to-end.test.ts"],"sourcesContent":["/**\n * End-to-end integration tests for the complete JSON-RPC Drupal search workflow\n */\n\nimport {\n  describe,\n  test,\n  expect,\n  beforeEach,\n  afterEach,\n  jest,\n} from '@jest/globals';\nimport { DrupalMcpServer } from '@/mcp/server.js';\nimport { DrupalClient } from '@/services/drupal-client.js';\nimport { loadConfig } from '@/config/index.js';\nimport type { SearchContentResponse, DrupalNode } from '@/types/index.js';\n\n// Mock fetch for controlled testing\nconst mockFetch = jest.fn();\nglobal.fetch = mockFetch as any;\n\ndescribe('End-to-End Integration Tests', () => {\n  let config: any;\n  let mcpServer: DrupalMcpServer;\n  let drupalClient: DrupalClient;\n\n  beforeEach(async () => {\n    config = {\n      drupal: {\n        baseUrl: 'http://localhost/drupal',\n        endpoint: '/jsonrpc',\n        timeout: 10000,\n        retries: 3,\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n        },\n      },\n      oauth: {\n        clientId: 'test-client-id',\n        authorizationEndpoint: 'http://localhost/drupal/oauth/authorize',\n        tokenEndpoint: 'http://localhost/drupal/oauth/token',\n        redirectUri: 'http://127.0.0.1:3000/callback',\n        scopes: ['tutorial:read', 'user:profile'],\n      },\n      auth: {\n        enabled: false, // Disable auth for end-to-end tests\n        requiredScopes: ['tutorial:read'],\n        skipAuth: true,\n      },\n      mcp: {\n        name: 'test-drupal-bridge-mcp',\n        version: '1.0.0-test',\n        protocolVersion: '2024-11-05',\n        capabilities: {\n          resources: { subscribe: true, listChanged: true },\n          tools: { listChanged: true },\n          prompts: { listChanged: true },\n        },\n      },\n      server: {\n        port: 3000,\n        host: '0.0.0.0',\n      },\n      logging: {\n        level: 'error' as const,\n      },\n      environment: 'test' as const,\n    };\n\n    mcpServer = new DrupalMcpServer(config);\n    drupalClient = new DrupalClient(config.drupal);\n\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    jest.restoreAllMocks();\n  });\n\n  describe('Complete Search Tutorial Workflow', () => {\n    test('should execute complete search workflow successfully', async () => {\n      // This test runs in test environment, so it should return mock data\n      const searchArgs = {\n        keywords: 'content management',\n        drupal_version: ['10'],\n        category: ['tutorial', 'cms'],\n      };\n\n      // Execute the search through the MCP tool interface\n      const result = await (mcpServer as any).executeSearchTutorials(\n        searchArgs\n      );\n\n      // Verify the response structure\n      expect(result).toHaveProperty('results');\n      expect(result).toHaveProperty('total');\n      expect(result).toHaveProperty('query');\n      expect(result.query).toHaveProperty('page');\n\n      // Verify result content\n      expect(Array.isArray(result.results)).toBe(true);\n      expect(result.total).toBeGreaterThan(0);\n      expect(result.query.keywords).toBe('content management');\n      expect(result.query.drupal_version).toEqual(['10']);\n\n      // Verify individual tutorial result structure\n      const firstResult = result.results[0];\n      expect(firstResult).toHaveProperty('id');\n      expect(firstResult).toHaveProperty('title');\n      expect(firstResult).toHaveProperty('url');\n      expect(firstResult).toHaveProperty('description');\n      expect(firstResult).toHaveProperty('drupal_version');\n      expect(firstResult).toHaveProperty('tags');\n      expect(firstResult).toHaveProperty('created');\n\n      // Verify filtering worked correctly\n      expect(firstResult.drupal_version).toContain('10');\n    });\n\n    test('should handle search with minimal parameters', async () => {\n      const searchArgs = {\n        keywords: 'forms',\n      };\n\n      const result = await (mcpServer as any).executeSearchTutorials(\n        searchArgs\n      );\n\n      expect(result.results).toBeDefined();\n      expect(result.query.keywords).toBe('forms');\n      expect(result.query.drupal_version).toBeUndefined();\n      expect(result.query.category).toBeUndefined();\n    });\n\n    test('should filter results by Drupal version', async () => {\n      const searchArgs = {\n        keywords: 'testing',\n        drupal_version: ['9'],\n      };\n\n      const result = await (mcpServer as any).executeSearchTutorials(\n        searchArgs\n      );\n\n      // In test mode, mock data should include version filtering\n      const drupal9Results = result.results.filter(r =>\n        r.drupal_version?.includes('9')\n      );\n      expect(drupal9Results.length).toBeGreaterThan(0);\n    });\n  });\n\n  describe('MCP Tool Integration', () => {\n    test('should execute search_tutorials tool through MCP interface', async () => {\n      const args = {\n        keywords: 'blocks',\n        drupal_version: ['11'],\n      };\n\n      const toolResponse = await (mcpServer as any).executeTool(\n        'search_tutorials',\n        args\n      );\n\n      expect(toolResponse).toHaveProperty('content');\n      expect(Array.isArray(toolResponse.content)).toBe(true);\n      expect(toolResponse.content[0]).toHaveProperty('type', 'text');\n      expect(toolResponse.content[0]).toHaveProperty('text');\n\n      const responseData = JSON.parse(toolResponse.content[0].text);\n      expect(responseData).toHaveProperty('results');\n      expect(responseData).toHaveProperty('total');\n    });\n\n    test('should handle tool validation errors gracefully', async () => {\n      const invalidArgs = {\n        keywords: 'x', // Too short\n      };\n\n      const toolResponse = await (mcpServer as any).executeTool(\n        'search_tutorials',\n        invalidArgs\n      );\n\n      expect(toolResponse.content[0]).toHaveProperty('type', 'text');\n\n      const errorResponse = JSON.parse(toolResponse.content[0].text);\n      expect(errorResponse).toHaveProperty('error');\n      expect(errorResponse.error.type).toBe('VALIDATION_ERROR');\n      expect(errorResponse.error.details.field).toBe('keywords');\n      expect(errorResponse.error.details.retryable).toBe(false);\n    });\n\n    test('should handle unknown tool names', async () => {\n      const toolResponse = await (mcpServer as any).executeTool(\n        'unknown_tool',\n        {}\n      );\n\n      const errorResponse = JSON.parse(toolResponse.content[0].text);\n      expect(errorResponse.error.type).toBe('VALIDATION_ERROR');\n      expect(errorResponse.error.details.field).toBe('name');\n      expect(errorResponse.error.message).toContain('Unknown tool');\n    });\n  });\n\n  describe('Resource Access Integration', () => {\n    test('should list available resources', async () => {\n      const resources = await (mcpServer as any).getResources();\n\n      expect(Array.isArray(resources)).toBe(true);\n      expect(resources.length).toBeGreaterThan(0);\n\n      const nodeResource = resources.find(r => r.uri === 'drupal://nodes');\n      expect(nodeResource).toBeDefined();\n      expect(nodeResource.name).toBe('Drupal Nodes');\n      expect(nodeResource.mimeType).toBe('application/json');\n    });\n\n    test('should handle resource read errors gracefully', async () => {\n      // This will fail in test environment, but should return structured error\n      const result = await (mcpServer as any).readResource('drupal://nodes');\n\n      expect(result).toHaveProperty('contents');\n      expect(Array.isArray(result.contents)).toBe(true);\n\n      const content = JSON.parse(result.contents[0].text);\n\n      // In test environment, this might return error or mock data\n      if (content.error) {\n        expect(content.error).toHaveProperty('type');\n        expect(content.error).toHaveProperty('message');\n      } else {\n        // If mock data is returned, it should be an array\n        expect(Array.isArray(content)).toBe(true);\n      }\n    });\n  });\n\n  describe('Connection Testing', () => {\n    test('should test Drupal connection', async () => {\n      // In test environment, this should return a consistent result\n      const result = await (mcpServer as any).executeTestConnection();\n\n      expect(result).toHaveProperty('connected');\n      expect(result).toHaveProperty('config');\n      expect(typeof result.connected).toBe('boolean');\n      expect(result.config).toHaveProperty('baseUrl');\n      expect(result.config).toHaveProperty('endpoint');\n    });\n  });\n\n  describe('Performance and Memory Usage', () => {\n    test('should handle large search results efficiently', async () => {\n      const startMemory = process.memoryUsage().heapUsed;\n      const startTime = Date.now();\n\n      // Execute multiple searches to test memory efficiency\n      const promises = Array.from({ length: 10 }, (_, i) =>\n        (mcpServer as any).executeSearchTutorials({\n          keywords: `test query ${i}`,\n          drupal_version: [i % 2 === 0 ? '10' : '11'],\n        })\n      );\n\n      const results = await Promise.all(promises);\n\n      const endTime = Date.now();\n      const endMemory = process.memoryUsage().heapUsed;\n\n      // Verify all searches completed successfully\n      expect(results).toHaveLength(10);\n      results.forEach((result, i) => {\n        expect(result.results).toBeDefined();\n        expect(result.query.keywords).toBe(`test query ${i}`);\n      });\n\n      // Performance assertions (these are baseline measurements)\n      const executionTime = endTime - startTime;\n      const memoryIncrease = endMemory - startMemory;\n\n      console.log(`Performance Baseline - 10 searches:`);\n      console.log(`  Execution time: ${executionTime}ms`);\n      console.log(`  Memory increase: ${Math.round(memoryIncrease / 1024)}KB`);\n\n      // Basic performance expectations (adjust based on actual measurements)\n      expect(executionTime).toBeLessThan(5000); // Should complete within 5 seconds\n      expect(memoryIncrease).toBeLessThan(50 * 1024 * 1024); // Should not increase memory by more than 50MB\n    });\n\n    test('should handle concurrent search requests', async () => {\n      const concurrentSearches = 5;\n      const searchPromises = Array.from(\n        { length: concurrentSearches },\n        (_, i) =>\n          (mcpServer as any).executeTool('search_tutorials', {\n            keywords: `concurrent search ${i}`,\n          })\n      );\n\n      const startTime = Date.now();\n      const results = await Promise.all(searchPromises);\n      const endTime = Date.now();\n\n      // All searches should complete successfully\n      expect(results).toHaveLength(concurrentSearches);\n      results.forEach(result => {\n        expect(result.content).toBeDefined();\n        const data = JSON.parse(result.content[0].text);\n        expect(data.results).toBeDefined();\n      });\n\n      console.log(\n        `Concurrent Baseline - ${concurrentSearches} searches: ${endTime - startTime}ms`\n      );\n    });\n  });\n\n  describe('Error Recovery and Fallbacks', () => {\n    test('should fall back to mock data when API is unavailable in development', async () => {\n      // Simulate network failure\n      mockFetch.mockRejectedValue(new Error('ECONNREFUSED'));\n\n      // Set to development environment to trigger fallback\n      const devConfig = { ...config, environment: 'development' };\n      const devServer = new DrupalMcpServer(devConfig);\n\n      const result = await (devServer as any).executeSearchTutorials({\n        keywords: 'fallback test',\n      });\n\n      // Should receive mock data instead of error\n      expect(result.results).toBeDefined();\n      expect(result.results.length).toBeGreaterThan(0);\n      expect(result.query.keywords).toBe('fallback test');\n    });\n\n    test('should propagate errors in production environment', async () => {\n      // Simulate network failure\n      mockFetch.mockRejectedValue(new Error('ECONNREFUSED'));\n\n      // Set to production environment AND ensure it's not test mode\n      const prodConfig = {\n        ...config,\n        environment: 'production',\n      };\n      const prodServer = new DrupalMcpServer(prodConfig);\n\n      // Override NODE_ENV to ensure we're not in test mode\n      const originalNodeEnv = process.env.NODE_ENV;\n      process.env.NODE_ENV = 'production';\n\n      try {\n        await expect(\n          (prodServer as any).executeSearchTutorials({\n            keywords: 'production test',\n          })\n        ).rejects.toThrow();\n      } finally {\n        // Restore original NODE_ENV\n        process.env.NODE_ENV = originalNodeEnv;\n      }\n    });\n  });\n\n  describe('Data Validation and Processing', () => {\n    test('should validate and process search parameters correctly', async () => {\n      const args = {\n        keywords: '  Content Management  ', // Test trimming\n        drupal_version: ['10'],\n        category: ['Tutorial', 'CMS', 'tutorial'], // Test deduplication and normalization\n      };\n\n      const result = await (mcpServer as any).executeSearchTutorials(args);\n\n      expect(result.query.keywords).toBe('Content Management');\n      expect(result.query.drupal_version).toEqual(['10']);\n      expect(result.query.category).toEqual(['tutorial', 'cms']); // Should be deduplicated and lowercased\n    });\n\n    test('should extract descriptions from tutorial content', async () => {\n      const result = await (mcpServer as any).executeSearchTutorials({\n        keywords: 'description test',\n      });\n\n      const tutorial = result.results[0];\n      expect(tutorial.description).toBeDefined();\n      expect(typeof tutorial.description).toBe('string');\n      expect(tutorial.description.length).toBeGreaterThan(0);\n    });\n  });\n});\n"],"version":3}