aa1ba9fe962d69c4cd86b8ddc6ab70d9
"use strict";
/**
 * Integration test setup and configuration
 * Focuses on real component interactions and workflows
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Global test setup for integration tests
(0, globals_1.beforeAll)(async () => {
    // Set test environment variables for integration testing
    process.env.NODE_ENV = 'test';
    process.env.LOG_LEVEL = 'error';
    process.env.AUTH_SKIP = 'false';
    process.env.AUTH_ENABLED = 'true';
    // Integration test specific environment
    process.env.DRUPAL_BASE_URL =
        process.env.DRUPAL_BASE_URL || 'http://localhost/drupal';
    process.env.DRUPAL_JSON_RPC_ENDPOINT =
        process.env.DRUPAL_JSON_RPC_ENDPOINT || '/jsonrpc';
    process.env.MCP_SERVER_NAME =
        process.env.MCP_SERVER_NAME || 'drupal-bridge-mcp';
    process.env.MCP_SERVER_VERSION = process.env.MCP_SERVER_VERSION || '1.0.0';
    // Reduce noise but keep error messages for debugging
    globals_1.jest.spyOn(console, 'log').mockImplementation(() => { });
    globals_1.jest.spyOn(console, 'info').mockImplementation(() => { });
    globals_1.jest.spyOn(console, 'warn').mockImplementation(() => { });
});
(0, globals_1.afterAll)(async () => {
    // Clean up any global resources and connections
    globals_1.jest.restoreAllMocks();
    // Allow time for any pending async operations to complete
    await new Promise(resolve => setTimeout(resolve, 100));
});
// Custom matchers for integration testing
expect.extend({
    toBeValidToken(received) {
        const parts = received.split('.');
        const isValid = parts.length === 3 && parts.every(part => part.length > 0);
        if (isValid) {
            return {
                message: () => `Expected ${received} not to be a valid JWT token`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected ${received} to be a valid JWT token`,
                pass: false,
            };
        }
    },
    toBeEncrypted(received) {
        const parts = received.split(':');
        const isEncrypted = parts.length === 3 && parts.every(part => part.length > 0);
        if (isEncrypted) {
            return {
                message: () => `Expected ${received} not to be encrypted`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected ${received} to be encrypted`,
                pass: false,
            };
        }
    },
    toBeValidOAuthResponse(received) {
        const hasRequiredFields = received &&
            typeof received.access_token === 'string' &&
            typeof received.token_type === 'string' &&
            typeof received.expires_in === 'number';
        if (hasRequiredFields) {
            return {
                message: () => `Expected ${JSON.stringify(received)} not to be a valid OAuth response`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected ${JSON.stringify(received)} to be a valid OAuth response`,
                pass: false,
            };
        }
    },
});
// Global utilities for integration tests
global.createIntegrationTestServer = () => {
    // Mock server setup for integration tests
    return {
        listen: globals_1.jest.fn(),
        close: globals_1.jest.fn(),
        address: () => ({ port: 3000 }),
    };
};
global.cleanupTestResources = async () => {
    // Cleanup any test resources, connections, etc.
    await Promise.resolve();
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RTtRQUNqQixLQUFLLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNoQixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQztLQUNoQyxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLG9CQUFvQixHQUFHLEtBQUssSUFBSSxFQUFFO0lBQ3ZDLGdEQUFnRDtJQUNoRCxNQUFNLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUMxQixDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9zZXR1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEludGVncmF0aW9uIHRlc3Qgc2V0dXAgYW5kIGNvbmZpZ3VyYXRpb25cbiAqIEZvY3VzZXMgb24gcmVhbCBjb21wb25lbnQgaW50ZXJhY3Rpb25zIGFuZCB3b3JrZmxvd3NcbiAqL1xuXG5pbXBvcnQgeyBiZWZvcmVBbGwsIGFmdGVyQWxsLCBqZXN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5cbi8vIEdsb2JhbCB0ZXN0IHNldHVwIGZvciBpbnRlZ3JhdGlvbiB0ZXN0c1xuYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgLy8gU2V0IHRlc3QgZW52aXJvbm1lbnQgdmFyaWFibGVzIGZvciBpbnRlZ3JhdGlvbiB0ZXN0aW5nXG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnO1xuICBwcm9jZXNzLmVudi5MT0dfTEVWRUwgPSAnZXJyb3InO1xuICBwcm9jZXNzLmVudi5BVVRIX1NLSVAgPSAnZmFsc2UnO1xuICBwcm9jZXNzLmVudi5BVVRIX0VOQUJMRUQgPSAndHJ1ZSc7XG5cbiAgLy8gSW50ZWdyYXRpb24gdGVzdCBzcGVjaWZpYyBlbnZpcm9ubWVudFxuICBwcm9jZXNzLmVudi5EUlVQQUxfQkFTRV9VUkwgPVxuICAgIHByb2Nlc3MuZW52LkRSVVBBTF9CQVNFX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdC9kcnVwYWwnO1xuICBwcm9jZXNzLmVudi5EUlVQQUxfSlNPTl9SUENfRU5EUE9JTlQgPVxuICAgIHByb2Nlc3MuZW52LkRSVVBBTF9KU09OX1JQQ19FTkRQT0lOVCB8fCAnL2pzb25ycGMnO1xuICBwcm9jZXNzLmVudi5NQ1BfU0VSVkVSX05BTUUgPVxuICAgIHByb2Nlc3MuZW52Lk1DUF9TRVJWRVJfTkFNRSB8fCAnZHJ1cGFsLWJyaWRnZS1tY3AnO1xuICBwcm9jZXNzLmVudi5NQ1BfU0VSVkVSX1ZFUlNJT04gPSBwcm9jZXNzLmVudi5NQ1BfU0VSVkVSX1ZFUlNJT04gfHwgJzEuMC4wJztcblxuICAvLyBSZWR1Y2Ugbm9pc2UgYnV0IGtlZXAgZXJyb3IgbWVzc2FnZXMgZm9yIGRlYnVnZ2luZ1xuICBqZXN0LnNweU9uKGNvbnNvbGUsICdsb2cnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICBqZXN0LnNweU9uKGNvbnNvbGUsICdpbmZvJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcbiAgamVzdC5zcHlPbihjb25zb2xlLCAnd2FybicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG59KTtcblxuYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAvLyBDbGVhbiB1cCBhbnkgZ2xvYmFsIHJlc291cmNlcyBhbmQgY29ubmVjdGlvbnNcbiAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcblxuICAvLyBBbGxvdyB0aW1lIGZvciBhbnkgcGVuZGluZyBhc3luYyBvcGVyYXRpb25zIHRvIGNvbXBsZXRlXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbn0pO1xuXG4vLyBJbnRlZ3JhdGlvbiB0ZXN0IHNwZWNpZmljIG1hdGNoZXJzIGFuZCB1dGlsaXRpZXNcbmRlY2xhcmUgZ2xvYmFsIHtcbiAgbmFtZXNwYWNlIGplc3Qge1xuICAgIGludGVyZmFjZSBNYXRjaGVyczxSPiB7XG4gICAgICB0b0JlVmFsaWRUb2tlbigpOiBSO1xuICAgICAgdG9CZUVuY3J5cHRlZCgpOiBSO1xuICAgICAgdG9CZVZhbGlkT0F1dGhSZXNwb25zZSgpOiBSO1xuICAgIH1cbiAgfVxuXG4gIG5hbWVzcGFjZSBOb2RlSlMge1xuICAgIGludGVyZmFjZSBHbG9iYWwge1xuICAgICAgY3JlYXRlSW50ZWdyYXRpb25UZXN0U2VydmVyOiAoKSA9PiBhbnk7XG4gICAgICBjbGVhbnVwVGVzdFJlc291cmNlczogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgICB9XG4gIH1cbn1cblxuLy8gQ3VzdG9tIG1hdGNoZXJzIGZvciBpbnRlZ3JhdGlvbiB0ZXN0aW5nXG5leHBlY3QuZXh0ZW5kKHtcbiAgdG9CZVZhbGlkVG9rZW4ocmVjZWl2ZWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHBhcnRzID0gcmVjZWl2ZWQuc3BsaXQoJy4nKTtcbiAgICBjb25zdCBpc1ZhbGlkID0gcGFydHMubGVuZ3RoID09PSAzICYmIHBhcnRzLmV2ZXJ5KHBhcnQgPT4gcGFydC5sZW5ndGggPiAwKTtcblxuICAgIGlmIChpc1ZhbGlkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgRXhwZWN0ZWQgJHtyZWNlaXZlZH0gbm90IHRvIGJlIGEgdmFsaWQgSldUIHRva2VuYCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBFeHBlY3RlZCAke3JlY2VpdmVkfSB0byBiZSBhIHZhbGlkIEpXVCB0b2tlbmAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG5cbiAgdG9CZUVuY3J5cHRlZChyZWNlaXZlZDogc3RyaW5nKSB7XG4gICAgY29uc3QgcGFydHMgPSByZWNlaXZlZC5zcGxpdCgnOicpO1xuICAgIGNvbnN0IGlzRW5jcnlwdGVkID1cbiAgICAgIHBhcnRzLmxlbmd0aCA9PT0gMyAmJiBwYXJ0cy5ldmVyeShwYXJ0ID0+IHBhcnQubGVuZ3RoID4gMCk7XG5cbiAgICBpZiAoaXNFbmNyeXB0ZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBFeHBlY3RlZCAke3JlY2VpdmVkfSBub3QgdG8gYmUgZW5jcnlwdGVkYCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBFeHBlY3RlZCAke3JlY2VpdmVkfSB0byBiZSBlbmNyeXB0ZWRgLFxuICAgICAgICBwYXNzOiBmYWxzZSxcbiAgICAgIH07XG4gICAgfVxuICB9LFxuXG4gIHRvQmVWYWxpZE9BdXRoUmVzcG9uc2UocmVjZWl2ZWQ6IGFueSkge1xuICAgIGNvbnN0IGhhc1JlcXVpcmVkRmllbGRzID1cbiAgICAgIHJlY2VpdmVkICYmXG4gICAgICB0eXBlb2YgcmVjZWl2ZWQuYWNjZXNzX3Rva2VuID09PSAnc3RyaW5nJyAmJlxuICAgICAgdHlwZW9mIHJlY2VpdmVkLnRva2VuX3R5cGUgPT09ICdzdHJpbmcnICYmXG4gICAgICB0eXBlb2YgcmVjZWl2ZWQuZXhwaXJlc19pbiA9PT0gJ251bWJlcic7XG5cbiAgICBpZiAoaGFzUmVxdWlyZWRGaWVsZHMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+XG4gICAgICAgICAgYEV4cGVjdGVkICR7SlNPTi5zdHJpbmdpZnkocmVjZWl2ZWQpfSBub3QgdG8gYmUgYSB2YWxpZCBPQXV0aCByZXNwb25zZWAsXG4gICAgICAgIHBhc3M6IHRydWUsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PlxuICAgICAgICAgIGBFeHBlY3RlZCAke0pTT04uc3RyaW5naWZ5KHJlY2VpdmVkKX0gdG8gYmUgYSB2YWxpZCBPQXV0aCByZXNwb25zZWAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG59KTtcblxuLy8gR2xvYmFsIHV0aWxpdGllcyBmb3IgaW50ZWdyYXRpb24gdGVzdHNcbmdsb2JhbC5jcmVhdGVJbnRlZ3JhdGlvblRlc3RTZXJ2ZXIgPSAoKSA9PiB7XG4gIC8vIE1vY2sgc2VydmVyIHNldHVwIGZvciBpbnRlZ3JhdGlvbiB0ZXN0c1xuICByZXR1cm4ge1xuICAgIGxpc3RlbjogamVzdC5mbigpLFxuICAgIGNsb3NlOiBqZXN0LmZuKCksXG4gICAgYWRkcmVzczogKCkgPT4gKHsgcG9ydDogMzAwMCB9KSxcbiAgfTtcbn07XG5cbmdsb2JhbC5jbGVhbnVwVGVzdFJlc291cmNlcyA9IGFzeW5jICgpID0+IHtcbiAgLy8gQ2xlYW51cCBhbnkgdGVzdCByZXNvdXJjZXMsIGNvbm5lY3Rpb25zLCBldGMuXG4gIGF3YWl0IFByb21pc2UucmVzb2x2ZSgpO1xufTtcbiJdLCJ2ZXJzaW9uIjozfQ==