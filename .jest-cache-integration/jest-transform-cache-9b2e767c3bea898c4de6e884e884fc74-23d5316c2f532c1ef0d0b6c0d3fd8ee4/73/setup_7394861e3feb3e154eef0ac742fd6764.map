{"file":"/workspace/tests/integration/setup.ts","mappings":"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","names":[],"sources":["/workspace/tests/integration/setup.ts"],"sourcesContent":["/**\n * Integration test setup and configuration\n * Focuses on real component interactions and workflows\n */\n\nimport { beforeAll, afterAll, jest } from '@jest/globals';\n\n// Global test setup for integration tests\nbeforeAll(async () => {\n  // Set test environment variables for integration testing\n  process.env.NODE_ENV = 'test';\n  process.env.LOG_LEVEL = 'error';\n  process.env.AUTH_SKIP = 'false';\n  process.env.AUTH_ENABLED = 'true';\n  \n  // Integration test specific environment\n  process.env.DRUPAL_BASE_URL = process.env.DRUPAL_BASE_URL || 'http://localhost/drupal';\n  process.env.DRUPAL_JSON_RPC_ENDPOINT = process.env.DRUPAL_JSON_RPC_ENDPOINT || '/jsonrpc';\n  process.env.MCP_SERVER_NAME = process.env.MCP_SERVER_NAME || 'drupal-bridge-mcp';\n  process.env.MCP_SERVER_VERSION = process.env.MCP_SERVER_VERSION || '1.0.0';\n\n  // Reduce noise but keep error messages for debugging\n  jest.spyOn(console, 'log').mockImplementation(() => {});\n  jest.spyOn(console, 'info').mockImplementation(() => {});\n  jest.spyOn(console, 'warn').mockImplementation(() => {});\n});\n\nafterAll(async () => {\n  // Clean up any global resources and connections\n  jest.restoreAllMocks();\n  \n  // Allow time for any pending async operations to complete\n  await new Promise(resolve => setTimeout(resolve, 100));\n});\n\n// Integration test specific matchers and utilities\ndeclare global {\n  namespace jest {\n    interface Matchers<R> {\n      toBeValidToken(): R;\n      toBeEncrypted(): R;\n      toBeValidOAuthResponse(): R;\n    }\n  }\n  \n  namespace NodeJS {\n    interface Global {\n      createIntegrationTestServer: () => any;\n      cleanupTestResources: () => Promise<void>;\n    }\n  }\n}\n\n// Custom matchers for integration testing\nexpect.extend({\n  toBeValidToken(received: string) {\n    const parts = received.split('.');\n    const isValid = parts.length === 3 && parts.every(part => part.length > 0);\n\n    if (isValid) {\n      return {\n        message: () => `Expected ${received} not to be a valid JWT token`,\n        pass: true,\n      };\n    } else {\n      return {\n        message: () => `Expected ${received} to be a valid JWT token`,\n        pass: false,\n      };\n    }\n  },\n\n  toBeEncrypted(received: string) {\n    const parts = received.split(':');\n    const isEncrypted = parts.length === 3 && parts.every(part => part.length > 0);\n\n    if (isEncrypted) {\n      return {\n        message: () => `Expected ${received} not to be encrypted`,\n        pass: true,\n      };\n    } else {\n      return {\n        message: () => `Expected ${received} to be encrypted`,\n        pass: false,\n      };\n    }\n  },\n\n  toBeValidOAuthResponse(received: any) {\n    const hasRequiredFields = received &&\n      typeof received.access_token === 'string' &&\n      typeof received.token_type === 'string' &&\n      typeof received.expires_in === 'number';\n\n    if (hasRequiredFields) {\n      return {\n        message: () => `Expected ${JSON.stringify(received)} not to be a valid OAuth response`,\n        pass: true,\n      };\n    } else {\n      return {\n        message: () => `Expected ${JSON.stringify(received)} to be a valid OAuth response`,\n        pass: false,\n      };\n    }\n  },\n});\n\n// Global utilities for integration tests\nglobal.createIntegrationTestServer = () => {\n  // Mock server setup for integration tests\n  return {\n    listen: jest.fn(),\n    close: jest.fn(),\n    address: () => ({ port: 3000 }),\n  };\n};\n\nglobal.cleanupTestResources = async () => {\n  // Cleanup any test resources, connections, etc.\n  await Promise.resolve();\n};\n"],"version":3}