c7c5c19d0eddfc8b2459b1c62ebbcbd8
"use strict";
/**
 * Integration tests for error handling across the JSON-RPC Drupal integration
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const error_handler_js_1 = require("@/utils/error-handler.js");
const drupal_client_js_1 = require("@/services/drupal-client.js");
const server_js_1 = require("@/mcp/server.js");
// Mock fetch to simulate various error scenarios
const mockFetch = globals_1.jest.fn();
global.fetch = mockFetch;
(0, globals_1.describe)('Error Handling Integration', () => {
    let config;
    let drupalClient;
    let mcpServer;
    (0, globals_1.beforeEach)(async () => {
        config = {
            drupal: {
                baseUrl: 'http://localhost/drupal',
                endpoint: '/jsonrpc',
                timeout: 10000,
                retries: 3,
                headers: {
                    'Content-Type': 'application/json',
                    Accept: 'application/json',
                },
            },
            oauth: {
                clientId: 'test-client-id',
                authorizationEndpoint: 'http://localhost/drupal/oauth/authorize',
                tokenEndpoint: 'http://localhost/drupal/oauth/token',
                redirectUri: 'http://127.0.0.1:3000/callback',
                scopes: ['tutorial:read', 'user:profile'],
            },
            auth: {
                enabled: false, // Disable auth for error handling tests
                requiredScopes: ['tutorial:read'],
                skipAuth: true,
            },
            mcp: {
                name: 'test-drupal-bridge-mcp',
                version: '1.0.0-test',
                protocolVersion: '2024-11-05',
                capabilities: {
                    resources: { subscribe: true, listChanged: true },
                    tools: { listChanged: true },
                    prompts: { listChanged: true },
                },
            },
            server: {
                port: 3000,
                host: '0.0.0.0',
            },
            logging: {
                level: 'error',
            },
            environment: 'test',
        };
        drupalClient = new drupal_client_js_1.DrupalClient(config.drupal);
        mcpServer = new server_js_1.DrupalMcpServer(config);
        // Reset all mocks
        globals_1.jest.clearAllMocks();
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.restoreAllMocks();
    });
    (0, globals_1.describe)('JSON-RPC Error Response Parsing', () => {
        (0, globals_1.test)('should parse standard JSON-RPC validation error', () => {
            const errorResponse = {
                jsonrpc: '2.0',
                error: {
                    code: -32602,
                    message: 'Invalid search parameters',
                    data: {
                        type: 'VALIDATION_ERROR',
                        details: 'Search keywords must be at least 2 characters',
                        field: 'keywords',
                    },
                },
                id: 'search-request-001',
            };
            const error = (0, error_handler_js_1.parseJsonRpcError)(errorResponse, 'test-request-123');
            (0, globals_1.expect)(error).toBeInstanceOf(error_handler_js_1.IntegrationError);
            (0, globals_1.expect)(error.errorType).toBe(error_handler_js_1.IntegrationErrorType.VALIDATION_ERROR);
            (0, globals_1.expect)(error.message).toBe('Invalid search parameters');
            (0, globals_1.expect)(error.field).toBe('keywords');
            (0, globals_1.expect)(error.retryable).toBe(false);
            (0, globals_1.expect)(error.details?.jsonrpc_code).toBe(-32602);
        });
        (0, globals_1.test)('should parse JSON-RPC server error as retryable', () => {
            const errorResponse = {
                jsonrpc: '2.0',
                error: {
                    code: -32603,
                    message: 'Internal server error',
                },
                id: 'search-request-002',
            };
            const error = (0, error_handler_js_1.parseJsonRpcError)(errorResponse);
            (0, globals_1.expect)(error.errorType).toBe(error_handler_js_1.IntegrationErrorType.SERVER_UNAVAILABLE);
            (0, globals_1.expect)(error.retryable).toBe(true);
        });
        (0, globals_1.test)('should parse custom Drupal server errors', () => {
            const errorResponse = {
                jsonrpc: '2.0',
                error: {
                    code: -32050,
                    message: 'Database connection failed',
                    data: {
                        details: 'Connection timeout after 30 seconds',
                    },
                },
                id: 'search-request-003',
            };
            const error = (0, error_handler_js_1.parseJsonRpcError)(errorResponse);
            (0, globals_1.expect)(error.errorType).toBe(error_handler_js_1.IntegrationErrorType.DRUPAL_ERROR);
            (0, globals_1.expect)(error.retryable).toBe(true);
            (0, globals_1.expect)(error.details?.server_details).toBe('Connection timeout after 30 seconds');
        });
    });
    (0, globals_1.describe)('Network Error Handling', () => {
        (0, globals_1.test)('should handle network timeout errors', async () => {
            // Mock a timeout error (AbortError)
            const abortError = new Error('The user aborted a request');
            abortError.name = 'AbortError';
            mockFetch.mockRejectedValue(abortError);
            try {
                await drupalClient.searchTutorials({
                    keywords: 'test search',
                });
                // If we reach here, the test should fail
                (0, globals_1.expect)(true).toBe(false);
            }
            catch (error) {
                (0, globals_1.expect)(error).toBeInstanceOf(error_handler_js_1.IntegrationError);
                if (error instanceof error_handler_js_1.IntegrationError) {
                    // All errors through JSON-RPC client get normalized to JSONRPC_ERROR
                    (0, globals_1.expect)(error.errorType).toBe(error_handler_js_1.IntegrationErrorType.JSONRPC_ERROR);
                    (0, globals_1.expect)(error.message).toBe('The user aborted a request');
                    (0, globals_1.expect)(error.retryable).toBe(false);
                }
            }
        });
        (0, globals_1.test)('should handle network connection errors', async () => {
            // Mock a network connection error
            mockFetch.mockRejectedValue(new TypeError('fetch failed'));
            try {
                // Use a different method that throws errors instead of testConnection which swallows them
                await drupalClient.searchTutorials({ keywords: 'test' });
                (0, globals_1.expect)(true).toBe(false); // Should not reach here
            }
            catch (error) {
                (0, globals_1.expect)(error).toBeInstanceOf(error_handler_js_1.IntegrationError);
                if (error instanceof error_handler_js_1.IntegrationError) {
                    // Network errors get wrapped after retries
                    (0, globals_1.expect)(error.errorType).toBe(error_handler_js_1.IntegrationErrorType.JSONRPC_ERROR);
                    (0, globals_1.expect)(error.message).toContain('Failed after 3 attempts');
                    (0, globals_1.expect)(error.retryable).toBe(false); // Final wrapped error is not retryable
                }
            }
        });
        (0, globals_1.test)('should handle malformed JSON responses', async () => {
            // Mock a response with invalid JSON
            mockFetch.mockResolvedValue({
                status: 200,
                headers: {
                    get: globals_1.jest.fn((name) => {
                        if (name === 'content-type')
                            return 'application/json';
                        return null;
                    }),
                },
                json: globals_1.jest.fn().mockRejectedValue(new SyntaxError('Unexpected token')),
            });
            try {
                await drupalClient.loadNode(123);
                (0, globals_1.expect)(true).toBe(false); // Should not reach here
            }
            catch (error) {
                (0, globals_1.expect)(error).toBeInstanceOf(error_handler_js_1.IntegrationError);
                if (error instanceof error_handler_js_1.IntegrationError) {
                    // All errors through JSON-RPC client get normalized to JSONRPC_ERROR
                    (0, globals_1.expect)(error.errorType).toBe(error_handler_js_1.IntegrationErrorType.JSONRPC_ERROR);
                    (0, globals_1.expect)(error.message).toBe('Failed to parse JSON response');
                    (0, globals_1.expect)(error.retryable).toBe(false);
                }
            }
        });
    });
    (0, globals_1.describe)('HTTP Status Code Handling', () => {
        (0, globals_1.test)('should handle 401 authentication errors', async () => {
            mockFetch.mockResolvedValue({
                status: 401,
                statusText: 'Unauthorized',
                text: globals_1.jest.fn().mockResolvedValue('Authentication required'),
            });
            try {
                await drupalClient.getNodes({ limit: 5 });
                (0, globals_1.expect)(true).toBe(false); // Should not reach here
            }
            catch (error) {
                (0, globals_1.expect)(error).toBeInstanceOf(error_handler_js_1.IntegrationError);
                if (error instanceof error_handler_js_1.IntegrationError) {
                    // All errors through JSON-RPC client get normalized to JSONRPC_ERROR
                    (0, globals_1.expect)(error.errorType).toBe(error_handler_js_1.IntegrationErrorType.JSONRPC_ERROR);
                    (0, globals_1.expect)(error.message).toBe('HTTP 401: Unauthorized');
                    (0, globals_1.expect)(error.retryable).toBe(false);
                    (0, globals_1.expect)(error.getUserFriendlyMessage()).toContain('Server error');
                }
            }
        });
        (0, globals_1.test)('should handle 429 rate limiting errors', async () => {
            mockFetch.mockResolvedValue({
                status: 429,
                statusText: 'Too Many Requests',
                text: globals_1.jest.fn().mockResolvedValue('Rate limit exceeded'),
            });
            try {
                await drupalClient.searchTutorials({ keywords: 'test' });
                (0, globals_1.expect)(true).toBe(false); // Should not reach here
            }
            catch (error) {
                (0, globals_1.expect)(error).toBeInstanceOf(error_handler_js_1.IntegrationError);
                if (error instanceof error_handler_js_1.IntegrationError) {
                    // After retry logic, rate limit errors get wrapped as JSONRPC_ERROR
                    (0, globals_1.expect)(error.errorType).toBe(error_handler_js_1.IntegrationErrorType.JSONRPC_ERROR);
                    (0, globals_1.expect)(error.message).toContain('Failed after 3 attempts');
                    (0, globals_1.expect)(error.retryable).toBe(false); // Final wrapped error is not retryable
                    (0, globals_1.expect)(error.getUserFriendlyMessage()).toContain('Server error');
                }
            }
        });
        (0, globals_1.test)('should handle 500 server errors', async () => {
            mockFetch.mockResolvedValue({
                status: 500,
                statusText: 'Internal Server Error',
                text: globals_1.jest.fn().mockResolvedValue('Database connection failed'),
            });
            try {
                await drupalClient.createNode({
                    type: 'article',
                    title: 'Test Article',
                });
                (0, globals_1.expect)(true).toBe(false); // Should not reach here
            }
            catch (error) {
                (0, globals_1.expect)(error).toBeInstanceOf(error_handler_js_1.IntegrationError);
                if (error instanceof error_handler_js_1.IntegrationError) {
                    // After retry logic, server errors get wrapped as JSONRPC_ERROR
                    (0, globals_1.expect)(error.errorType).toBe(error_handler_js_1.IntegrationErrorType.JSONRPC_ERROR);
                    (0, globals_1.expect)(error.message).toContain('Failed after 3 attempts');
                    (0, globals_1.expect)(error.retryable).toBe(false); // Final wrapped error is not retryable
                }
            }
        });
    });
    (0, globals_1.describe)('MCP Tool Error Formatting', () => {
        (0, globals_1.test)('should format validation errors for MCP response', () => {
            const validationError = new error_handler_js_1.IntegrationError(error_handler_js_1.IntegrationErrorType.VALIDATION_ERROR, 'Search keywords must be at least 2 characters', undefined, 'keywords', { minLength: 2, provided: 'a' }, undefined, false);
            const mcpResponse = (0, error_handler_js_1.formatMcpErrorResponse)(validationError, 'test-req-123');
            (0, globals_1.expect)(mcpResponse.content).toHaveLength(1);
            (0, globals_1.expect)(mcpResponse.content[0].type).toBe('text');
            const errorData = JSON.parse(mcpResponse.content[0].text);
            (0, globals_1.expect)(errorData.error.type).toBe(error_handler_js_1.IntegrationErrorType.VALIDATION_ERROR);
            (0, globals_1.expect)(errorData.error.message).toContain('Please check the keywords parameter');
            (0, globals_1.expect)(errorData.error.details.field).toBe('keywords');
            (0, globals_1.expect)(errorData.error.details.retryable).toBe(false);
            (0, globals_1.expect)(errorData.error.details.request_id).toBe('test-req-123');
        });
        (0, globals_1.test)('should format network errors for MCP response', () => {
            const networkError = new error_handler_js_1.IntegrationError(error_handler_js_1.IntegrationErrorType.NETWORK_ERROR, 'Connection refused', undefined, undefined, { context: 'Searching tutorials' }, new Error('ECONNREFUSED'), true);
            const mcpResponse = (0, error_handler_js_1.formatMcpErrorResponse)(networkError);
            const errorData = JSON.parse(mcpResponse.content[0].text);
            (0, globals_1.expect)(errorData.error.type).toBe(error_handler_js_1.IntegrationErrorType.NETWORK_ERROR);
            (0, globals_1.expect)(errorData.error.message).toContain('Unable to connect');
            (0, globals_1.expect)(errorData.error.details.retryable).toBe(true);
        });
    });
    (0, globals_1.describe)('Error Normalization', () => {
        (0, globals_1.test)('should normalize generic Error to IntegrationError', () => {
            const genericError = new Error('Something went wrong');
            const normalized = (0, error_handler_js_1.normalizeError)(genericError, 'Test operation');
            (0, globals_1.expect)(normalized).toBeInstanceOf(error_handler_js_1.IntegrationError);
            (0, globals_1.expect)(normalized.errorType).toBe(error_handler_js_1.IntegrationErrorType.NETWORK_ERROR);
            (0, globals_1.expect)(normalized.message).toContain('Something went wrong');
            (0, globals_1.expect)(normalized.details?.context).toBe('Test operation');
        });
        (0, globals_1.test)('should preserve IntegrationError when normalizing', () => {
            const originalError = new error_handler_js_1.IntegrationError(error_handler_js_1.IntegrationErrorType.VALIDATION_ERROR, 'Invalid parameter', 400, 'test_field');
            const normalized = (0, error_handler_js_1.normalizeError)(originalError, 'Test operation');
            (0, globals_1.expect)(normalized).toBe(originalError); // Should be the same instance
        });
        (0, globals_1.test)('should handle unknown error types', () => {
            const unknownError = { message: 'Unknown error', code: 'UNKNOWN' };
            const normalized = (0, error_handler_js_1.normalizeError)(unknownError, 'Test operation');
            (0, globals_1.expect)(normalized.errorType).toBe(error_handler_js_1.IntegrationErrorType.NETWORK_ERROR);
            (0, globals_1.expect)(normalized.message).toContain('Test operation: [object Object]'); // Since we're passing an object, it gets stringified
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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N0QsTUFBTSxhQUFhLEdBQUcsSUFBSSxtQ0FBZ0IsQ0FDeEMsdUNBQW9CLENBQUMsZ0JBQWdCLEVBQ3JDLG1CQUFtQixFQUNuQixHQUFHLEVBQ0gsWUFBWSxDQUNiLENBQUM7WUFFRixNQUFNLFVBQVUsR0FBRyxJQUFBLGlDQUFjLEVBQUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLENBQUM7WUFFbkUsSUFBQSxnQkFBTSxFQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLDhCQUE4QjtRQUN4RSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxNQUFNLFlBQVksR0FBRyxFQUFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDO1lBQ25FLE1BQU0sVUFBVSxHQUFHLElBQUEsaUNBQWMsRUFBQyxZQUFZLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztZQUVsRSxJQUFBLGdCQUFNLEVBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyx1Q0FBb0IsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUN0RSxJQUFBLGdCQUFNLEVBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLENBQUMscURBQXFEO1FBQ2hJLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvd29ya3NwYWNlL3Rlc3RzL2ludGVncmF0aW9uL2Vycm9yLWhhbmRsaW5nLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJbnRlZ3JhdGlvbiB0ZXN0cyBmb3IgZXJyb3IgaGFuZGxpbmcgYWNyb3NzIHRoZSBKU09OLVJQQyBEcnVwYWwgaW50ZWdyYXRpb25cbiAqL1xuXG5pbXBvcnQge1xuICBkZXNjcmliZSxcbiAgdGVzdCxcbiAgZXhwZWN0LFxuICBiZWZvcmVFYWNoLFxuICBhZnRlckVhY2gsXG4gIGplc3QsXG59IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHtcbiAgSW50ZWdyYXRpb25FcnJvcixcbiAgSW50ZWdyYXRpb25FcnJvclR5cGUsXG4gIHBhcnNlSnNvblJwY0Vycm9yLFxuICBub3JtYWxpemVFcnJvcixcbiAgZm9ybWF0TWNwRXJyb3JSZXNwb25zZSxcbn0gZnJvbSAnQC91dGlscy9lcnJvci1oYW5kbGVyLmpzJztcbmltcG9ydCB7IERydXBhbENsaWVudCB9IGZyb20gJ0Avc2VydmljZXMvZHJ1cGFsLWNsaWVudC5qcyc7XG5pbXBvcnQgeyBEcnVwYWxNY3BTZXJ2ZXIgfSBmcm9tICdAL21jcC9zZXJ2ZXIuanMnO1xuaW1wb3J0IHsgbG9hZENvbmZpZyB9IGZyb20gJ0AvY29uZmlnL2luZGV4LmpzJztcbmltcG9ydCB0eXBlIHsgSnNvblJwY0Vycm9yUmVzcG9uc2UgfSBmcm9tICdAL3R5cGVzL2luZGV4LmpzJztcblxuLy8gTW9jayBmZXRjaCB0byBzaW11bGF0ZSB2YXJpb3VzIGVycm9yIHNjZW5hcmlvc1xuY29uc3QgbW9ja0ZldGNoID0gamVzdC5mbigpO1xuZ2xvYmFsLmZldGNoID0gbW9ja0ZldGNoIGFzIGFueTtcblxuZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nIEludGVncmF0aW9uJywgKCkgPT4ge1xuICBsZXQgY29uZmlnOiBhbnk7XG4gIGxldCBkcnVwYWxDbGllbnQ6IERydXBhbENsaWVudDtcbiAgbGV0IG1jcFNlcnZlcjogRHJ1cGFsTWNwU2VydmVyO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbmZpZyA9IHtcbiAgICAgIGRydXBhbDoge1xuICAgICAgICBiYXNlVXJsOiAnaHR0cDovL2xvY2FsaG9zdC9kcnVwYWwnLFxuICAgICAgICBlbmRwb2ludDogJy9qc29ucnBjJyxcbiAgICAgICAgdGltZW91dDogMTAwMDAsXG4gICAgICAgIHJldHJpZXM6IDMsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIG9hdXRoOiB7XG4gICAgICAgIGNsaWVudElkOiAndGVzdC1jbGllbnQtaWQnLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwOi8vbG9jYWxob3N0L2RydXBhbC9vYXV0aC9hdXRob3JpemUnLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiAnaHR0cDovL2xvY2FsaG9zdC9kcnVwYWwvb2F1dGgvdG9rZW4nLFxuICAgICAgICByZWRpcmVjdFVyaTogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9jYWxsYmFjaycsXG4gICAgICAgIHNjb3BlczogWyd0dXRvcmlhbDpyZWFkJywgJ3VzZXI6cHJvZmlsZSddLFxuICAgICAgfSxcbiAgICAgIGF1dGg6IHtcbiAgICAgICAgZW5hYmxlZDogZmFsc2UsIC8vIERpc2FibGUgYXV0aCBmb3IgZXJyb3IgaGFuZGxpbmcgdGVzdHNcbiAgICAgICAgcmVxdWlyZWRTY29wZXM6IFsndHV0b3JpYWw6cmVhZCddLFxuICAgICAgICBza2lwQXV0aDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICBtY3A6IHtcbiAgICAgICAgbmFtZTogJ3Rlc3QtZHJ1cGFsLWJyaWRnZS1tY3AnLFxuICAgICAgICB2ZXJzaW9uOiAnMS4wLjAtdGVzdCcsXG4gICAgICAgIHByb3RvY29sVmVyc2lvbjogJzIwMjQtMTEtMDUnLFxuICAgICAgICBjYXBhYmlsaXRpZXM6IHtcbiAgICAgICAgICByZXNvdXJjZXM6IHsgc3Vic2NyaWJlOiB0cnVlLCBsaXN0Q2hhbmdlZDogdHJ1ZSB9LFxuICAgICAgICAgIHRvb2xzOiB7IGxpc3RDaGFuZ2VkOiB0cnVlIH0sXG4gICAgICAgICAgcHJvbXB0czogeyBsaXN0Q2hhbmdlZDogdHJ1ZSB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHNlcnZlcjoge1xuICAgICAgICBwb3J0OiAzMDAwLFxuICAgICAgICBob3N0OiAnMC4wLjAuMCcsXG4gICAgICB9LFxuICAgICAgbG9nZ2luZzoge1xuICAgICAgICBsZXZlbDogJ2Vycm9yJyBhcyBjb25zdCxcbiAgICAgIH0sXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnIGFzIGNvbnN0LFxuICAgIH07XG4gICAgZHJ1cGFsQ2xpZW50ID0gbmV3IERydXBhbENsaWVudChjb25maWcuZHJ1cGFsKTtcbiAgICBtY3BTZXJ2ZXIgPSBuZXcgRHJ1cGFsTWNwU2VydmVyKGNvbmZpZyk7XG5cbiAgICAvLyBSZXNldCBhbGwgbW9ja3NcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnSlNPTi1SUEMgRXJyb3IgUmVzcG9uc2UgUGFyc2luZycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgcGFyc2Ugc3RhbmRhcmQgSlNPTi1SUEMgdmFsaWRhdGlvbiBlcnJvcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IEpzb25ScGNFcnJvclJlc3BvbnNlID0ge1xuICAgICAgICBqc29ucnBjOiAnMi4wJyxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAtMzI2MDIsXG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc2VhcmNoIHBhcmFtZXRlcnMnLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHR5cGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICAgIGRldGFpbHM6ICdTZWFyY2gga2V5d29yZHMgbXVzdCBiZSBhdCBsZWFzdCAyIGNoYXJhY3RlcnMnLFxuICAgICAgICAgICAgZmllbGQ6ICdrZXl3b3JkcycsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgaWQ6ICdzZWFyY2gtcmVxdWVzdC0wMDEnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgZXJyb3IgPSBwYXJzZUpzb25ScGNFcnJvcihlcnJvclJlc3BvbnNlLCAndGVzdC1yZXF1ZXN0LTEyMycpO1xuXG4gICAgICBleHBlY3QoZXJyb3IpLnRvQmVJbnN0YW5jZU9mKEludGVncmF0aW9uRXJyb3IpO1xuICAgICAgZXhwZWN0KGVycm9yLmVycm9yVHlwZSkudG9CZShJbnRlZ3JhdGlvbkVycm9yVHlwZS5WQUxJREFUSU9OX0VSUk9SKTtcbiAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdJbnZhbGlkIHNlYXJjaCBwYXJhbWV0ZXJzJyk7XG4gICAgICBleHBlY3QoZXJyb3IuZmllbGQpLnRvQmUoJ2tleXdvcmRzJyk7XG4gICAgICBleHBlY3QoZXJyb3IucmV0cnlhYmxlKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChlcnJvci5kZXRhaWxzPy5qc29ucnBjX2NvZGUpLnRvQmUoLTMyNjAyKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBwYXJzZSBKU09OLVJQQyBzZXJ2ZXIgZXJyb3IgYXMgcmV0cnlhYmxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3JSZXNwb25zZTogSnNvblJwY0Vycm9yUmVzcG9uc2UgPSB7XG4gICAgICAgIGpzb25ycGM6ICcyLjAnLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6IC0zMjYwMyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgfSxcbiAgICAgICAgaWQ6ICdzZWFyY2gtcmVxdWVzdC0wMDInLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgZXJyb3IgPSBwYXJzZUpzb25ScGNFcnJvcihlcnJvclJlc3BvbnNlKTtcblxuICAgICAgZXhwZWN0KGVycm9yLmVycm9yVHlwZSkudG9CZShJbnRlZ3JhdGlvbkVycm9yVHlwZS5TRVJWRVJfVU5BVkFJTEFCTEUpO1xuICAgICAgZXhwZWN0KGVycm9yLnJldHJ5YWJsZSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBwYXJzZSBjdXN0b20gRHJ1cGFsIHNlcnZlciBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvclJlc3BvbnNlOiBKc29uUnBjRXJyb3JSZXNwb25zZSA9IHtcbiAgICAgICAganNvbnJwYzogJzIuMCcsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogLTMyMDUwLFxuICAgICAgICAgIG1lc3NhZ2U6ICdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgZGV0YWlsczogJ0Nvbm5lY3Rpb24gdGltZW91dCBhZnRlciAzMCBzZWNvbmRzJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBpZDogJ3NlYXJjaC1yZXF1ZXN0LTAwMycsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBlcnJvciA9IHBhcnNlSnNvblJwY0Vycm9yKGVycm9yUmVzcG9uc2UpO1xuXG4gICAgICBleHBlY3QoZXJyb3IuZXJyb3JUeXBlKS50b0JlKEludGVncmF0aW9uRXJyb3JUeXBlLkRSVVBBTF9FUlJPUik7XG4gICAgICBleHBlY3QoZXJyb3IucmV0cnlhYmxlKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGVycm9yLmRldGFpbHM/LnNlcnZlcl9kZXRhaWxzKS50b0JlKFxuICAgICAgICAnQ29ubmVjdGlvbiB0aW1lb3V0IGFmdGVyIDMwIHNlY29uZHMnXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTmV0d29yayBFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIG5ldHdvcmsgdGltZW91dCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIGEgdGltZW91dCBlcnJvciAoQWJvcnRFcnJvcilcbiAgICAgIGNvbnN0IGFib3J0RXJyb3IgPSBuZXcgRXJyb3IoJ1RoZSB1c2VyIGFib3J0ZWQgYSByZXF1ZXN0Jyk7XG4gICAgICBhYm9ydEVycm9yLm5hbWUgPSAnQWJvcnRFcnJvcic7XG4gICAgICBtb2NrRmV0Y2gubW9ja1JlamVjdGVkVmFsdWUoYWJvcnRFcnJvcik7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRydXBhbENsaWVudC5zZWFyY2hUdXRvcmlhbHMoe1xuICAgICAgICAgIGtleXdvcmRzOiAndGVzdCBzZWFyY2gnLFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gSWYgd2UgcmVhY2ggaGVyZSwgdGhlIHRlc3Qgc2hvdWxkIGZhaWxcbiAgICAgICAgZXhwZWN0KHRydWUpLnRvQmUoZmFsc2UpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlSW5zdGFuY2VPZihJbnRlZ3JhdGlvbkVycm9yKTtcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgSW50ZWdyYXRpb25FcnJvcikge1xuICAgICAgICAgIC8vIEFsbCBlcnJvcnMgdGhyb3VnaCBKU09OLVJQQyBjbGllbnQgZ2V0IG5vcm1hbGl6ZWQgdG8gSlNPTlJQQ19FUlJPUlxuICAgICAgICAgIGV4cGVjdChlcnJvci5lcnJvclR5cGUpLnRvQmUoSW50ZWdyYXRpb25FcnJvclR5cGUuSlNPTlJQQ19FUlJPUik7XG4gICAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoJ1RoZSB1c2VyIGFib3J0ZWQgYSByZXF1ZXN0Jyk7XG4gICAgICAgICAgZXhwZWN0KGVycm9yLnJldHJ5YWJsZSkudG9CZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbmV0d29yayBjb25uZWN0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgYSBuZXR3b3JrIGNvbm5lY3Rpb24gZXJyb3JcbiAgICAgIG1vY2tGZXRjaC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgVHlwZUVycm9yKCdmZXRjaCBmYWlsZWQnKSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFVzZSBhIGRpZmZlcmVudCBtZXRob2QgdGhhdCB0aHJvd3MgZXJyb3JzIGluc3RlYWQgb2YgdGVzdENvbm5lY3Rpb24gd2hpY2ggc3dhbGxvd3MgdGhlbVxuICAgICAgICBhd2FpdCBkcnVwYWxDbGllbnQuc2VhcmNoVHV0b3JpYWxzKHsga2V5d29yZHM6ICd0ZXN0JyB9KTtcbiAgICAgICAgZXhwZWN0KHRydWUpLnRvQmUoZmFsc2UpOyAvLyBTaG91bGQgbm90IHJlYWNoIGhlcmVcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoSW50ZWdyYXRpb25FcnJvcik7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEludGVncmF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAvLyBOZXR3b3JrIGVycm9ycyBnZXQgd3JhcHBlZCBhZnRlciByZXRyaWVzXG4gICAgICAgICAgZXhwZWN0KGVycm9yLmVycm9yVHlwZSkudG9CZShJbnRlZ3JhdGlvbkVycm9yVHlwZS5KU09OUlBDX0VSUk9SKTtcbiAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdGYWlsZWQgYWZ0ZXIgMyBhdHRlbXB0cycpO1xuICAgICAgICAgIGV4cGVjdChlcnJvci5yZXRyeWFibGUpLnRvQmUoZmFsc2UpOyAvLyBGaW5hbCB3cmFwcGVkIGVycm9yIGlzIG5vdCByZXRyeWFibGVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgSlNPTiByZXNwb25zZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIGEgcmVzcG9uc2Ugd2l0aCBpbnZhbGlkIEpTT05cbiAgICAgIG1vY2tGZXRjaC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgZ2V0OiBqZXN0LmZuKChuYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGlmIChuYW1lID09PSAnY29udGVudC10eXBlJykgcmV0dXJuICdhcHBsaWNhdGlvbi9qc29uJztcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgICBqc29uOiBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IFN5bnRheEVycm9yKCdVbmV4cGVjdGVkIHRva2VuJykpLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkcnVwYWxDbGllbnQubG9hZE5vZGUoMTIzKTtcbiAgICAgICAgZXhwZWN0KHRydWUpLnRvQmUoZmFsc2UpOyAvLyBTaG91bGQgbm90IHJlYWNoIGhlcmVcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoSW50ZWdyYXRpb25FcnJvcik7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEludGVncmF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAvLyBBbGwgZXJyb3JzIHRocm91Z2ggSlNPTi1SUEMgY2xpZW50IGdldCBub3JtYWxpemVkIHRvIEpTT05SUENfRVJST1JcbiAgICAgICAgICBleHBlY3QoZXJyb3IuZXJyb3JUeXBlKS50b0JlKEludGVncmF0aW9uRXJyb3JUeXBlLkpTT05SUENfRVJST1IpO1xuICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdGYWlsZWQgdG8gcGFyc2UgSlNPTiByZXNwb25zZScpO1xuICAgICAgICAgIGV4cGVjdChlcnJvci5yZXRyeWFibGUpLnRvQmUoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdIVFRQIFN0YXR1cyBDb2RlIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgNDAxIGF1dGhlbnRpY2F0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tGZXRjaC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHN0YXR1czogNDAxLFxuICAgICAgICBzdGF0dXNUZXh0OiAnVW5hdXRob3JpemVkJyxcbiAgICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcpLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkcnVwYWxDbGllbnQuZ2V0Tm9kZXMoeyBsaW1pdDogNSB9KTtcbiAgICAgICAgZXhwZWN0KHRydWUpLnRvQmUoZmFsc2UpOyAvLyBTaG91bGQgbm90IHJlYWNoIGhlcmVcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoSW50ZWdyYXRpb25FcnJvcik7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEludGVncmF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAvLyBBbGwgZXJyb3JzIHRocm91Z2ggSlNPTi1SUEMgY2xpZW50IGdldCBub3JtYWxpemVkIHRvIEpTT05SUENfRVJST1JcbiAgICAgICAgICBleHBlY3QoZXJyb3IuZXJyb3JUeXBlKS50b0JlKEludGVncmF0aW9uRXJyb3JUeXBlLkpTT05SUENfRVJST1IpO1xuICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdIVFRQIDQwMTogVW5hdXRob3JpemVkJyk7XG4gICAgICAgICAgZXhwZWN0KGVycm9yLnJldHJ5YWJsZSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgZXhwZWN0KGVycm9yLmdldFVzZXJGcmllbmRseU1lc3NhZ2UoKSkudG9Db250YWluKCdTZXJ2ZXIgZXJyb3InKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSA0MjkgcmF0ZSBsaW1pdGluZyBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRmV0Y2gubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdGF0dXM6IDQyOSxcbiAgICAgICAgc3RhdHVzVGV4dDogJ1RvbyBNYW55IFJlcXVlc3RzJyxcbiAgICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdSYXRlIGxpbWl0IGV4Y2VlZGVkJyksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRydXBhbENsaWVudC5zZWFyY2hUdXRvcmlhbHMoeyBrZXl3b3JkczogJ3Rlc3QnIH0pO1xuICAgICAgICBleHBlY3QodHJ1ZSkudG9CZShmYWxzZSk7IC8vIFNob3VsZCBub3QgcmVhY2ggaGVyZVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlSW5zdGFuY2VPZihJbnRlZ3JhdGlvbkVycm9yKTtcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgSW50ZWdyYXRpb25FcnJvcikge1xuICAgICAgICAgIC8vIEFmdGVyIHJldHJ5IGxvZ2ljLCByYXRlIGxpbWl0IGVycm9ycyBnZXQgd3JhcHBlZCBhcyBKU09OUlBDX0VSUk9SXG4gICAgICAgICAgZXhwZWN0KGVycm9yLmVycm9yVHlwZSkudG9CZShJbnRlZ3JhdGlvbkVycm9yVHlwZS5KU09OUlBDX0VSUk9SKTtcbiAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdGYWlsZWQgYWZ0ZXIgMyBhdHRlbXB0cycpO1xuICAgICAgICAgIGV4cGVjdChlcnJvci5yZXRyeWFibGUpLnRvQmUoZmFsc2UpOyAvLyBGaW5hbCB3cmFwcGVkIGVycm9yIGlzIG5vdCByZXRyeWFibGVcbiAgICAgICAgICBleHBlY3QoZXJyb3IuZ2V0VXNlckZyaWVuZGx5TWVzc2FnZSgpKS50b0NvbnRhaW4oJ1NlcnZlciBlcnJvcicpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIDUwMCBzZXJ2ZXIgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgIHN0YXR1c1RleHQ6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLFxuICAgICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRydXBhbENsaWVudC5jcmVhdGVOb2RlKHtcbiAgICAgICAgICB0eXBlOiAnYXJ0aWNsZScsXG4gICAgICAgICAgdGl0bGU6ICdUZXN0IEFydGljbGUnLFxuICAgICAgICB9KTtcbiAgICAgICAgZXhwZWN0KHRydWUpLnRvQmUoZmFsc2UpOyAvLyBTaG91bGQgbm90IHJlYWNoIGhlcmVcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoSW50ZWdyYXRpb25FcnJvcik7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEludGVncmF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAvLyBBZnRlciByZXRyeSBsb2dpYywgc2VydmVyIGVycm9ycyBnZXQgd3JhcHBlZCBhcyBKU09OUlBDX0VSUk9SXG4gICAgICAgICAgZXhwZWN0KGVycm9yLmVycm9yVHlwZSkudG9CZShJbnRlZ3JhdGlvbkVycm9yVHlwZS5KU09OUlBDX0VSUk9SKTtcbiAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdGYWlsZWQgYWZ0ZXIgMyBhdHRlbXB0cycpO1xuICAgICAgICAgIGV4cGVjdChlcnJvci5yZXRyeWFibGUpLnRvQmUoZmFsc2UpOyAvLyBGaW5hbCB3cmFwcGVkIGVycm9yIGlzIG5vdCByZXRyeWFibGVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTUNQIFRvb2wgRXJyb3IgRm9ybWF0dGluZycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgZm9ybWF0IHZhbGlkYXRpb24gZXJyb3JzIGZvciBNQ1AgcmVzcG9uc2UnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZGF0aW9uRXJyb3IgPSBuZXcgSW50ZWdyYXRpb25FcnJvcihcbiAgICAgICAgSW50ZWdyYXRpb25FcnJvclR5cGUuVkFMSURBVElPTl9FUlJPUixcbiAgICAgICAgJ1NlYXJjaCBrZXl3b3JkcyBtdXN0IGJlIGF0IGxlYXN0IDIgY2hhcmFjdGVycycsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgJ2tleXdvcmRzJyxcbiAgICAgICAgeyBtaW5MZW5ndGg6IDIsIHByb3ZpZGVkOiAnYScgfSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICBmYWxzZVxuICAgICAgKTtcblxuICAgICAgY29uc3QgbWNwUmVzcG9uc2UgPSBmb3JtYXRNY3BFcnJvclJlc3BvbnNlKFxuICAgICAgICB2YWxpZGF0aW9uRXJyb3IsXG4gICAgICAgICd0ZXN0LXJlcS0xMjMnXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobWNwUmVzcG9uc2UuY29udGVudCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KG1jcFJlc3BvbnNlLmNvbnRlbnRbMF0udHlwZSkudG9CZSgndGV4dCcpO1xuXG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBKU09OLnBhcnNlKG1jcFJlc3BvbnNlLmNvbnRlbnRbMF0udGV4dCk7XG4gICAgICBleHBlY3QoZXJyb3JEYXRhLmVycm9yLnR5cGUpLnRvQmUoSW50ZWdyYXRpb25FcnJvclR5cGUuVkFMSURBVElPTl9FUlJPUik7XG4gICAgICBleHBlY3QoZXJyb3JEYXRhLmVycm9yLm1lc3NhZ2UpLnRvQ29udGFpbihcbiAgICAgICAgJ1BsZWFzZSBjaGVjayB0aGUga2V5d29yZHMgcGFyYW1ldGVyJ1xuICAgICAgKTtcbiAgICAgIGV4cGVjdChlcnJvckRhdGEuZXJyb3IuZGV0YWlscy5maWVsZCkudG9CZSgna2V5d29yZHMnKTtcbiAgICAgIGV4cGVjdChlcnJvckRhdGEuZXJyb3IuZGV0YWlscy5yZXRyeWFibGUpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGVycm9yRGF0YS5lcnJvci5kZXRhaWxzLnJlcXVlc3RfaWQpLnRvQmUoJ3Rlc3QtcmVxLTEyMycpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGZvcm1hdCBuZXR3b3JrIGVycm9ycyBmb3IgTUNQIHJlc3BvbnNlJywgKCkgPT4ge1xuICAgICAgY29uc3QgbmV0d29ya0Vycm9yID0gbmV3IEludGVncmF0aW9uRXJyb3IoXG4gICAgICAgIEludGVncmF0aW9uRXJyb3JUeXBlLk5FVFdPUktfRVJST1IsXG4gICAgICAgICdDb25uZWN0aW9uIHJlZnVzZWQnLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgeyBjb250ZXh0OiAnU2VhcmNoaW5nIHR1dG9yaWFscycgfSxcbiAgICAgICAgbmV3IEVycm9yKCdFQ09OTlJFRlVTRUQnKSxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcblxuICAgICAgY29uc3QgbWNwUmVzcG9uc2UgPSBmb3JtYXRNY3BFcnJvclJlc3BvbnNlKG5ldHdvcmtFcnJvcik7XG5cbiAgICAgIGNvbnN0IGVycm9yRGF0YSA9IEpTT04ucGFyc2UobWNwUmVzcG9uc2UuY29udGVudFswXS50ZXh0KTtcbiAgICAgIGV4cGVjdChlcnJvckRhdGEuZXJyb3IudHlwZSkudG9CZShJbnRlZ3JhdGlvbkVycm9yVHlwZS5ORVRXT1JLX0VSUk9SKTtcbiAgICAgIGV4cGVjdChlcnJvckRhdGEuZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdVbmFibGUgdG8gY29ubmVjdCcpO1xuICAgICAgZXhwZWN0KGVycm9yRGF0YS5lcnJvci5kZXRhaWxzLnJldHJ5YWJsZSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIE5vcm1hbGl6YXRpb24nLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIG5vcm1hbGl6ZSBnZW5lcmljIEVycm9yIHRvIEludGVncmF0aW9uRXJyb3InLCAoKSA9PiB7XG4gICAgICBjb25zdCBnZW5lcmljRXJyb3IgPSBuZXcgRXJyb3IoJ1NvbWV0aGluZyB3ZW50IHdyb25nJyk7XG4gICAgICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplRXJyb3IoZ2VuZXJpY0Vycm9yLCAnVGVzdCBvcGVyYXRpb24nKTtcblxuICAgICAgZXhwZWN0KG5vcm1hbGl6ZWQpLnRvQmVJbnN0YW5jZU9mKEludGVncmF0aW9uRXJyb3IpO1xuICAgICAgZXhwZWN0KG5vcm1hbGl6ZWQuZXJyb3JUeXBlKS50b0JlKEludGVncmF0aW9uRXJyb3JUeXBlLk5FVFdPUktfRVJST1IpO1xuICAgICAgZXhwZWN0KG5vcm1hbGl6ZWQubWVzc2FnZSkudG9Db250YWluKCdTb21ldGhpbmcgd2VudCB3cm9uZycpO1xuICAgICAgZXhwZWN0KG5vcm1hbGl6ZWQuZGV0YWlscz8uY29udGV4dCkudG9CZSgnVGVzdCBvcGVyYXRpb24nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBwcmVzZXJ2ZSBJbnRlZ3JhdGlvbkVycm9yIHdoZW4gbm9ybWFsaXppbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbEVycm9yID0gbmV3IEludGVncmF0aW9uRXJyb3IoXG4gICAgICAgIEludGVncmF0aW9uRXJyb3JUeXBlLlZBTElEQVRJT05fRVJST1IsXG4gICAgICAgICdJbnZhbGlkIHBhcmFtZXRlcicsXG4gICAgICAgIDQwMCxcbiAgICAgICAgJ3Rlc3RfZmllbGQnXG4gICAgICApO1xuXG4gICAgICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplRXJyb3Iob3JpZ2luYWxFcnJvciwgJ1Rlc3Qgb3BlcmF0aW9uJyk7XG5cbiAgICAgIGV4cGVjdChub3JtYWxpemVkKS50b0JlKG9yaWdpbmFsRXJyb3IpOyAvLyBTaG91bGQgYmUgdGhlIHNhbWUgaW5zdGFuY2VcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgdW5rbm93biBlcnJvciB0eXBlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHVua25vd25FcnJvciA9IHsgbWVzc2FnZTogJ1Vua25vd24gZXJyb3InLCBjb2RlOiAnVU5LTk9XTicgfTtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemVFcnJvcih1bmtub3duRXJyb3IsICdUZXN0IG9wZXJhdGlvbicpO1xuXG4gICAgICBleHBlY3Qobm9ybWFsaXplZC5lcnJvclR5cGUpLnRvQmUoSW50ZWdyYXRpb25FcnJvclR5cGUuTkVUV09SS19FUlJPUik7XG4gICAgICBleHBlY3Qobm9ybWFsaXplZC5tZXNzYWdlKS50b0NvbnRhaW4oJ1Rlc3Qgb3BlcmF0aW9uOiBbb2JqZWN0IE9iamVjdF0nKTsgLy8gU2luY2Ugd2UncmUgcGFzc2luZyBhbiBvYmplY3QsIGl0IGdldHMgc3RyaW5naWZpZWRcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==