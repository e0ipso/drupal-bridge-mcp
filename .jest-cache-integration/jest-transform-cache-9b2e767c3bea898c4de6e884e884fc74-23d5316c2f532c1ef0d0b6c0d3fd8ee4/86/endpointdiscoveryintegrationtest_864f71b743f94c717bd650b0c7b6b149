5d13ea8c2c36238a5afe96f7b701dc8f
"use strict";
/**
 * Endpoint Discovery Integration Tests
 *
 * Tests real-world endpoint discovery scenarios including:
 * - Successful discovery from .well-known endpoints
 * - Fallback to standard endpoints when discovery fails
 * - Network timeout and error handling
 * - Cache behavior and TTL validation
 * - Different server configurations and responses
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const endpoint_discovery_js_1 = require("@/auth/endpoint-discovery.js");
const http_1 = require("http");
(0, globals_1.describe)('Endpoint Discovery Integration Tests', () => {
    let mockServer;
    let serverPort;
    (0, globals_1.beforeAll)(async () => {
        mockServer = await createDiscoveryTestServer();
        const address = mockServer.address();
        serverPort = address.port;
    });
    (0, globals_1.afterAll)(async () => {
        if (mockServer) {
            await new Promise(resolve => {
                mockServer.close(() => resolve());
            });
        }
    });
    (0, globals_1.beforeEach)(() => {
        (0, endpoint_discovery_js_1.clearDiscoveryCache)();
        globals_1.jest.clearAllMocks();
    });
    (0, globals_1.describe)('Real Server Discovery Integration', () => {
        (0, globals_1.test)('should discover endpoints from real HTTP server with complete metadata', async () => {
            setMockResponse('complete');
            const endpoints = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                timeout: 5000,
                debug: true,
            });
            (0, globals_1.expect)(endpoints.isFallback).toBe(false);
            (0, globals_1.expect)(endpoints.authorizationEndpoint).toBe(`http://localhost:${serverPort}/oauth/authorize`);
            (0, globals_1.expect)(endpoints.tokenEndpoint).toBe(`http://localhost:${serverPort}/oauth/token`);
            (0, globals_1.expect)(endpoints.issuer).toBe(`http://localhost:${serverPort}`);
            (0, globals_1.expect)(endpoints.discoveredAt).toBeInstanceOf(Date);
            (0, globals_1.expect)(endpoints.metadata).toBeDefined();
            (0, globals_1.expect)(endpoints.metadata.code_challenge_methods_supported).toContain('S256');
        });
        (0, globals_1.test)('should discover endpoints from real HTTP server with minimal metadata', async () => {
            setMockResponse('minimal');
            const endpoints = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                timeout: 5000,
            });
            (0, globals_1.expect)(endpoints.isFallback).toBe(false);
            (0, globals_1.expect)(endpoints.authorizationEndpoint).toBe(`http://localhost:${serverPort}/oauth/authorize`);
            (0, globals_1.expect)(endpoints.tokenEndpoint).toBe(`http://localhost:${serverPort}/oauth/token`);
            (0, globals_1.expect)(endpoints.issuer).toBe(`http://localhost:${serverPort}`);
        });
        (0, globals_1.test)('should handle Drupal-specific endpoint paths', async () => {
            setMockResponse('drupal');
            const endpoints = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                timeout: 5000,
            });
            (0, globals_1.expect)(endpoints.isFallback).toBe(false);
            (0, globals_1.expect)(endpoints.authorizationEndpoint).toBe(`http://localhost:${serverPort}/oauth/authorize`);
            (0, globals_1.expect)(endpoints.tokenEndpoint).toBe(`http://localhost:${serverPort}/oauth/token`);
        });
    });
    (0, globals_1.describe)('Real Network Error Scenarios', () => {
        (0, globals_1.test)('should handle real server errors and fallback appropriately', async () => {
            // Test 404 response from real server
            setMockResponse('not_found');
            const notFoundResult = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                timeout: 2000,
                retries: 1,
            });
            (0, globals_1.expect)(notFoundResult.isFallback).toBe(true);
            (0, globals_1.expect)(notFoundResult.metadata).toBeUndefined();
            // Test invalid JSON from real server
            setMockResponse('invalid_json');
            const invalidJsonResult = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                timeout: 2000,
                retries: 1,
            });
            (0, globals_1.expect)(invalidJsonResult.isFallback).toBe(true);
            // Test server error from real server
            setMockResponse('server_error');
            const serverErrorResult = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                timeout: 2000,
                retries: 1,
            });
            (0, globals_1.expect)(serverErrorResult.isFallback).toBe(true);
        });
        (0, globals_1.test)('should handle real network timeout scenarios', async () => {
            setMockResponse('timeout');
            const endpoints = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                timeout: 100, // Very short timeout
                retries: 0,
            });
            (0, globals_1.expect)(endpoints.isFallback).toBe(true);
        });
    });
    (0, globals_1.describe)('Real-world Server Compatibility', () => {
        (0, globals_1.test)('should handle content-type variations', async () => {
            setMockResponse('content_type_charset');
            const endpoints = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
            });
            (0, globals_1.expect)(endpoints.isFallback).toBe(false);
        });
        (0, globals_1.test)('should handle extra metadata fields gracefully', async () => {
            setMockResponse('extra_fields');
            const endpoints = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
            });
            (0, globals_1.expect)(endpoints.isFallback).toBe(false);
            (0, globals_1.expect)(endpoints.metadata).toBeDefined();
        });
        (0, globals_1.test)('should work with different endpoint path conventions', async () => {
            setMockResponse('different_paths');
            const endpoints = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
            });
            (0, globals_1.expect)(endpoints.isFallback).toBe(false);
            (0, globals_1.expect)(endpoints.authorizationEndpoint).toBe(`http://localhost:${serverPort}/auth/oauth2/authorize`);
            (0, globals_1.expect)(endpoints.tokenEndpoint).toBe(`http://localhost:${serverPort}/auth/oauth2/token`);
        });
    });
    (0, globals_1.describe)('Configuration Options', () => {
        (0, globals_1.test)('should respect custom timeout settings', async () => {
            setMockResponse('slow_response');
            // Short timeout should cause fallback
            const endpointsShortTimeout = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                timeout: 100,
                retries: 0,
            });
            (0, globals_1.expect)(endpointsShortTimeout.isFallback).toBe(true);
            (0, endpoint_discovery_js_1.clearDiscoveryCache)();
            // Longer timeout should succeed
            const endpointsLongTimeout = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                timeout: 2000,
                retries: 0,
            });
            (0, globals_1.expect)(endpointsLongTimeout.isFallback).toBe(false);
        });
        (0, globals_1.test)('should respect retry configuration', async () => {
            setMockResponse('intermittent_failure');
            // No retries should fail quickly
            const endpointsNoRetry = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                retries: 0,
            });
            (0, globals_1.expect)(endpointsNoRetry.isFallback).toBe(true);
            (0, endpoint_discovery_js_1.clearDiscoveryCache)();
            // Multiple retries should eventually succeed
            const endpointsWithRetry = await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                retries: 3,
            });
            (0, globals_1.expect)(endpointsWithRetry.isFallback).toBe(false);
        });
        (0, globals_1.test)('should support debug mode', async () => {
            const consoleSpy = globals_1.jest.spyOn(console, 'log').mockImplementation();
            setMockResponse('complete');
            await (0, endpoint_discovery_js_1.discoverOAuthEndpoints)({
                baseUrl: `http://localhost:${serverPort}`,
                debug: true,
            });
            (0, globals_1.expect)(consoleSpy).toHaveBeenCalledWith(globals_1.expect.stringContaining('[Discovery] Discovering OAuth endpoints'));
            consoleSpy.mockRestore();
        });
    });
});
// Mock server implementation with various response scenarios
let mockResponseType = 'complete';
let requestCount = 0;
function setMockResponse(type) {
    mockResponseType = type;
    requestCount = 0;
}
async function createDiscoveryTestServer() {
    return new Promise(resolve => {
        const server = (0, http_1.createServer)((req, res) => {
            const url = new URL(req.url || '', `http://localhost`);
            if (url.pathname === '/.well-known/oauth-authorization-server') {
                handleDiscoveryRequest(req, res);
            }
            else {
                res.writeHead(404);
                res.end('Not found');
            }
        });
        server.listen(0, '127.0.0.1', () => {
            resolve(server);
        });
    });
}
function handleDiscoveryRequest(req, res) {
    requestCount++;
    const address = req.socket.address();
    const baseUrl = `http://localhost:${address.port}`;
    switch (mockResponseType) {
        case 'complete':
            res.writeHead(200, { 'Content-Type': 'application/json' });
            res.end(JSON.stringify({
                issuer: baseUrl,
                authorization_endpoint: `${baseUrl}/oauth/authorize`,
                token_endpoint: `${baseUrl}/oauth/token`,
                jwks_uri: `${baseUrl}/.well-known/jwks.json`,
                scopes_supported: ['read', 'write', 'tutorial:read'],
                response_types_supported: ['code'],
                grant_types_supported: ['authorization_code', 'refresh_token'],
                code_challenge_methods_supported: ['S256'],
                token_endpoint_auth_methods_supported: ['none'],
            }));
            break;
        case 'minimal':
            res.writeHead(200, { 'Content-Type': 'application/json' });
            res.end(JSON.stringify({
                issuer: baseUrl,
                authorization_endpoint: `${baseUrl}/oauth/authorize`,
                token_endpoint: `${baseUrl}/oauth/token`,
            }));
            break;
        case 'drupal':
            res.writeHead(200, { 'Content-Type': 'application/json' });
            res.end(JSON.stringify({
                issuer: baseUrl,
                authorization_endpoint: `${baseUrl}/oauth/authorize`,
                token_endpoint: `${baseUrl}/oauth/token`,
                scopes_supported: ['tutorial:read', 'user:profile'],
                response_types_supported: ['code'],
                grant_types_supported: ['authorization_code', 'refresh_token'],
                code_challenge_methods_supported: ['S256'],
            }));
            break;
        case 'not_found':
            res.writeHead(404);
            res.end('Not Found');
            break;
        case 'invalid_json':
            res.writeHead(200, { 'Content-Type': 'application/json' });
            res.end('{ invalid json');
            break;
        case 'missing_fields':
            res.writeHead(200, { 'Content-Type': 'application/json' });
            res.end(JSON.stringify({
                issuer: baseUrl,
                // Missing required authorization_endpoint and token_endpoint
            }));
            break;
        case 'server_error':
            res.writeHead(500);
            res.end('Internal Server Error');
            break;
        case 'timeout':
            // Don't respond (simulate timeout)
            break;
        case 'content_type_charset':
            res.writeHead(200, { 'Content-Type': 'application/json; charset=utf-8' });
            res.end(JSON.stringify({
                issuer: baseUrl,
                authorization_endpoint: `${baseUrl}/oauth/authorize`,
                token_endpoint: `${baseUrl}/oauth/token`,
            }));
            break;
        case 'extra_fields':
            res.writeHead(200, { 'Content-Type': 'application/json' });
            res.end(JSON.stringify({
                issuer: baseUrl,
                authorization_endpoint: `${baseUrl}/oauth/authorize`,
                token_endpoint: `${baseUrl}/oauth/token`,
                custom_field: 'custom_value',
                another_extension: { nested: 'data' },
            }));
            break;
        case 'different_paths':
            res.writeHead(200, { 'Content-Type': 'application/json' });
            res.end(JSON.stringify({
                issuer: baseUrl,
                authorization_endpoint: `${baseUrl}/auth/oauth2/authorize`,
                token_endpoint: `${baseUrl}/auth/oauth2/token`,
            }));
            break;
        case 'slow_response':
            setTimeout(() => {
                res.writeHead(200, { 'Content-Type': 'application/json' });
                res.end(JSON.stringify({
                    issuer: baseUrl,
                    authorization_endpoint: `${baseUrl}/oauth/authorize`,
                    token_endpoint: `${baseUrl}/oauth/token`,
                }));
            }, 500); // 500ms delay
            break;
        case 'intermittent_failure':
            if (requestCount <= 2) {
                res.writeHead(500);
                res.end('Temporary server error');
            }
            else {
                res.writeHead(200, { 'Content-Type': 'application/json' });
                res.end(JSON.stringify({
                    issuer: baseUrl,
                    authorization_endpoint: `${baseUrl}/oauth/authorize`,
                    token_endpoint: `${baseUrl}/oauth/token`,
                }));
            }
            break;
        default:
            res.writeHead(500);
            res.end('Unknown mock response type');
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9lbmRwb2ludC1kaXNjb3ZlcnktaW50ZWdyYXRpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7OztHQVNHOztBQUVILDJDQVF1QjtBQUN2Qix3RUFHc0M7QUFDdEMsK0JBQW9DO0FBSXBDLElBQUEsa0JBQVEsRUFBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7SUFDcEQsSUFBSSxVQUFrQixDQUFDO0lBQ3ZCLElBQUksVUFBa0IsQ0FBQztJQUV2QixJQUFBLG1CQUFTLEVBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsVUFBVSxHQUFHLE1BQU0seUJBQXlCLEVBQUUsQ0FBQztRQUMvQyxNQUFNLE9BQU8sR0FBRyxVQUFVLENBQUMsT0FBTyxFQUFpQixDQUFDO1FBQ3BELFVBQVUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQzVCLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLEtBQUssSUFBSSxFQUFFO1FBQ2xCLElBQUksVUFBVSxFQUFFLENBQUM7WUFDZixNQUFNLElBQUksT0FBTyxDQUFPLE9BQU8sQ0FBQyxFQUFFO2dCQUNoQyxVQUFVLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDcEMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLG9CQUFVLEVBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBQSwyQ0FBbUIsR0FBRSxDQUFDO1FBQ3RCLGNBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7UUFDakQsSUFBQSxjQUFJLEVBQUMsd0VBQXdFLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEYsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRTVCLE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBQSw4Q0FBc0Is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RVI7WUFDRSxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ25CLEdBQUcsQ0FBQyxHQUFHLENBQUMsNEJBQTRCLENBQUMsQ0FBQztJQUMxQyxDQUFDO0FBQ0gsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvd29ya3NwYWNlL3Rlc3RzL2ludGVncmF0aW9uL2VuZHBvaW50LWRpc2NvdmVyeS1pbnRlZ3JhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRW5kcG9pbnQgRGlzY292ZXJ5IEludGVncmF0aW9uIFRlc3RzXG4gKlxuICogVGVzdHMgcmVhbC13b3JsZCBlbmRwb2ludCBkaXNjb3Zlcnkgc2NlbmFyaW9zIGluY2x1ZGluZzpcbiAqIC0gU3VjY2Vzc2Z1bCBkaXNjb3ZlcnkgZnJvbSAud2VsbC1rbm93biBlbmRwb2ludHNcbiAqIC0gRmFsbGJhY2sgdG8gc3RhbmRhcmQgZW5kcG9pbnRzIHdoZW4gZGlzY292ZXJ5IGZhaWxzXG4gKiAtIE5ldHdvcmsgdGltZW91dCBhbmQgZXJyb3IgaGFuZGxpbmdcbiAqIC0gQ2FjaGUgYmVoYXZpb3IgYW5kIFRUTCB2YWxpZGF0aW9uXG4gKiAtIERpZmZlcmVudCBzZXJ2ZXIgY29uZmlndXJhdGlvbnMgYW5kIHJlc3BvbnNlc1xuICovXG5cbmltcG9ydCB7XG4gIGRlc2NyaWJlLFxuICB0ZXN0LFxuICBleHBlY3QsXG4gIGJlZm9yZUVhY2gsXG4gIGplc3QsXG4gIGJlZm9yZUFsbCxcbiAgYWZ0ZXJBbGwsXG59IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHtcbiAgZGlzY292ZXJPQXV0aEVuZHBvaW50cyxcbiAgY2xlYXJEaXNjb3ZlcnlDYWNoZSxcbn0gZnJvbSAnQC9hdXRoL2VuZHBvaW50LWRpc2NvdmVyeS5qcyc7XG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXIgfSBmcm9tICdodHRwJztcbmltcG9ydCB0eXBlIHsgU2VydmVyIH0gZnJvbSAnaHR0cCc7XG5pbXBvcnQgdHlwZSB7IEFkZHJlc3NJbmZvIH0gZnJvbSAnbmV0JztcblxuZGVzY3JpYmUoJ0VuZHBvaW50IERpc2NvdmVyeSBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IG1vY2tTZXJ2ZXI6IFNlcnZlcjtcbiAgbGV0IHNlcnZlclBvcnQ6IG51bWJlcjtcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tTZXJ2ZXIgPSBhd2FpdCBjcmVhdGVEaXNjb3ZlcnlUZXN0U2VydmVyKCk7XG4gICAgY29uc3QgYWRkcmVzcyA9IG1vY2tTZXJ2ZXIuYWRkcmVzcygpIGFzIEFkZHJlc3NJbmZvO1xuICAgIHNlcnZlclBvcnQgPSBhZGRyZXNzLnBvcnQ7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICBpZiAobW9ja1NlcnZlcikge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4ocmVzb2x2ZSA9PiB7XG4gICAgICAgIG1vY2tTZXJ2ZXIuY2xvc2UoKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgY2xlYXJEaXNjb3ZlcnlDYWNoZSgpO1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVhbCBTZXJ2ZXIgRGlzY292ZXJ5IEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBkaXNjb3ZlciBlbmRwb2ludHMgZnJvbSByZWFsIEhUVFAgc2VydmVyIHdpdGggY29tcGxldGUgbWV0YWRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBzZXRNb2NrUmVzcG9uc2UoJ2NvbXBsZXRlJyk7XG5cbiAgICAgIGNvbnN0IGVuZHBvaW50cyA9IGF3YWl0IGRpc2NvdmVyT0F1dGhFbmRwb2ludHMoe1xuICAgICAgICBiYXNlVXJsOiBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9YCxcbiAgICAgICAgdGltZW91dDogNTAwMCxcbiAgICAgICAgZGVidWc6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGVuZHBvaW50cy5pc0ZhbGxiYWNrKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChlbmRwb2ludHMuYXV0aG9yaXphdGlvbkVuZHBvaW50KS50b0JlKFxuICAgICAgICBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9L29hdXRoL2F1dGhvcml6ZWBcbiAgICAgICk7XG4gICAgICBleHBlY3QoZW5kcG9pbnRzLnRva2VuRW5kcG9pbnQpLnRvQmUoXG4gICAgICAgIGBodHRwOi8vbG9jYWxob3N0OiR7c2VydmVyUG9ydH0vb2F1dGgvdG9rZW5gXG4gICAgICApO1xuICAgICAgZXhwZWN0KGVuZHBvaW50cy5pc3N1ZXIpLnRvQmUoYGh0dHA6Ly9sb2NhbGhvc3Q6JHtzZXJ2ZXJQb3J0fWApO1xuICAgICAgZXhwZWN0KGVuZHBvaW50cy5kaXNjb3ZlcmVkQXQpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgICAgZXhwZWN0KGVuZHBvaW50cy5tZXRhZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChlbmRwb2ludHMubWV0YWRhdGEhLmNvZGVfY2hhbGxlbmdlX21ldGhvZHNfc3VwcG9ydGVkKS50b0NvbnRhaW4oXG4gICAgICAgICdTMjU2J1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBkaXNjb3ZlciBlbmRwb2ludHMgZnJvbSByZWFsIEhUVFAgc2VydmVyIHdpdGggbWluaW1hbCBtZXRhZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgIHNldE1vY2tSZXNwb25zZSgnbWluaW1hbCcpO1xuXG4gICAgICBjb25zdCBlbmRwb2ludHMgPSBhd2FpdCBkaXNjb3Zlck9BdXRoRW5kcG9pbnRzKHtcbiAgICAgICAgYmFzZVVybDogYGh0dHA6Ly9sb2NhbGhvc3Q6JHtzZXJ2ZXJQb3J0fWAsXG4gICAgICAgIHRpbWVvdXQ6IDUwMDAsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGVuZHBvaW50cy5pc0ZhbGxiYWNrKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChlbmRwb2ludHMuYXV0aG9yaXphdGlvbkVuZHBvaW50KS50b0JlKFxuICAgICAgICBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9L29hdXRoL2F1dGhvcml6ZWBcbiAgICAgICk7XG4gICAgICBleHBlY3QoZW5kcG9pbnRzLnRva2VuRW5kcG9pbnQpLnRvQmUoXG4gICAgICAgIGBodHRwOi8vbG9jYWxob3N0OiR7c2VydmVyUG9ydH0vb2F1dGgvdG9rZW5gXG4gICAgICApO1xuICAgICAgZXhwZWN0KGVuZHBvaW50cy5pc3N1ZXIpLnRvQmUoYGh0dHA6Ly9sb2NhbGhvc3Q6JHtzZXJ2ZXJQb3J0fWApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBEcnVwYWwtc3BlY2lmaWMgZW5kcG9pbnQgcGF0aHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBzZXRNb2NrUmVzcG9uc2UoJ2RydXBhbCcpO1xuXG4gICAgICBjb25zdCBlbmRwb2ludHMgPSBhd2FpdCBkaXNjb3Zlck9BdXRoRW5kcG9pbnRzKHtcbiAgICAgICAgYmFzZVVybDogYGh0dHA6Ly9sb2NhbGhvc3Q6JHtzZXJ2ZXJQb3J0fWAsXG4gICAgICAgIHRpbWVvdXQ6IDUwMDAsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGVuZHBvaW50cy5pc0ZhbGxiYWNrKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChlbmRwb2ludHMuYXV0aG9yaXphdGlvbkVuZHBvaW50KS50b0JlKFxuICAgICAgICBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9L29hdXRoL2F1dGhvcml6ZWBcbiAgICAgICk7XG4gICAgICBleHBlY3QoZW5kcG9pbnRzLnRva2VuRW5kcG9pbnQpLnRvQmUoXG4gICAgICAgIGBodHRwOi8vbG9jYWxob3N0OiR7c2VydmVyUG9ydH0vb2F1dGgvdG9rZW5gXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVhbCBOZXR3b3JrIEVycm9yIFNjZW5hcmlvcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIHJlYWwgc2VydmVyIGVycm9ycyBhbmQgZmFsbGJhY2sgYXBwcm9wcmlhdGVseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgNDA0IHJlc3BvbnNlIGZyb20gcmVhbCBzZXJ2ZXJcbiAgICAgIHNldE1vY2tSZXNwb25zZSgnbm90X2ZvdW5kJyk7XG4gICAgICBjb25zdCBub3RGb3VuZFJlc3VsdCA9IGF3YWl0IGRpc2NvdmVyT0F1dGhFbmRwb2ludHMoe1xuICAgICAgICBiYXNlVXJsOiBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9YCxcbiAgICAgICAgdGltZW91dDogMjAwMCxcbiAgICAgICAgcmV0cmllczogMSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG5vdEZvdW5kUmVzdWx0LmlzRmFsbGJhY2spLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3Qobm90Rm91bmRSZXN1bHQubWV0YWRhdGEpLnRvQmVVbmRlZmluZWQoKTtcblxuICAgICAgLy8gVGVzdCBpbnZhbGlkIEpTT04gZnJvbSByZWFsIHNlcnZlclxuICAgICAgc2V0TW9ja1Jlc3BvbnNlKCdpbnZhbGlkX2pzb24nKTtcbiAgICAgIGNvbnN0IGludmFsaWRKc29uUmVzdWx0ID0gYXdhaXQgZGlzY292ZXJPQXV0aEVuZHBvaW50cyh7XG4gICAgICAgIGJhc2VVcmw6IGBodHRwOi8vbG9jYWxob3N0OiR7c2VydmVyUG9ydH1gLFxuICAgICAgICB0aW1lb3V0OiAyMDAwLFxuICAgICAgICByZXRyaWVzOiAxLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoaW52YWxpZEpzb25SZXN1bHQuaXNGYWxsYmFjaykudG9CZSh0cnVlKTtcblxuICAgICAgLy8gVGVzdCBzZXJ2ZXIgZXJyb3IgZnJvbSByZWFsIHNlcnZlclxuICAgICAgc2V0TW9ja1Jlc3BvbnNlKCdzZXJ2ZXJfZXJyb3InKTtcbiAgICAgIGNvbnN0IHNlcnZlckVycm9yUmVzdWx0ID0gYXdhaXQgZGlzY292ZXJPQXV0aEVuZHBvaW50cyh7XG4gICAgICAgIGJhc2VVcmw6IGBodHRwOi8vbG9jYWxob3N0OiR7c2VydmVyUG9ydH1gLFxuICAgICAgICB0aW1lb3V0OiAyMDAwLFxuICAgICAgICByZXRyaWVzOiAxLFxuICAgICAgfSk7XG4gICAgICBleHBlY3Qoc2VydmVyRXJyb3JSZXN1bHQuaXNGYWxsYmFjaykudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgcmVhbCBuZXR3b3JrIHRpbWVvdXQgc2NlbmFyaW9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgc2V0TW9ja1Jlc3BvbnNlKCd0aW1lb3V0Jyk7XG5cbiAgICAgIGNvbnN0IGVuZHBvaW50cyA9IGF3YWl0IGRpc2NvdmVyT0F1dGhFbmRwb2ludHMoe1xuICAgICAgICBiYXNlVXJsOiBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9YCxcbiAgICAgICAgdGltZW91dDogMTAwLCAvLyBWZXJ5IHNob3J0IHRpbWVvdXRcbiAgICAgICAgcmV0cmllczogMCxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoZW5kcG9pbnRzLmlzRmFsbGJhY2spLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSZWFsLXdvcmxkIFNlcnZlciBDb21wYXRpYmlsaXR5JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgY29udGVudC10eXBlIHZhcmlhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBzZXRNb2NrUmVzcG9uc2UoJ2NvbnRlbnRfdHlwZV9jaGFyc2V0Jyk7XG5cbiAgICAgIGNvbnN0IGVuZHBvaW50cyA9IGF3YWl0IGRpc2NvdmVyT0F1dGhFbmRwb2ludHMoe1xuICAgICAgICBiYXNlVXJsOiBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9YCxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoZW5kcG9pbnRzLmlzRmFsbGJhY2spLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBleHRyYSBtZXRhZGF0YSBmaWVsZHMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIHNldE1vY2tSZXNwb25zZSgnZXh0cmFfZmllbGRzJyk7XG5cbiAgICAgIGNvbnN0IGVuZHBvaW50cyA9IGF3YWl0IGRpc2NvdmVyT0F1dGhFbmRwb2ludHMoe1xuICAgICAgICBiYXNlVXJsOiBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9YCxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoZW5kcG9pbnRzLmlzRmFsbGJhY2spLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGVuZHBvaW50cy5tZXRhZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB3b3JrIHdpdGggZGlmZmVyZW50IGVuZHBvaW50IHBhdGggY29udmVudGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBzZXRNb2NrUmVzcG9uc2UoJ2RpZmZlcmVudF9wYXRocycpO1xuXG4gICAgICBjb25zdCBlbmRwb2ludHMgPSBhd2FpdCBkaXNjb3Zlck9BdXRoRW5kcG9pbnRzKHtcbiAgICAgICAgYmFzZVVybDogYGh0dHA6Ly9sb2NhbGhvc3Q6JHtzZXJ2ZXJQb3J0fWAsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGVuZHBvaW50cy5pc0ZhbGxiYWNrKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChlbmRwb2ludHMuYXV0aG9yaXphdGlvbkVuZHBvaW50KS50b0JlKFxuICAgICAgICBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9L2F1dGgvb2F1dGgyL2F1dGhvcml6ZWBcbiAgICAgICk7XG4gICAgICBleHBlY3QoZW5kcG9pbnRzLnRva2VuRW5kcG9pbnQpLnRvQmUoXG4gICAgICAgIGBodHRwOi8vbG9jYWxob3N0OiR7c2VydmVyUG9ydH0vYXV0aC9vYXV0aDIvdG9rZW5gXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29uZmlndXJhdGlvbiBPcHRpb25zJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCByZXNwZWN0IGN1c3RvbSB0aW1lb3V0IHNldHRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgc2V0TW9ja1Jlc3BvbnNlKCdzbG93X3Jlc3BvbnNlJyk7XG5cbiAgICAgIC8vIFNob3J0IHRpbWVvdXQgc2hvdWxkIGNhdXNlIGZhbGxiYWNrXG4gICAgICBjb25zdCBlbmRwb2ludHNTaG9ydFRpbWVvdXQgPSBhd2FpdCBkaXNjb3Zlck9BdXRoRW5kcG9pbnRzKHtcbiAgICAgICAgYmFzZVVybDogYGh0dHA6Ly9sb2NhbGhvc3Q6JHtzZXJ2ZXJQb3J0fWAsXG4gICAgICAgIHRpbWVvdXQ6IDEwMCxcbiAgICAgICAgcmV0cmllczogMCxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGVuZHBvaW50c1Nob3J0VGltZW91dC5pc0ZhbGxiYWNrKS50b0JlKHRydWUpO1xuXG4gICAgICBjbGVhckRpc2NvdmVyeUNhY2hlKCk7XG5cbiAgICAgIC8vIExvbmdlciB0aW1lb3V0IHNob3VsZCBzdWNjZWVkXG4gICAgICBjb25zdCBlbmRwb2ludHNMb25nVGltZW91dCA9IGF3YWl0IGRpc2NvdmVyT0F1dGhFbmRwb2ludHMoe1xuICAgICAgICBiYXNlVXJsOiBgaHR0cDovL2xvY2FsaG9zdDoke3NlcnZlclBvcnR9YCxcbiAgICAgICAgdGltZW91dDogMjAwMCxcbiAgICAgICAgcmV0cmllczogMCxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGVuZHBvaW50c0xvbmdUaW1lb3V0LmlzRmFsbGJhY2spLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHJlc3BlY3QgcmV0cnkgY29uZmlndXJhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHNldE1vY2tSZXNwb25zZSgnaW50ZXJtaXR0ZW50X2ZhaWx1cmUnKTtcblxuICAgICAgLy8gTm8gcmV0cmllcyBzaG91bGQgZmFpbCBxdWlja2x5XG4gICAgICBjb25zdCBlbmRwb2ludHNOb1JldHJ5ID0gYXdhaXQgZGlzY292ZXJPQXV0aEVuZHBvaW50cyh7XG4gICAgICAgIGJhc2VVcmw6IGBodHRwOi8vbG9jYWxob3N0OiR7c2VydmVyUG9ydH1gLFxuICAgICAgICByZXRyaWVzOiAwLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoZW5kcG9pbnRzTm9SZXRyeS5pc0ZhbGxiYWNrKS50b0JlKHRydWUpO1xuXG4gICAgICBjbGVhckRpc2NvdmVyeUNhY2hlKCk7XG5cbiAgICAgIC8vIE11bHRpcGxlIHJldHJpZXMgc2hvdWxkIGV2ZW50dWFsbHkgc3VjY2VlZFxuICAgICAgY29uc3QgZW5kcG9pbnRzV2l0aFJldHJ5ID0gYXdhaXQgZGlzY292ZXJPQXV0aEVuZHBvaW50cyh7XG4gICAgICAgIGJhc2VVcmw6IGBodHRwOi8vbG9jYWxob3N0OiR7c2VydmVyUG9ydH1gLFxuICAgICAgICByZXRyaWVzOiAzLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoZW5kcG9pbnRzV2l0aFJldHJ5LmlzRmFsbGJhY2spLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHN1cHBvcnQgZGVidWcgbW9kZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdsb2cnKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcblxuICAgICAgc2V0TW9ja1Jlc3BvbnNlKCdjb21wbGV0ZScpO1xuXG4gICAgICBhd2FpdCBkaXNjb3Zlck9BdXRoRW5kcG9pbnRzKHtcbiAgICAgICAgYmFzZVVybDogYGh0dHA6Ly9sb2NhbGhvc3Q6JHtzZXJ2ZXJQb3J0fWAsXG4gICAgICAgIGRlYnVnOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChjb25zb2xlU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1tEaXNjb3ZlcnldIERpc2NvdmVyaW5nIE9BdXRoIGVuZHBvaW50cycpXG4gICAgICApO1xuXG4gICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbi8vIE1vY2sgc2VydmVyIGltcGxlbWVudGF0aW9uIHdpdGggdmFyaW91cyByZXNwb25zZSBzY2VuYXJpb3NcbmxldCBtb2NrUmVzcG9uc2VUeXBlOiBzdHJpbmcgPSAnY29tcGxldGUnO1xubGV0IHJlcXVlc3RDb3VudCA9IDA7XG5cbmZ1bmN0aW9uIHNldE1vY2tSZXNwb25zZSh0eXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgbW9ja1Jlc3BvbnNlVHlwZSA9IHR5cGU7XG4gIHJlcXVlc3RDb3VudCA9IDA7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZURpc2NvdmVyeVRlc3RTZXJ2ZXIoKTogUHJvbWlzZTxTZXJ2ZXI+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlPFNlcnZlcj4ocmVzb2x2ZSA9PiB7XG4gICAgY29uc3Qgc2VydmVyID0gY3JlYXRlU2VydmVyKChyZXEsIHJlcykgPT4ge1xuICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsIHx8ICcnLCBgaHR0cDovL2xvY2FsaG9zdGApO1xuXG4gICAgICBpZiAodXJsLnBhdGhuYW1lID09PSAnLy53ZWxsLWtub3duL29hdXRoLWF1dGhvcml6YXRpb24tc2VydmVyJykge1xuICAgICAgICBoYW5kbGVEaXNjb3ZlcnlSZXF1ZXN0KHJlcSwgcmVzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcy53cml0ZUhlYWQoNDA0KTtcbiAgICAgICAgcmVzLmVuZCgnTm90IGZvdW5kJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBzZXJ2ZXIubGlzdGVuKDAsICcxMjcuMC4wLjEnLCAoKSA9PiB7XG4gICAgICByZXNvbHZlKHNlcnZlcik7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEaXNjb3ZlcnlSZXF1ZXN0KHJlcTogYW55LCByZXM6IGFueSk6IHZvaWQge1xuICByZXF1ZXN0Q291bnQrKztcbiAgY29uc3QgYWRkcmVzcyA9IHJlcS5zb2NrZXQuYWRkcmVzcygpO1xuICBjb25zdCBiYXNlVXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6JHthZGRyZXNzLnBvcnR9YDtcblxuICBzd2l0Y2ggKG1vY2tSZXNwb25zZVR5cGUpIHtcbiAgICBjYXNlICdjb21wbGV0ZSc6XG4gICAgICByZXMud3JpdGVIZWFkKDIwMCwgeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xuICAgICAgcmVzLmVuZChcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGlzc3VlcjogYmFzZVVybCxcbiAgICAgICAgICBhdXRob3JpemF0aW9uX2VuZHBvaW50OiBgJHtiYXNlVXJsfS9vYXV0aC9hdXRob3JpemVgLFxuICAgICAgICAgIHRva2VuX2VuZHBvaW50OiBgJHtiYXNlVXJsfS9vYXV0aC90b2tlbmAsXG4gICAgICAgICAgandrc191cmk6IGAke2Jhc2VVcmx9Ly53ZWxsLWtub3duL2p3a3MuanNvbmAsXG4gICAgICAgICAgc2NvcGVzX3N1cHBvcnRlZDogWydyZWFkJywgJ3dyaXRlJywgJ3R1dG9yaWFsOnJlYWQnXSxcbiAgICAgICAgICByZXNwb25zZV90eXBlc19zdXBwb3J0ZWQ6IFsnY29kZSddLFxuICAgICAgICAgIGdyYW50X3R5cGVzX3N1cHBvcnRlZDogWydhdXRob3JpemF0aW9uX2NvZGUnLCAncmVmcmVzaF90b2tlbiddLFxuICAgICAgICAgIGNvZGVfY2hhbGxlbmdlX21ldGhvZHNfc3VwcG9ydGVkOiBbJ1MyNTYnXSxcbiAgICAgICAgICB0b2tlbl9lbmRwb2ludF9hdXRoX21ldGhvZHNfc3VwcG9ydGVkOiBbJ25vbmUnXSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ21pbmltYWwnOlxuICAgICAgcmVzLndyaXRlSGVhZCgyMDAsIHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9KTtcbiAgICAgIHJlcy5lbmQoXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBpc3N1ZXI6IGJhc2VVcmwsXG4gICAgICAgICAgYXV0aG9yaXphdGlvbl9lbmRwb2ludDogYCR7YmFzZVVybH0vb2F1dGgvYXV0aG9yaXplYCxcbiAgICAgICAgICB0b2tlbl9lbmRwb2ludDogYCR7YmFzZVVybH0vb2F1dGgvdG9rZW5gLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnZHJ1cGFsJzpcbiAgICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSk7XG4gICAgICByZXMuZW5kKFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgaXNzdWVyOiBiYXNlVXJsLFxuICAgICAgICAgIGF1dGhvcml6YXRpb25fZW5kcG9pbnQ6IGAke2Jhc2VVcmx9L29hdXRoL2F1dGhvcml6ZWAsXG4gICAgICAgICAgdG9rZW5fZW5kcG9pbnQ6IGAke2Jhc2VVcmx9L29hdXRoL3Rva2VuYCxcbiAgICAgICAgICBzY29wZXNfc3VwcG9ydGVkOiBbJ3R1dG9yaWFsOnJlYWQnLCAndXNlcjpwcm9maWxlJ10sXG4gICAgICAgICAgcmVzcG9uc2VfdHlwZXNfc3VwcG9ydGVkOiBbJ2NvZGUnXSxcbiAgICAgICAgICBncmFudF90eXBlc19zdXBwb3J0ZWQ6IFsnYXV0aG9yaXphdGlvbl9jb2RlJywgJ3JlZnJlc2hfdG9rZW4nXSxcbiAgICAgICAgICBjb2RlX2NoYWxsZW5nZV9tZXRob2RzX3N1cHBvcnRlZDogWydTMjU2J10sXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlICdub3RfZm91bmQnOlxuICAgICAgcmVzLndyaXRlSGVhZCg0MDQpO1xuICAgICAgcmVzLmVuZCgnTm90IEZvdW5kJyk7XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ2ludmFsaWRfanNvbic6XG4gICAgICByZXMud3JpdGVIZWFkKDIwMCwgeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xuICAgICAgcmVzLmVuZCgneyBpbnZhbGlkIGpzb24nKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnbWlzc2luZ19maWVsZHMnOlxuICAgICAgcmVzLndyaXRlSGVhZCgyMDAsIHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9KTtcbiAgICAgIHJlcy5lbmQoXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBpc3N1ZXI6IGJhc2VVcmwsXG4gICAgICAgICAgLy8gTWlzc2luZyByZXF1aXJlZCBhdXRob3JpemF0aW9uX2VuZHBvaW50IGFuZCB0b2tlbl9lbmRwb2ludFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnc2VydmVyX2Vycm9yJzpcbiAgICAgIHJlcy53cml0ZUhlYWQoNTAwKTtcbiAgICAgIHJlcy5lbmQoJ0ludGVybmFsIFNlcnZlciBFcnJvcicpO1xuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlICd0aW1lb3V0JzpcbiAgICAgIC8vIERvbid0IHJlc3BvbmQgKHNpbXVsYXRlIHRpbWVvdXQpXG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ2NvbnRlbnRfdHlwZV9jaGFyc2V0JzpcbiAgICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcgfSk7XG4gICAgICByZXMuZW5kKFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgaXNzdWVyOiBiYXNlVXJsLFxuICAgICAgICAgIGF1dGhvcml6YXRpb25fZW5kcG9pbnQ6IGAke2Jhc2VVcmx9L29hdXRoL2F1dGhvcml6ZWAsXG4gICAgICAgICAgdG9rZW5fZW5kcG9pbnQ6IGAke2Jhc2VVcmx9L29hdXRoL3Rva2VuYCxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ2V4dHJhX2ZpZWxkcyc6XG4gICAgICByZXMud3JpdGVIZWFkKDIwMCwgeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xuICAgICAgcmVzLmVuZChcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGlzc3VlcjogYmFzZVVybCxcbiAgICAgICAgICBhdXRob3JpemF0aW9uX2VuZHBvaW50OiBgJHtiYXNlVXJsfS9vYXV0aC9hdXRob3JpemVgLFxuICAgICAgICAgIHRva2VuX2VuZHBvaW50OiBgJHtiYXNlVXJsfS9vYXV0aC90b2tlbmAsXG4gICAgICAgICAgY3VzdG9tX2ZpZWxkOiAnY3VzdG9tX3ZhbHVlJyxcbiAgICAgICAgICBhbm90aGVyX2V4dGVuc2lvbjogeyBuZXN0ZWQ6ICdkYXRhJyB9LFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnZGlmZmVyZW50X3BhdGhzJzpcbiAgICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSk7XG4gICAgICByZXMuZW5kKFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgaXNzdWVyOiBiYXNlVXJsLFxuICAgICAgICAgIGF1dGhvcml6YXRpb25fZW5kcG9pbnQ6IGAke2Jhc2VVcmx9L2F1dGgvb2F1dGgyL2F1dGhvcml6ZWAsXG4gICAgICAgICAgdG9rZW5fZW5kcG9pbnQ6IGAke2Jhc2VVcmx9L2F1dGgvb2F1dGgyL3Rva2VuYCxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ3Nsb3dfcmVzcG9uc2UnOlxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSk7XG4gICAgICAgIHJlcy5lbmQoXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgaXNzdWVyOiBiYXNlVXJsLFxuICAgICAgICAgICAgYXV0aG9yaXphdGlvbl9lbmRwb2ludDogYCR7YmFzZVVybH0vb2F1dGgvYXV0aG9yaXplYCxcbiAgICAgICAgICAgIHRva2VuX2VuZHBvaW50OiBgJHtiYXNlVXJsfS9vYXV0aC90b2tlbmAsXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH0sIDUwMCk7IC8vIDUwMG1zIGRlbGF5XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ2ludGVybWl0dGVudF9mYWlsdXJlJzpcbiAgICAgIGlmIChyZXF1ZXN0Q291bnQgPD0gMikge1xuICAgICAgICByZXMud3JpdGVIZWFkKDUwMCk7XG4gICAgICAgIHJlcy5lbmQoJ1RlbXBvcmFyeSBzZXJ2ZXIgZXJyb3InKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSk7XG4gICAgICAgIHJlcy5lbmQoXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgaXNzdWVyOiBiYXNlVXJsLFxuICAgICAgICAgICAgYXV0aG9yaXphdGlvbl9lbmRwb2ludDogYCR7YmFzZVVybH0vb2F1dGgvYXV0aG9yaXplYCxcbiAgICAgICAgICAgIHRva2VuX2VuZHBvaW50OiBgJHtiYXNlVXJsfS9vYXV0aC90b2tlbmAsXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJlcy53cml0ZUhlYWQoNTAwKTtcbiAgICAgIHJlcy5lbmQoJ1Vua25vd24gbW9jayByZXNwb25zZSB0eXBlJyk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==