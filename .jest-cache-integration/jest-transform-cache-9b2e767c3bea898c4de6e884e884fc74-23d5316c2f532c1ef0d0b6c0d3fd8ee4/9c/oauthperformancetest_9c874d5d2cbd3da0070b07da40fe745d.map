{"file":"/workspace/tests/integration/oauth-performance.test.ts","mappings":"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","names":[],"sources":["/workspace/tests/integration/oauth-performance.test.ts"],"sourcesContent":["/**\n * OAuth 2.1 Performance and Latency Validation Tests\n *\n * Tests performance characteristics of the OAuth 2.1 implementation:\n * - Authentication flow latency requirements\n * - PKCE challenge generation performance\n * - Endpoint discovery performance\n * - Token exchange throughput\n * - Memory usage optimization\n * - Concurrent authentication handling\n */\n\nimport {\n  describe,\n  test,\n  expect,\n  beforeEach,\n  afterEach,\n  jest,\n  beforeAll,\n  afterAll,\n} from '@jest/globals';\nimport { OAuthClient } from '@/auth/oauth-client.js';\nimport {\n  discoverOAuthEndpoints,\n  clearDiscoveryCache,\n} from '@/auth/endpoint-discovery.js';\nimport type { OAuthTokens } from '@/auth/oauth-client.js';\nimport { createServer } from 'http';\nimport type { Server } from 'http';\nimport type { AddressInfo } from 'net';\n\ndescribe('OAuth 2.1 Performance and Latency Tests', () => {\n  let mockOAuthServer: Server;\n  let serverPort: number;\n  let oauthClient: OAuthClient;\n\n  beforeAll(async () => {\n    mockOAuthServer = await createPerformanceTestServer();\n    const address = mockOAuthServer.address() as AddressInfo;\n    serverPort = address.port;\n\n    oauthClient = new OAuthClient({\n      clientId: 'test-client-id',\n      authorizationEndpoint: `http://localhost:${serverPort}/oauth/authorize`,\n      tokenEndpoint: `http://localhost:${serverPort}/oauth/token`,\n      redirectUri: 'http://127.0.0.1:3000/callback',\n      scopes: ['tutorial:read', 'user:profile'],\n    });\n  });\n\n  afterAll(async () => {\n    if (mockOAuthServer) {\n      await new Promise<void>(resolve => {\n        mockOAuthServer.close(() => resolve());\n      });\n    }\n  });\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    clearDiscoveryCache();\n  });\n\n  describe('PKCE Performance Benchmarks', () => {\n    test('should generate PKCE challenge within acceptable time limits', () => {\n      const iterations = 1000;\n      const startTime = performance.now();\n\n      for (let i = 0; i < iterations; i++) {\n        oauthClient.generatePKCEChallenge();\n      }\n\n      const endTime = performance.now();\n      const totalTime = endTime - startTime;\n      const averageTime = totalTime / iterations;\n\n      // Should generate PKCE challenge in under 1ms on average\n      expect(averageTime).toBeLessThan(1);\n\n      // Total time for 1000 generations should be under 100ms\n      expect(totalTime).toBeLessThan(100);\n\n      console.log(\n        `PKCE generation: ${averageTime.toFixed(3)}ms average, ${totalTime.toFixed(1)}ms total`\n      );\n    });\n\n    test('should maintain consistent PKCE generation performance', () => {\n      const measurements: number[] = [];\n      const batches = 10;\n      const batchSize = 100;\n\n      for (let batch = 0; batch < batches; batch++) {\n        const startTime = performance.now();\n\n        for (let i = 0; i < batchSize; i++) {\n          oauthClient.generatePKCEChallenge();\n        }\n\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const averageTime =\n        measurements.reduce((a, b) => a + b, 0) / measurements.length;\n      const maxTime = Math.max(...measurements);\n      const minTime = Math.min(...measurements);\n\n      // Performance should be consistent (max shouldn't be more than 5x min)\n      expect(maxTime / minTime).toBeLessThan(5);\n\n      // Average batch time should be reasonable\n      expect(averageTime).toBeLessThan(50);\n\n      console.log(\n        `PKCE consistency: avg=${averageTime.toFixed(1)}ms, min=${minTime.toFixed(1)}ms, max=${maxTime.toFixed(1)}ms`\n      );\n    });\n\n    test('should not consume excessive memory during PKCE generation', () => {\n      const initialMemory = process.memoryUsage().heapUsed;\n      const iterations = 10000;\n\n      // Generate many PKCE challenges\n      for (let i = 0; i < iterations; i++) {\n        oauthClient.generatePKCEChallenge();\n      }\n\n      // Force garbage collection if available\n      if (global.gc) {\n        global.gc();\n      }\n\n      const finalMemory = process.memoryUsage().heapUsed;\n      const memoryIncrease = (finalMemory - initialMemory) / 1024 / 1024; // MB\n\n      // Memory increase should be minimal (less than 10MB for 10k generations)\n      expect(memoryIncrease).toBeLessThan(10);\n\n      console.log(\n        `PKCE memory usage: ${memoryIncrease.toFixed(2)}MB increase for ${iterations} generations`\n      );\n    });\n  });\n\n  describe('Token Exchange Performance', () => {\n    test('should complete token exchange within latency requirements', async () => {\n      const iterations = 50;\n      const measurements: number[] = [];\n\n      setMockTokenResponse({\n        accessToken: 'test_access_token',\n        refreshToken: 'test_refresh_token',\n        tokenType: 'Bearer',\n        expiresIn: 3600,\n      });\n\n      for (let i = 0; i < iterations; i++) {\n        const challenge = oauthClient.generatePKCEChallenge();\n        const startTime = performance.now();\n\n        const exchangeMethod = (oauthClient as any).exchangeCodeForTokens.bind(\n          oauthClient\n        );\n\n        await exchangeMethod(`test_code_${i}`, challenge.codeVerifier);\n\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const averageTime =\n        measurements.reduce((a, b) => a + b, 0) / measurements.length;\n      const maxTime = Math.max(...measurements);\n      const p95Time = measurements.sort((a, b) => a - b)[\n        Math.floor(measurements.length * 0.95)\n      ];\n\n      // Average token exchange should be under 50ms\n      expect(averageTime).toBeLessThan(50);\n\n      // 95th percentile should be under 100ms\n      expect(p95Time).toBeLessThan(100);\n\n      // No single exchange should take more than 200ms\n      expect(maxTime).toBeLessThan(200);\n\n      console.log(\n        `Token exchange: avg=${averageTime.toFixed(1)}ms, p95=${p95Time.toFixed(1)}ms, max=${maxTime.toFixed(1)}ms`\n      );\n    });\n\n    test('should handle concurrent token exchanges efficiently', async () => {\n      const concurrency = 10;\n      const iterations = 5;\n\n      setMockTokenResponse({\n        accessToken: 'concurrent_access_token',\n        tokenType: 'Bearer',\n        expiresIn: 3600,\n      });\n\n      const startTime = performance.now();\n\n      const promises = Array.from({ length: concurrency }, async (_, i) => {\n        const measurements: number[] = [];\n\n        for (let j = 0; j < iterations; j++) {\n          const challenge = oauthClient.generatePKCEChallenge();\n          const exchangeStart = performance.now();\n\n          const exchangeMethod = (\n            oauthClient as any\n          ).exchangeCodeForTokens.bind(oauthClient);\n\n          await exchangeMethod(\n            `concurrent_code_${i}_${j}`,\n            challenge.codeVerifier\n          );\n\n          measurements.push(performance.now() - exchangeStart);\n        }\n\n        return measurements;\n      });\n\n      const results = await Promise.all(promises);\n      const endTime = performance.now();\n\n      const allMeasurements = results.flat();\n      const averageTime =\n        allMeasurements.reduce((a, b) => a + b, 0) / allMeasurements.length;\n      const totalTime = endTime - startTime;\n\n      // Concurrent operations shouldn't significantly degrade performance\n      expect(averageTime).toBeLessThan(100);\n\n      // Total time should show concurrency benefit\n      expect(totalTime).toBeLessThan(concurrency * iterations * 50);\n\n      console.log(\n        `Concurrent exchanges: ${concurrency}x${iterations} in ${totalTime.toFixed(1)}ms, avg=${averageTime.toFixed(1)}ms`\n      );\n    });\n\n    test('should maintain performance under token refresh load', async () => {\n      const iterations = 100;\n      const measurements: number[] = [];\n\n      setMockTokenResponse({\n        accessToken: 'refreshed_access_token',\n        refreshToken: 'new_refresh_token',\n        tokenType: 'Bearer',\n        expiresIn: 3600,\n      });\n\n      for (let i = 0; i < iterations; i++) {\n        const startTime = performance.now();\n\n        await oauthClient.refreshToken(`refresh_token_${i}`);\n\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const averageTime =\n        measurements.reduce((a, b) => a + b, 0) / measurements.length;\n      const maxTime = Math.max(...measurements);\n\n      // Token refresh should be consistently fast\n      expect(averageTime).toBeLessThan(30);\n      expect(maxTime).toBeLessThan(100);\n\n      console.log(\n        `Token refresh: avg=${averageTime.toFixed(1)}ms, max=${maxTime.toFixed(1)}ms for ${iterations} refreshes`\n      );\n    });\n  });\n\n  describe('Endpoint Discovery Performance', () => {\n    test('should complete discovery within acceptable time limits', async () => {\n      const iterations = 20;\n      const measurements: number[] = [];\n\n      setServerBehavior('fast_discovery');\n\n      for (let i = 0; i < iterations; i++) {\n        clearDiscoveryCache(); // Force fresh discovery each time\n\n        const startTime = performance.now();\n\n        await discoverOAuthEndpoints({\n          baseUrl: `http://localhost:${serverPort}`,\n          timeout: 5000,\n        });\n\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const averageTime =\n        measurements.reduce((a, b) => a + b, 0) / measurements.length;\n      const maxTime = Math.max(...measurements);\n\n      // Discovery should be fast\n      expect(averageTime).toBeLessThan(100);\n      expect(maxTime).toBeLessThan(200);\n\n      console.log(\n        `Discovery: avg=${averageTime.toFixed(1)}ms, max=${maxTime.toFixed(1)}ms`\n      );\n    });\n\n    test('should demonstrate cache performance benefits', async () => {\n      const iterations = 50;\n\n      setServerBehavior('fast_discovery');\n\n      // Measure first discovery (cache miss)\n      clearDiscoveryCache();\n      const firstDiscoveryStart = performance.now();\n      await discoverOAuthEndpoints({\n        baseUrl: `http://localhost:${serverPort}`,\n        cacheTtl: 60000,\n      });\n      const firstDiscoveryTime = performance.now() - firstDiscoveryStart;\n\n      // Measure cached discoveries\n      const cachedMeasurements: number[] = [];\n\n      for (let i = 0; i < iterations; i++) {\n        const startTime = performance.now();\n\n        await discoverOAuthEndpoints({\n          baseUrl: `http://localhost:${serverPort}`,\n          cacheTtl: 60000,\n        });\n\n        const endTime = performance.now();\n        cachedMeasurements.push(endTime - startTime);\n      }\n\n      const averageCachedTime =\n        cachedMeasurements.reduce((a, b) => a + b, 0) /\n        cachedMeasurements.length;\n\n      // Cached access should be much faster than initial discovery\n      expect(averageCachedTime).toBeLessThan(firstDiscoveryTime / 5);\n      expect(averageCachedTime).toBeLessThan(5); // Should be very fast\n\n      console.log(\n        `Discovery cache: first=${firstDiscoveryTime.toFixed(1)}ms, cached avg=${averageCachedTime.toFixed(3)}ms`\n      );\n    });\n\n    test('should handle discovery fallback efficiently', async () => {\n      const iterations = 10;\n      const measurements: number[] = [];\n\n      setServerBehavior('discovery_failure');\n\n      for (let i = 0; i < iterations; i++) {\n        clearDiscoveryCache();\n\n        const startTime = performance.now();\n\n        const endpoints = await discoverOAuthEndpoints({\n          baseUrl: `http://localhost:${serverPort}`,\n          timeout: 1000,\n          retries: 1,\n        });\n\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n\n        expect(endpoints.isFallback).toBe(true);\n      }\n\n      const averageTime =\n        measurements.reduce((a, b) => a + b, 0) / measurements.length;\n\n      // Fallback should complete within reasonable time\n      expect(averageTime).toBeLessThan(3000); // Should include timeout + retry\n\n      console.log(`Discovery fallback: avg=${averageTime.toFixed(1)}ms`);\n    });\n  });\n\n  describe('Memory Usage Optimization', () => {\n    test('should not leak memory during repeated OAuth flows', async () => {\n      const initialMemory = process.memoryUsage().heapUsed;\n      const iterations = 100;\n\n      setMockTokenResponse({\n        accessToken: 'memory_test_token',\n        tokenType: 'Bearer',\n        expiresIn: 3600,\n      });\n\n      for (let i = 0; i < iterations; i++) {\n        const challenge = oauthClient.generatePKCEChallenge();\n\n        const exchangeMethod = (oauthClient as any).exchangeCodeForTokens.bind(\n          oauthClient\n        );\n\n        await exchangeMethod(`memory_test_code_${i}`, challenge.codeVerifier);\n      }\n\n      // Force garbage collection if available\n      if (global.gc) {\n        global.gc();\n      }\n\n      const finalMemory = process.memoryUsage().heapUsed;\n      const memoryIncrease = (finalMemory - initialMemory) / 1024 / 1024; // MB\n\n      // Memory increase should be minimal\n      expect(memoryIncrease).toBeLessThan(5);\n\n      console.log(\n        `OAuth flows memory: ${memoryIncrease.toFixed(2)}MB increase for ${iterations} flows`\n      );\n    });\n\n    test('should efficiently manage discovery cache memory', async () => {\n      const initialMemory = process.memoryUsage().heapUsed;\n      const baseUrls = Array.from(\n        { length: 100 },\n        (_, i) => `http://localhost:${serverPort}/site${i}`\n      );\n\n      setServerBehavior('fast_discovery');\n\n      // Fill cache with many entries\n      for (const baseUrl of baseUrls) {\n        await discoverOAuthEndpoints({\n          baseUrl,\n          cacheTtl: 60000,\n        });\n      }\n\n      if (global.gc) {\n        global.gc();\n      }\n\n      const finalMemory = process.memoryUsage().heapUsed;\n      const memoryIncrease = (finalMemory - initialMemory) / 1024 / 1024; // MB\n\n      // Memory usage should be reasonable for cached data\n      expect(memoryIncrease).toBeLessThan(10);\n\n      console.log(\n        `Discovery cache memory: ${memoryIncrease.toFixed(2)}MB for ${baseUrls.length} cached entries`\n      );\n    });\n  });\n\n  describe('Throughput Benchmarks', () => {\n    test('should achieve acceptable PKCE generation throughput', () => {\n      const duration = 1000; // 1 second\n      const startTime = performance.now();\n      let count = 0;\n\n      while (performance.now() - startTime < duration) {\n        oauthClient.generatePKCEChallenge();\n        count++;\n      }\n\n      const actualDuration = performance.now() - startTime;\n      const throughput = (count / actualDuration) * 1000; // ops per second\n\n      // Should generate at least 1000 PKCE challenges per second\n      expect(throughput).toBeGreaterThan(1000);\n\n      console.log(`PKCE throughput: ${throughput.toFixed(0)} challenges/sec`);\n    });\n\n    test('should handle high-frequency token operations', async () => {\n      const operations = 100;\n      const startTime = performance.now();\n\n      setMockTokenResponse({\n        accessToken: 'throughput_test_token',\n        tokenType: 'Bearer',\n        expiresIn: 3600,\n      });\n\n      const promises = Array.from({ length: operations }, async (_, i) => {\n        const challenge = oauthClient.generatePKCEChallenge();\n        const exchangeMethod = (oauthClient as any).exchangeCodeForTokens.bind(\n          oauthClient\n        );\n        return exchangeMethod(`throughput_code_${i}`, challenge.codeVerifier);\n      });\n\n      await Promise.all(promises);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n      const throughput = (operations / duration) * 1000; // ops per second\n\n      // Should handle significant token operation throughput\n      expect(throughput).toBeGreaterThan(10);\n\n      console.log(\n        `Token operation throughput: ${throughput.toFixed(1)} ops/sec`\n      );\n    });\n  });\n});\n\n// Mock server implementation for performance testing\nlet serverBehavior = 'fast_discovery';\nlet mockTokenResponse: OAuthTokens | null = null;\n\nfunction setServerBehavior(behavior: string): void {\n  serverBehavior = behavior;\n}\n\nfunction setMockTokenResponse(tokens: OAuthTokens): void {\n  mockTokenResponse = tokens;\n}\n\nasync function createPerformanceTestServer(): Promise<Server> {\n  return new Promise<Server>(resolve => {\n    const server = createServer((req, res) => {\n      const url = new URL(req.url || '', `http://localhost`);\n\n      if (url.pathname === '/.well-known/oauth-authorization-server') {\n        handlePerformanceDiscoveryRequest(req, res);\n      } else if (url.pathname === '/oauth/token' && req.method === 'POST') {\n        handlePerformanceTokenRequest(req, res);\n      } else {\n        res.writeHead(404);\n        res.end('Not found');\n      }\n    });\n\n    server.listen(0, '127.0.0.1', () => {\n      resolve(server);\n    });\n  });\n}\n\nfunction handlePerformanceDiscoveryRequest(req: any, res: any): void {\n  const address = req.socket.address();\n  const baseUrl = `http://localhost:${address.port}`;\n\n  switch (serverBehavior) {\n    case 'discovery_failure':\n      res.writeHead(404);\n      res.end('Not Found');\n      break;\n\n    case 'fast_discovery':\n    default:\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(\n        JSON.stringify({\n          issuer: baseUrl,\n          authorization_endpoint: `${baseUrl}/oauth/authorize`,\n          token_endpoint: `${baseUrl}/oauth/token`,\n          response_types_supported: ['code'],\n          grant_types_supported: ['authorization_code', 'refresh_token'],\n          code_challenge_methods_supported: ['S256'],\n        })\n      );\n  }\n}\n\nfunction handlePerformanceTokenRequest(req: any, res: any): void {\n  if (mockTokenResponse) {\n    res.writeHead(200, { 'Content-Type': 'application/json' });\n    res.end(\n      JSON.stringify({\n        access_token: mockTokenResponse.accessToken,\n        refresh_token: mockTokenResponse.refreshToken,\n        token_type: mockTokenResponse.tokenType,\n        expires_in: mockTokenResponse.expiresIn,\n        scope: mockTokenResponse.scope,\n      })\n    );\n  } else {\n    res.writeHead(500, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ error: 'server_error' }));\n  }\n}\n"],"version":3}