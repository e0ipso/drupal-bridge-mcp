{"file":"/workspace/tests/mcp/search-tutorials.test.ts","mappings":"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","names":[],"sources":["/workspace/tests/mcp/search-tutorials.test.ts"],"sourcesContent":["/**\n * Tests for search_tutorials MCP tool functionality\n */\n\nimport { DrupalMcpServer } from '@/mcp/server.js';\nimport {\n  validateSearchContentParams,\n  ValidationError,\n} from '@/utils/validation.js';\nimport type { AppConfig } from '@/config/index.js';\nimport type {\n  SearchContentResponse,\n  ProcessedSearchContentParams,\n} from '@/types/index.js';\n\n// Mock configuration for testing\nconst mockConfig: AppConfig = {\n  drupal: {\n    baseUrl: 'http://localhost/drupal',\n    endpoint: '/jsonrpc',\n    timeout: 10000,\n    retries: 3,\n    headers: {\n      'Content-Type': 'application/json',\n      Accept: 'application/json',\n    },\n  },\n  mcp: {\n    name: 'test-mcp-server',\n    version: '1.0.0',\n    protocolVersion: '2024-11-05',\n    capabilities: {\n      tools: { listChanged: true },\n      resources: { subscribe: true, listChanged: true },\n      prompts: { listChanged: true },\n    },\n  },\n  oauth: {\n    clientId: 'test-client-id',\n    authorizationEndpoint: 'http://localhost/oauth/authorize',\n    tokenEndpoint: 'http://localhost/oauth/token',\n    redirectUri: 'http://localhost/callback',\n    scopes: ['read'],\n  },\n  auth: {\n    enabled: false, // Disable auth for tests\n    requiredScopes: ['read'],\n    skipAuth: true,\n  },\n  server: {\n    port: 3000,\n    host: 'localhost',\n  },\n  logging: {\n    level: 'info',\n  },\n  environment: 'test',\n};\n\ndescribe('Search Tutorials MCP Tool', () => {\n  let mcpServer: DrupalMcpServer;\n\n  beforeEach(() => {\n    mcpServer = new DrupalMcpServer(mockConfig);\n  });\n\n  afterEach(async () => {\n    await mcpServer.close();\n  });\n\n  describe('Parameter Validation', () => {\n    describe('validateSearchContentParams', () => {\n      it('should validate valid parameters successfully', () => {\n        const validParams = {\n          keywords: 'drupal configuration',\n          types: ['tutorial', 'topic'],\n          drupal_version: ['10', '11'],\n          category: ['configuration', 'settings'],\n          sort: 'search_api_relevance',\n          page: { limit: 10, offset: 0 },\n        };\n\n        const result = validateSearchContentParams(validParams);\n\n        expect(result).toEqual({\n          keywords: 'drupal configuration',\n          types: ['tutorial', 'topic'],\n          drupal_version: ['10', '11'],\n          category: ['configuration', 'settings'],\n          sort: 'search_api_relevance',\n          page: { limit: 10, offset: 0 },\n        });\n      });\n\n      it('should validate minimal parameters (keywords only)', () => {\n        const minimalParams = { keywords: 'test' };\n        const result = validateSearchContentParams(minimalParams);\n\n        expect(result).toEqual({\n          keywords: 'test',\n          types: ['tutorial', 'topic', 'course'], // default values\n          drupal_version: undefined,\n          category: undefined,\n          sort: 'search_api_relevance',\n          page: { limit: 10, offset: 0 },\n        });\n      });\n\n      it('should throw ValidationError for missing keywords', () => {\n        expect(() => validateSearchContentParams({})).toThrow(ValidationError);\n        expect(() => validateSearchContentParams({ keywords: '' })).toThrow(\n          ValidationError\n        );\n      });\n\n      it('should throw ValidationError for invalid keywords type', () => {\n        expect(() => validateSearchContentParams({ keywords: 123 })).toThrow(\n          ValidationError\n        );\n        expect(() => validateSearchContentParams({ keywords: null })).toThrow(\n          ValidationError\n        );\n      });\n\n      it('should throw ValidationError for keywords too short', () => {\n        expect(() => validateSearchContentParams({ keywords: 'a' })).toThrow(\n          ValidationError\n        );\n      });\n\n      it('should throw ValidationError for invalid types array items', () => {\n        expect(() =>\n          validateSearchContentParams({\n            keywords: 'test',\n            types: ['invalid-type'],\n          })\n        ).toThrow(ValidationError);\n      });\n\n      it('should throw ValidationError for invalid drupal_version array items', () => {\n        expect(() =>\n          validateSearchContentParams({\n            keywords: 'test',\n            drupal_version: ['8'], // Invalid version\n          })\n        ).toThrow(ValidationError);\n      });\n\n      it('should validate drupal_version as array', () => {\n        const params = {\n          keywords: 'test',\n          drupal_version: ['9', '10', '11'],\n        };\n\n        const result = validateSearchContentParams(params);\n\n        expect(result.drupal_version).toEqual(['9', '10', '11']);\n      });\n\n      it('should filter and normalize category tags', () => {\n        const params = {\n          keywords: 'test',\n          category: ['Config', 'SETTINGS', 'config', '  spaces  ', 'valid-tag'],\n        };\n\n        const result = validateSearchContentParams(params);\n\n        expect(result.category).toEqual([\n          'config',\n          'settings',\n          'spaces',\n          'valid-tag',\n        ]);\n      });\n\n      it('should validate page object structure', () => {\n        const params = {\n          keywords: 'test',\n          page: { limit: 20, offset: 10 },\n        };\n\n        const result = validateSearchContentParams(params);\n\n        expect(result.page).toEqual({ limit: 20, offset: 10 });\n      });\n\n      it('should throw ValidationError for invalid page limit', () => {\n        expect(() =>\n          validateSearchContentParams({\n            keywords: 'test',\n            page: { limit: 101, offset: 0 }, // Exceeds max limit\n          })\n        ).toThrow(ValidationError);\n      });\n\n      it('should throw ValidationError for invalid page offset', () => {\n        expect(() =>\n          validateSearchContentParams({\n            keywords: 'test',\n            page: { limit: 10, offset: -1 }, // Negative offset\n          })\n        ).toThrow(ValidationError);\n      });\n\n      it('should trim and normalize keywords', () => {\n        const params = { keywords: '  drupal configuration  ' };\n        const result = validateSearchContentParams(params);\n\n        expect(result.keywords).toBe('drupal configuration');\n      });\n    });\n  });\n\n  describe('Tool Registration', () => {\n    it('should register search_tutorials tool in tools list', () => {\n      const server = mcpServer.getServer();\n      const tools = (mcpServer as any).getTools();\n\n      const searchTutorialsTool = tools.find(\n        (tool: any) => tool.name === 'search_tutorials'\n      );\n      expect(searchTutorialsTool).toBeDefined();\n      expect(searchTutorialsTool.description).toContain(\n        'Search Drupalize.me tutorials'\n      );\n    });\n\n    it('should have correct tool schema for new parameters', () => {\n      const tools = (mcpServer as any).getTools();\n      const searchTutorialsTool = tools.find(\n        (tool: any) => tool.name === 'search_tutorials'\n      );\n\n      expect(searchTutorialsTool.inputSchema).toEqual({\n        type: 'object',\n        properties: {\n          keywords: {\n            type: 'string',\n            description: 'Search keywords (minimum 2 characters)',\n            minLength: 2,\n          },\n          types: {\n            type: 'array',\n            description:\n              'Filter by content types (defaults to [\"tutorial\", \"topic\", \"course\"])',\n            items: {\n              type: 'string',\n              enum: ['tutorial', 'topic', 'course', 'video', 'guide'],\n            },\n          },\n          drupal_version: {\n            type: 'array',\n            description: 'Filter by Drupal versions',\n            items: {\n              type: 'string',\n              enum: ['9', '10', '11'],\n            },\n          },\n          category: {\n            type: 'array',\n            description: 'Filter by tutorial categories/tags',\n            items: {\n              type: 'string',\n            },\n          },\n          sort: {\n            type: 'string',\n            description: 'Sort results by relevance, date, or title',\n            enum: ['search_api_relevance', 'created', 'changed', 'title'],\n          },\n          page: {\n            type: 'object',\n            description: 'Pagination settings',\n            properties: {\n              limit: {\n                type: 'number',\n                description: 'Number of results per page',\n                minimum: 1,\n                maximum: 100,\n                default: 10,\n              },\n              offset: {\n                type: 'number',\n                description: 'Number of results to skip',\n                minimum: 0,\n                default: 0,\n              },\n            },\n          },\n        },\n        required: ['keywords'],\n      });\n    });\n  });\n\n  describe('Tool Execution', () => {\n    it('should execute search_tutorials tool successfully with new format', async () => {\n      const params = {\n        keywords: 'drupal configuration',\n        types: ['tutorial', 'topic'],\n        drupal_version: ['10'],\n        category: ['config', 'settings'],\n        sort: 'search_api_relevance',\n        page: { limit: 10, offset: 0 },\n      };\n\n      const result = await (mcpServer as any).executeSearchTutorials(params);\n\n      expect(result).toEqual({\n        results: expect.arrayContaining([\n          expect.objectContaining({\n            id: expect.any(String),\n            title: expect.stringContaining('drupal configuration'),\n            url: expect.stringMatching(/^https?:\\/\\//),\n            drupal_version: expect.arrayContaining(['10']),\n            tags: expect.arrayContaining(['config', 'settings']),\n          }),\n        ]),\n        total: expect.any(Number),\n        facets: expect.any(Object),\n        query: {\n          keywords: 'drupal configuration',\n          types: ['tutorial', 'topic'],\n          drupal_version: ['10'],\n          category: ['config', 'settings'],\n          sort: 'search_api_relevance',\n          page: { limit: 10, offset: 0 },\n        },\n      });\n    });\n\n    it('should handle search with minimal parameters', async () => {\n      const params = { keywords: 'drupal theming' };\n      const result = await (mcpServer as any).executeSearchTutorials(params);\n\n      expect(result.query.drupal_version).toBeUndefined();\n      expect(result.query.types).toEqual(['tutorial', 'topic', 'course']);\n      expect(result.results[0].drupal_version).toEqual(['10', '11']);\n    });\n\n    it('should handle search without categories', async () => {\n      const params = { keywords: 'drupal api' };\n      const result = await (mcpServer as any).executeSearchTutorials(params);\n\n      expect(result.query.category).toBeUndefined();\n      expect(result.results[0].tags).toEqual(['tutorial', 'drupal']);\n    });\n\n    it('should filter results by drupal_version array', async () => {\n      const params = {\n        keywords: 'drupal api',\n        drupal_version: ['9'],\n      };\n\n      const result = await (mcpServer as any).executeSearchTutorials(params);\n\n      // Should return results filtered for Drupal 9\n      expect(result.results).toHaveLength(1);\n      expect(result.total).toBe(1);\n      expect(result.results[0].drupal_version).toContain('9');\n      expect(result.results[0].title).toContain('Drupal 9 specific');\n    });\n\n    it('should use new RPC method dme_mcp.search_content', async () => {\n      // Since we're in test environment, this will use mock data\n      // The test validates that the parameters are processed correctly\n      const params = {\n        keywords: 'test drupal configuration',\n        types: ['tutorial'],\n        drupal_version: ['10'],\n        page: { limit: 5, offset: 0 },\n      };\n\n      const result = await (mcpServer as any).executeSearchTutorials(params);\n\n      // Verify the result has the expected structure for new format\n      expect(result).toHaveProperty('results');\n      expect(result).toHaveProperty('total');\n      expect(result).toHaveProperty('facets'); // New facets object\n      expect(result).toHaveProperty('query');\n\n      // Verify that query reflects the processed parameters\n      expect(result.query).toEqual({\n        keywords: 'test drupal configuration',\n        types: ['tutorial'],\n        drupal_version: ['10'],\n        category: undefined,\n        sort: 'search_api_relevance',\n        page: { limit: 5, offset: 0 },\n      });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle validation errors gracefully through executeTool', async () => {\n      const invalidParams = { keywords: 'x' }; // Too short\n\n      const result = await (mcpServer as any).executeTool(\n        'search_tutorials',\n        invalidParams\n      );\n\n      const errorResponse = JSON.parse(result.content[0].text);\n      expect(errorResponse.error.type).toBe('VALIDATION_ERROR');\n      expect(errorResponse.error.message).toContain('keywords');\n    });\n\n    it('should handle missing parameters through executeTool', async () => {\n      const result = await (mcpServer as any).executeTool(\n        'search_tutorials',\n        {}\n      );\n\n      const errorResponse = JSON.parse(result.content[0].text);\n      expect(errorResponse.error.type).toBe('VALIDATION_ERROR');\n      expect(errorResponse.error.message).toContain('keywords');\n    });\n\n    it('should handle invalid argument types through executeTool', async () => {\n      const result = await (mcpServer as any).executeTool(\n        'search_tutorials',\n        'invalid'\n      );\n\n      const errorResponse = JSON.parse(result.content[0].text);\n      expect(errorResponse.error.type).toBe('VALIDATION_ERROR');\n      expect(errorResponse.error.message).toContain('Invalid arguments');\n    });\n\n    it('should handle invalid types parameter', async () => {\n      const invalidParams = {\n        keywords: 'test',\n        types: ['invalid-type'],\n      };\n\n      const result = await (mcpServer as any).executeTool(\n        'search_tutorials',\n        invalidParams\n      );\n\n      const errorResponse = JSON.parse(result.content[0].text);\n      expect(errorResponse.error.type).toBe('VALIDATION_ERROR');\n      expect(errorResponse.error.message).toContain('types');\n    });\n\n    it('should handle invalid drupal_version array', async () => {\n      const invalidParams = {\n        keywords: 'test',\n        drupal_version: ['8'], // Invalid version\n      };\n\n      const result = await (mcpServer as any).executeTool(\n        'search_tutorials',\n        invalidParams\n      );\n\n      const errorResponse = JSON.parse(result.content[0].text);\n      expect(errorResponse.error.type).toBe('VALIDATION_ERROR');\n      expect(errorResponse.error.message).toContain('drupal_version');\n    });\n  });\n\n  describe('Response Format', () => {\n    it('should return response in correct MCP tool format', async () => {\n      const params = { keywords: 'drupal basics' };\n      const result = await (mcpServer as any).executeTool(\n        'search_tutorials',\n        params\n      );\n\n      expect(result).toHaveProperty('content');\n      expect(result.content).toHaveLength(1);\n      expect(result.content[0]).toHaveProperty('type', 'text');\n      expect(result.content[0]).toHaveProperty('text');\n\n      // Parse the JSON response\n      const responseData = JSON.parse(result.content[0].text);\n      expect(responseData).toHaveProperty('results');\n      expect(responseData).toHaveProperty('total');\n      expect(responseData).toHaveProperty('facets'); // New facets object\n      expect(responseData).toHaveProperty('query');\n    });\n\n    it('should return structured tutorial data with new format', async () => {\n      const params = { keywords: 'drupal modules' };\n      const result = await (mcpServer as any).executeSearchTutorials(params);\n\n      const tutorial = result.results[0];\n      expect(tutorial).toHaveProperty('id');\n      expect(tutorial).toHaveProperty('title');\n      expect(tutorial).toHaveProperty('url');\n      expect(tutorial).toHaveProperty('description');\n      expect(tutorial).toHaveProperty('drupal_version');\n      expect(tutorial).toHaveProperty('tags');\n      expect(tutorial).toHaveProperty('difficulty');\n      expect(tutorial).toHaveProperty('created');\n      expect(tutorial).toHaveProperty('updated');\n\n      // Validate required fields\n      expect(tutorial.id).toBeTruthy();\n      expect(tutorial.title).toBeTruthy();\n      expect(tutorial.url).toMatch(/^https?:\\/\\//);\n      expect(tutorial.created).toMatch(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}/);\n    });\n\n    it('should include facets in response', async () => {\n      const params = { keywords: 'drupal configuration' };\n      const result = await (mcpServer as any).executeSearchTutorials(params);\n\n      expect(result).toHaveProperty('facets');\n      expect(result.facets).toBeDefined();\n      expect(typeof result.facets).toBe('object');\n    });\n\n    it('should include query object with new parameter structure', async () => {\n      const params = {\n        keywords: 'drupal testing',\n        types: ['tutorial'],\n        drupal_version: ['10', '11'],\n        sort: 'created',\n      };\n\n      const result = await (mcpServer as any).executeSearchTutorials(params);\n\n      expect(result.query).toEqual({\n        keywords: 'drupal testing',\n        types: ['tutorial'],\n        drupal_version: ['10', '11'],\n        category: undefined,\n        sort: 'created',\n        page: { limit: 10, offset: 0 },\n      });\n    });\n  });\n});\n\ndescribe('Integration with MCP Server', () => {\n  let mcpServer: DrupalMcpServer;\n\n  beforeEach(() => {\n    mcpServer = new DrupalMcpServer(mockConfig);\n  });\n\n  afterEach(async () => {\n    await mcpServer.close();\n  });\n\n  it('should be available in tools list', () => {\n    const tools = (mcpServer as any).getTools();\n    const toolNames = tools.map((tool: any) => tool.name);\n\n    expect(toolNames).toContain('search_tutorials');\n  });\n\n  it('should execute through the standard tool execution flow with new format', async () => {\n    const result = await (mcpServer as any).executeTool('search_tutorials', {\n      keywords: 'drupal testing',\n      drupal_version: ['11'],\n    });\n\n    expect(result.content[0].type).toBe('text');\n\n    const responseData = JSON.parse(result.content[0].text);\n    expect(responseData.query.keywords).toBe('drupal testing');\n    expect(responseData.query.drupal_version).toEqual(['11']);\n    expect(responseData).toHaveProperty('facets'); // New facets object\n  });\n\n  it('should validate complete search workflow with new parameters', async () => {\n    const searchParams = {\n      keywords: 'drupal configuration management',\n      types: ['tutorial', 'guide'],\n      drupal_version: ['10', '11'],\n      category: ['config', 'admin'],\n      sort: 'search_api_relevance',\n      page: { limit: 20, offset: 10 },\n    };\n\n    const result = await (mcpServer as any).executeTool(\n      'search_tutorials',\n      searchParams\n    );\n\n    expect(result.content[0].type).toBe('text');\n    const responseData = JSON.parse(result.content[0].text);\n\n    // Validate complete parameter transformation\n    expect(responseData.query).toMatchObject({\n      keywords: 'drupal configuration management',\n      types: ['tutorial', 'guide'],\n      drupal_version: ['10', '11'],\n      category: ['config', 'admin'],\n      sort: 'search_api_relevance',\n      page: { limit: 20, offset: 10 },\n    });\n\n    // Validate response structure\n    expect(responseData).toHaveProperty('results');\n    expect(responseData).toHaveProperty('total');\n    expect(responseData).toHaveProperty('facets');\n    expect(Array.isArray(responseData.results)).toBe(true);\n  });\n});\n"],"version":3}